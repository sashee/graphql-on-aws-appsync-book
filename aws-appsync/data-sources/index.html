<!doctypehtml><html lang="en"><meta charset="utf-8"><link rel="icon"type="image/svg+xml"href="/assets/favicon.15621087ab873d484cfdc234ae6d4f0559d2ece6.svg"><meta name="viewport"content="width=device-width,initial-scale=1"><link href="/assets/main.d3c4fd66da45b5fe1b587fd7bc4b64cc7a34bcf3.css"rel="stylesheet"><title>Data sources - AWS AppSync - Building GraphQL APIs with AWS AppSync</title><nav class="navbar navbar-light"><div class="container-fluid flex-nowrap"><a class="navbar-brand"href="/">Building GraphQL APIs with AWS AppSync</a> <button class="navbar-toggler d-lg-none align-self-start"type="button"data-bs-toggle="offcanvas"data-bs-target="#offcanvasNavbar"aria-controls="offcanvasNavbar"><span class="navbar-toggler-icon"></span></button><div class="offcanvas offcanvas-end"tabindex="-1"id="offcanvasNavbar"aria-labelledby="offcanvasNavbarLabel"><div class="offcanvas-header"><h5 class="offcanvas-title"id="offcanvasNavbarLabel">Building GraphQL APIs with AWS AppSync</h5><button type="button"class="btn-close text-reset"data-bs-dismiss="offcanvas"aria-label="Close"></button></div><div class="offcanvas-body keep-scrolltop"><ul class="nav navbar-nav justify-content-end flex-grow-1 pe-3"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ğŸš§</span><li class="nav-item"><span class="nav-link">RDS ğŸš§</span><li class="nav-item"><span class="nav-link">None ğŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ğŸš§</span><li class="nav-item"><span class="nav-link">Authorization ğŸš§</span><li class="nav-item"><span class="nav-link">Error handling ğŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ğŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ğŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ğŸš§</span><li class="nav-item"><span class="nav-link">CDK ğŸš§</span><li class="nav-item"><span class="nav-link">Amplify ğŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ğŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul></div></div></div></nav><div class="d-flex flex-row"><ul class="nav flex-column navigation flex-shrink-0 flex-nowrap overflow-auto d-none d-lg-flex keep-scrolltop"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ğŸš§</span><li class="nav-item"><span class="nav-link">RDS ğŸš§</span><li class="nav-item"><span class="nav-link">None ğŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ğŸš§</span><li class="nav-item"><span class="nav-link">Authorization ğŸš§</span><li class="nav-item"><span class="nav-link">Error handling ğŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ğŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ğŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ğŸš§</span><li class="nav-item"><span class="nav-link">CDK ğŸš§</span><li class="nav-item"><span class="nav-link">Amplify ğŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ğŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul><div class="flex-grow-1 main container-fluid"><div class="row"><div class="col-lg-9 body p-3"><div class="d-lg-none mb-4"><div class="accordion"id="accordionExample"><div class="accordion-item"><h2 class="accordion-header"id="mobile-toc-header"><button class="accordion-button collapsed"type="button"data-bs-toggle="collapse"data-bs-target="#mobile-toc"aria-expanded="true"aria-controls="mobile-toc">In this chapter</button></h2><div id="mobile-toc"class="accordion-collapse collapse"aria-labelledby="mobile-toc-header"data-bs-parent="#accordionExample"><div class="accordion-body"><div class="toc-container"><a style="margin-left: 0em"href="#defined-data-sources">Data sources</a></div></div></div></div></div></div><h2 id="defined-data-sources">Data sources</h2><p>In GraphQL, a resolver is a function that gets the arguments and the context for a field and returns a value. This is a generic concept and applies to all GraphQL servers. But how this function is implemented, such as what language it can be written in, can be different between servers.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="422"preserveAspectRatio="none"style="width:419px;height:422px;background:#fff"viewBox="0 0 419 422"width="419"><defs><filter height="300%"id="46e23feac63fc16b9cba54932c7e201429e978d45ac672d4004746ed7a40a411__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5"d="M26 88.297v326.992M218.5 88.297v326.992m138-326.992v326.992"></path><text font-family="sans-serif"font-size="14"textLength="37"x="5"y="84.995">client</text><circle cx="26.5"cy="15"fill="#FEFECE"filter="url(#46e23feac63fc16b9cba54932c7e201429e978d45ac672d4004746ed7a40a411__a)"style="stroke:#a80036;stroke-width:2"r="8"></circle><path d="M26.5 23v27m-13-19h26m-13 19-13 15m13-15 13 15"fill="none"filter="url(#46e23feac63fc16b9cba54932c7e201429e978d45ac672d4004746ed7a40a411__a)"style="stroke:#a80036;stroke-width:2;fill:none"></path><text font-family="sans-serif"font-size="14"textLength="60"x="185.5"y="68.698">GraphQL</text><text font-family="sans-serif"font-size="14"textLength="60"x="185.5"y="84.995">backend</text><circle cx="218.5"cy="39.703"fill="#FEFECE"filter="url(#46e23feac63fc16b9cba54932c7e201429e978d45ac672d4004746ed7a40a411__a)"style="stroke:#a80036;stroke-width:2"r="12"></circle><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m214.5 27.703 6-5-2 5 2 5-6-5z"></path><text font-family="sans-serif"font-size="14"textLength="60"x="323.5"y="84.995">Resolver</text><circle cx="356.5"cy="56"fill="#FEFECE"filter="url(#46e23feac63fc16b9cba54932c7e201429e978d45ac672d4004746ed7a40a411__a)"style="stroke:#a80036;stroke-width:2"r="12"></circle><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m352.5 44 6-5-2 5 2 5-6-5zm-146 147.094 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M26.5 195.094h186"></path><text font-family="sans-serif"font-size="13"textLength="108"x="33.5"y="114.364">query MyQuery {</text><text font-family="sans-serif"font-size="13"textLength="160"x="41.5"y="129.497">groupById(id: "group1") {</text><text font-family="sans-serif"font-size="13"textLength="11"x="49.5"y="144.629">id</text><text font-family="sans-serif"font-size="13"textLength="37"x="49.5"y="159.762">name</text><text font-family="sans-serif"font-size="13"textLength="8"x="41.5"y="174.895">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="33.5"y="190.028">}</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m344.5 235.36 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M218.5 239.359h132"></path><text font-family="sans-serif"font-size="13"textLength="114"x="225.5"y="219.161">resolve groupById</text><text font-family="sans-serif"font-size="13"textLength="84"x="233.5"y="234.293">(id: "group1")</text><path d="M298 252.36v25h112v-15l-10-10H298"fill="#FBFB77"filter="url(#46e23feac63fc16b9cba54932c7e201429e978d45ac672d4004746ed7a40a411__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M400 252.36v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="91"x="304"y="269.426">Resolve field...</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m229.5 288.492-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M223.5 292.492h132"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m37.5 393.29-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M31.5 397.289h186"></path><text font-family="sans-serif"font-size="13"textLength="8"x="43.5"y="316.559">{</text><text font-family="sans-serif"font-size="13"textLength="55"x="51.5"y="331.692">"data": {</text><text font-family="sans-serif"font-size="13"textLength="88"x="59.5"y="346.825">"id": "group1",</text><text font-family="sans-serif"font-size="13"textLength="116"x="59.5"y="361.957">"name": "Group 1"</text><text font-family="sans-serif"font-size="13"textLength="8"x="51.5"y="377.09">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="43.5"y="392.223">}</text></svg><figcaption class="caption">Field resolving in GraphQL</figcaption></figure><p>In AppSync, a resolver is broken into three parts:<ul><li>the request mapping template<li>the data source<li>and the response mapping template</ul><p>The <strong>request mapping template</strong> converts the GraphQL context into a format suitable for the data source. Then the <strong>data source</strong> interacts with some external service, such as a database, a Lambda function, or sends an HTTP request. Then the <strong>response mapping template</strong> gets the result of the data source and converts it into a format suitable for the resolver's result.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="555"preserveAspectRatio="none"style="width:538px;height:555px;background:#fff"viewBox="0 0 538 555"width="538"><defs><filter height="300%"id="aac0bd5e121cd339af61d064fad348f76cee4c336f94d4958c166af4bb4554bc__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5"d="M26 88.297v460.656M218.5 88.297v460.656m138-460.656v460.656m136-460.656v460.656"></path><text font-family="sans-serif"font-size="14"textLength="37"x="5"y="84.995">client</text><circle cx="26.5"cy="15"fill="#FEFECE"filter="url(#aac0bd5e121cd339af61d064fad348f76cee4c336f94d4958c166af4bb4554bc__a)"style="stroke:#a80036;stroke-width:2"r="8"></circle><path d="M26.5 23v27m-13-19h26m-13 19-13 15m13-15 13 15"fill="none"filter="url(#aac0bd5e121cd339af61d064fad348f76cee4c336f94d4958c166af4bb4554bc__a)"style="stroke:#a80036;stroke-width:2;fill:none"></path><text font-family="sans-serif"font-size="14"textLength="60"x="185.5"y="68.698">GraphQL</text><text font-family="sans-serif"font-size="14"textLength="60"x="185.5"y="84.995">backend</text><circle cx="218.5"cy="39.703"fill="#FEFECE"filter="url(#aac0bd5e121cd339af61d064fad348f76cee4c336f94d4958c166af4bb4554bc__a)"style="stroke:#a80036;stroke-width:2"r="12"></circle><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m214.5 27.703 6-5-2 5 2 5-6-5z"></path><text font-family="sans-serif"font-size="14"textLength="60"x="323.5"y="84.995">Resolver</text><circle cx="356.5"cy="56"fill="#FEFECE"filter="url(#aac0bd5e121cd339af61d064fad348f76cee4c336f94d4958c166af4bb4554bc__a)"style="stroke:#a80036;stroke-width:2"r="12"></circle><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m352.5 44 6-5-2 5 2 5-6-5z"></path><text font-family="sans-serif"font-size="14"textLength="84"x="447.5"y="84.995">Data source</text><path d="M474.5 36c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10V36"fill="#FEFECE"filter="url(#aac0bd5e121cd339af61d064fad348f76cee4c336f94d4958c166af4bb4554bc__a)"style="stroke:#000;stroke-width:1.5;fill:#fefece"></path><path d="M474.5 36c0 10 18 10 18 10s18 0 18-10"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m206.5 191.094 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M26.5 195.094h186"></path><text font-family="sans-serif"font-size="13"textLength="108"x="33.5"y="114.364">query MyQuery {</text><text font-family="sans-serif"font-size="13"textLength="160"x="41.5"y="129.497">groupById(id: "group1") {</text><text font-family="sans-serif"font-size="13"textLength="11"x="49.5"y="144.629">id</text><text font-family="sans-serif"font-size="13"textLength="37"x="49.5"y="159.762">name</text><text font-family="sans-serif"font-size="13"textLength="8"x="41.5"y="174.895">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="33.5"y="190.028">}</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m344.5 235.36 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M218.5 239.359h132"></path><text font-family="sans-serif"font-size="13"textLength="114"x="225.5"y="219.161">resolve groupById</text><text font-family="sans-serif"font-size="13"textLength="84"x="233.5"y="234.293">(id: "group1")</text><path style="stroke:#a80036;stroke-width:1"d="M356.5 283.625h42m0 0v13m-41 0h41"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m367.5 292.625-10 4 10 4-4-4z"></path><text font-family="sans-serif"font-size="13"textLength="112"x="363.5"y="263.426">Request mapping</text><text font-family="sans-serif"font-size="13"textLength="58"x="363.5"y="278.559">template</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m480.5 321.758 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M356.5 325.758h130"></path><text font-family="sans-serif"font-size="13"textLength="49"x="363.5"y="320.692">request</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m367.5 350.89-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M361.5 354.891h130"></path><text font-family="sans-serif"font-size="13"textLength="36"x="373.5"y="349.825">result</text><path style="stroke:#a80036;stroke-width:1"d="M356.5 399.156h42m0 0v13m-41 0h41"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m367.5 408.156-10 4 10 4-4-4z"></path><text font-family="sans-serif"font-size="13"textLength="122"x="363.5"y="378.957">Response mapping</text><text font-family="sans-serif"font-size="13"textLength="58"x="363.5"y="394.09">template</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m229.5 422.156-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M223.5 426.156h132"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m37.5 526.953-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M31.5 530.953h186"></path><text font-family="sans-serif"font-size="13"textLength="8"x="43.5"y="450.223">{</text><text font-family="sans-serif"font-size="13"textLength="55"x="51.5"y="465.356">"data": {</text><text font-family="sans-serif"font-size="13"textLength="88"x="59.5"y="480.489">"id": "group1",</text><text font-family="sans-serif"font-size="13"textLength="116"x="59.5"y="495.622">"name": "Group 1"</text><text font-family="sans-serif"font-size="13"textLength="8"x="51.5"y="510.754">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="43.5"y="525.887">}</text></svg><figcaption class="caption">Field resolving in AppSync</figcaption></figure><p>The mapping templates are written in <a href="https://velocity.apache.org/">Velocity Template Language</a> (VTL), which is a Java-based templating language. Since both the data source's input format and the resolver's result are JSON, the templates need to produce a valid JSON file.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Note</div><div class="tbox-body"><p>Velocity is a general-purpose <em>template language</em>. It gets some arguments, in the case of AppSync the resolver context, and returns text. For an AppSync resolver, this text needs to be parseable to JSON.</div></div></div><p>For example, to get an item from a DynamoDB table, the request mapping template for the <code>groupById</code> resolver can use the <code>id</code> argument:<pre class="highlight prevp"><code>{
  "version": "2018-05-29",
  "operation": "GetItem",
  "key": {
    "id": {"S": $util.toJson($ctx.args.id)}
  }
}</code></pre><p>When a query comes for this field, such as this one:<pre class="highlight prevp"><code><span class="hljs-keyword">query</span><span class="hljs-literal"> MyQuery</span> {
  groupById(id: <span class="hljs-string">"group1"</span>) {
    id
    name
  }
}</code></pre><p>The resulting JSON will be:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2018-05-29"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"operation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GetItem"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"S"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"group1"</span><span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><p>The DynamoDB data source knows how to process this input, and fetches an item from the configured table with the <code>id</code> of <code>group1</code>.<p>Then the response mapping template needs to convert the item to the resolver's result format:<pre class="highlight prevp"><code>#if($ctx.error)
  $util.error($ctx.error.message, $ctx.error.type)
#end
$util.toJson($ctx.result)</code></pre><p>Let's say the item is a JSON with the <code>id</code> and a <code>name</code> property:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"group1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Group 1"</span>
<span class="hljs-punctuation">}</span></code></pre><p>The response mapping template gets the above JSON as the <code>$ctx.result</code> and returns this JSON:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"group1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Group 1"</span>
<span class="hljs-punctuation">}</span></code></pre><p>Which is in a format that the result type can use.<figure class="image"><img srcset="/assets/GxkA-KVLZoC-wEQO2MPW5W1BC5AQA9o9PCM.1d5888eae61001399c089c8520043fc9c13262df.png 3x, /assets/Cw-AZGF0YV9zb3VyY2VfZXhhbXBsZUAzLnBuZyV3LTcyOAM.38d1b875569cb5ced4cf4c88f5b3990c0cf24dbe.png, /assets/iw-AZGF0YV9zb3VyY2VfZXhhbXBsZUAzLnBuZyV3LTEwOTMD.613480bc8760eecb5892b72a7ea2721bc94e517b.png 1.5x"title="Running the resolver"><figcaption class="caption">Running the resolver</figcaption></figure><figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="628"preserveAspectRatio="none"style="width:596px;height:628px;background:#fff"viewBox="0 0 596 628"width="596"><defs><filter height="300%"id="9941617441b61f4d8e0bb2272db8fd60b2f14f9e7cd6b3c45ef62a751722fa5f__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FEFECE"filter="url(#9941617441b61f4d8e0bb2272db8fd60b2f14f9e7cd6b3c45ef62a751722fa5f__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M7 72.5h74v36.297H7z"></path><text font-family="sans-serif"font-size="14"textLength="54"x="17"y="95.495">request</text><path fill="#FEFECE"filter="url(#9941617441b61f4d8e0bb2272db8fd60b2f14f9e7cd6b3c45ef62a751722fa5f__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M202 7h278v166.672H202z"></path><text font-family="sans-serif"font-size="14"textLength="183"x="212"y="29.995">request mapping template</text><text font-family="sans-serif"font-size="14"textLength="9"x="212"y="62.589">{</text><text font-family="sans-serif"font-size="14"textLength="165"x="220"y="78.886">"version": "2018-05-29",</text><text font-family="sans-serif"font-size="14"textLength="154"x="220"y="95.183">"operation": "GetItem",</text><text font-family="sans-serif"font-size="14"textLength="52"x="220"y="111.48">"key": {</text><text font-family="sans-serif"font-size="14"textLength="242"x="228"y="127.776">"id": {"S": $util.toJson($ctx.args.id)}</text><text font-family="sans-serif"font-size="14"textLength="9"x="220"y="144.073">}</text><text font-family="sans-serif"font-size="14"textLength="9"x="212"y="160.37">}</text><path fill="#FEFECE"filter="url(#9941617441b61f4d8e0bb2272db8fd60b2f14f9e7cd6b3c45ef62a751722fa5f__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M141 341h102v36.297H141z"></path><text font-family="sans-serif"font-size="14"textLength="82"x="151"y="363.995">data source</text><path fill="#FEFECE"filter="url(#9941617441b61f4d8e0bb2272db8fd60b2f14f9e7cd6b3c45ef62a751722fa5f__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M19 499h346v117.781H19z"></path><text font-family="sans-serif"font-size="14"textLength="195"x="29"y="521.995">response mapping template</text><text font-family="sans-serif"font-size="14"textLength="95"x="33"y="554.589">#if($ctx.error)</text><text font-family="sans-serif"font-size="14"textLength="318"x="37"y="570.886">$util.error($ctx.error.message, $ctx.error.type)</text><text font-family="sans-serif"font-size="14"textLength="39"x="33"y="587.183">#end</text><text font-family="sans-serif"font-size="14"textLength="158"x="29"y="603.48">$util.toJson($ctx.result)</text><path fill="#FEFECE"filter="url(#9941617441b61f4d8e0bb2272db8fd60b2f14f9e7cd6b3c45ef62a751722fa5f__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M525.5 540h59v36.297h-59z"></path><text font-family="sans-serif"font-size="14"textLength="39"x="535.5"y="562.995">result</text><path d="M81.01 90.5h115.75"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m201.99 90.5-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="64"x="99.5"y="68.567">groupById</text><text font-family="sans-serif"font-size="13"textLength="84"x="99.5"y="83.7">(id: "group1")</text><path d="M294.67 174.36c-31.56 56.45-71.02 127.04-90.56 161.98"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m201.6 340.82 7.876-5.914-5.442 1.547-1.546-5.442-.888 9.809z"></path><text font-family="sans-serif"font-size="13"textLength="8"x="276"y="217.067">{</text><text font-family="sans-serif"font-size="13"textLength="152"x="284"y="232.2">"version": "2018-05-29",</text><text font-family="sans-serif"font-size="13"textLength="145"x="284"y="247.333">"operation": "GetItem",</text><text font-family="sans-serif"font-size="13"textLength="48"x="284"y="262.465">"key": {</text><text font-family="sans-serif"font-size="13"textLength="127"x="292"y="277.598">"id": {"S": "group1"}</text><text font-family="sans-serif"font-size="13"textLength="8"x="284"y="292.731">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="276"y="307.864">}</text><path d="M192 377.14v116.32"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m192 498.89 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="8"x="193"y="420.067">{</text><text font-family="sans-serif"font-size="13"textLength="88"x="201"y="435.2">"id": "group1",</text><text font-family="sans-serif"font-size="13"textLength="116"x="201"y="450.332">"name": "Group 1"</text><text font-family="sans-serif"font-size="13"textLength="8"x="193"y="465.465">}</text><path d="M365.26 558h154.75"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m525.2 558-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="8"x="383.25"y="506.067">{</text><text font-family="sans-serif"font-size="13"textLength="88"x="391.25"y="521.2">"id": "group1",</text><text font-family="sans-serif"font-size="13"textLength="116"x="391.25"y="536.332">"name": "Group 1"</text><text font-family="sans-serif"font-size="13"textLength="8"x="383.25"y="551.465">}</text></svg><figcaption class="caption">AppSync resolver flow</figcaption></figure><p>Why AppSync implements this separation?<p>Usually, <strong>data sources have parameters</strong> that the resolver might not know, such as the DynamoDB table. In the above example, only the <code>id</code> of the item is defined, but not the table name. That comes from the data source config.<p>Even more important is that the data source configuration can define <strong>the IAM role</strong> AppSync assumes when it calls the external service. In AWS, the services usually don't have access to resources in the account. For example, the AppSync API by default can not read data from any DynamoDB table. The API gains the necessary permissions through assuming a role and using its permissions. In a sense, the role is the connecting piece between the API and the resource.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"height="591"preserveAspectRatio="none"style="width:533px;height:591px;background:#fff"viewBox="0 0 533 591"width="533"><defs><filter height="300%"id="cf36ad0f994ddb582f0bd6e5f8912ce6e6d1fb0a4f44b322b007ff3ba83fef0a__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M43.5 12h132v118.922h-132z"></path><image height="64"width="64"x="77.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADOUlEQVR4Xu2ZsWocMRCG/cB5g7xBnsC1m1Rp4zpFOneGdALbXGE4MOTgCoNh87M/OyialTSzq4tyIPFj1ruz0nwjzUhe34RPt1etG33rujQAemsA9NYA6K0B0FsDoLcaAzx/vjt+/XF+fHp/OX78Pk9zwwWEm2/fH15v7/Vbe9QGgH6Lx3QaDHCaMJA8Qjv9/HX48k33s0ENABBXcRqeIcbg0WYQnIaxwMBY23i1CwAOMerwCTOgDXLCi5gZ1ys5bQeQwDfxY7M2AtB7BD63Wv6ZtgBg7cJ7rIHu3ocNAFgw9F4/2inWX8ytq0D5ANA1q80lYh9XYcbIAuMDYAWsdkqxYkK40E8TMTRssIf3cq2NYzkAuHiqPVL0gHsww6ltYsnKnKKyBqrqVDsA6E21x7CEU/YpJn153ug6Ouco2iAnKwD2V3v4GU7xmDzl7YJHD3nXfmSyAjCKlvAHRctNo+ATupUZi68tsgJM87al7+fEdOdhrvounI4LDk+y2mxVJgCuAeP6oThj0lzvcsbKOSMyAXBJFNZAIgJL1L156RrOBOAKSVhKitgzL8tJHMs14SYArgd9f1WMX5yFLI7lNEiU9FBQewCmb1KvqoUoUTeA3G7N4mifhMYAjF9hEzjMfytiyMJuzSjg52n+s1MbxGoMUN4d+VRa7tiTmBX843TpaVyVCaBwFuBgiDoPXqw/GnXVLFfWWAZWh9MyAXB4CS1+lbGTwYiaa4lZLsauqm0CCEtp53U8QOIKed6XL0KxtFkuxqxj+v6qrABxGsQwYRkPzh2Xb1urScxHVbNLHebiOjj9namYBDKw6QQQM/o9zcmQMysXDK0KQBwk1kGuH7184R8TVHfiMvMenCoAjMd5+S4rYTZmmFfeU1OoAsBprvikacv9klKrHxVUARAd5r2WMPYMc4mJZF/9lBXg0pIE04/K+i8AOLFxZbOrM4AcK7Z5H/oCyPFuT1I1AEDanZz/MsIrTNnCjmZUAwDmH5cBgpojwWohquzHuC7saEY1AAhzkU22i/g8x+888gjXqDb7XafaAFASYzideEyeN8Pncq9aAnTRAOitAdBbA6C3BkBvDYDeunqAPxdjffOs6ZOIAAAAAElFTkSuQmCC"y="22"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="112"x="53.5"y="117.148">AppSync API</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M348 420h169v118.922H348z"></path><image height="64"width="64"x="400.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADxUlEQVR4Xu1asYrcMBC9H58yjcs026W6Kt02KV2k3SLtQkgRyJFAIMWFFIGA76GHB63Glmdks86BxeO4s2XpvdHMaGTfg7z58qrxYC+9LhwC9sYhYG8cAvbGISChe/v19O7b4/sf5w8/FfgTF3HL9t8Q7QJA8fLp+en738HRnn//Q2c8srmesADYNSeN38Gs//gL5GDvAriIW4XO6+c/dthmBATAeMoDnKDE9qkDkqjW3mqGVwDmJvVtp18PrwA4Mdg3ezAehPJFNKyqSwCmX2l7Z6yj2WfrcAmg/zQHH+w6JP0wxBw4BSLEPl5HQEDbBDKa317PAXnog4nsrToCAhgG+InkaPvMQc1vb+XAsNBpry8iIID7K2UMaQcArUWbecxPkSG7KGIC+CfmQzyoEjaaENe542rPwWF+j8g5tAhQIPhAEfzAGyQAyAA03D3MmOLaokuiAjgZ+HkSttP8DF+WJIrFpxQuAWok/IKfo9cs7Gse8wP5gHmrD65wCZCRTe7c9UV3mr8ASDO0PCtMeAVwEYbkP4uZR8bSQ88GRN2oDezFL0A9lTIwUyWHqtqi1fdyDh5iL34BQ2IvY1mW51CmHUae2pjVgQLmH6oeVbioHy4BzELF9KB4Hg9lqmduTeqVQjN7CQkAS3vLCe4P9rqsYy8hAdQQ9VGpVuPwvblbTgQEcLIhBcNiSskx5z/r2UtIAFc5j2CG7zl7g5IHsT7OICnG3IS9NAjQK5hbs+pkY3/6T7HrkX19K3QiLMDGQJdKOm5VfXbApc8wgeb+w9phE/YSFaDRfHG/Vikqopw9E7E/libhEiDZRsbDAGXYbgUK/yF73Y85zp0EMJNAg87nWQH6D3tyBLLHIFuFgVcAbcmGWW1OnARZyi179cNhtfnFL4Cu3KfDl06vOXSOB/vk7Ak+OIxuuQYuAYUrd6mey5WwsV7Q3ZpHAiqfJDq3wYXgEsBFn/TXU/os0KdX0CzsAApQhZPsZRTgiaUKAgKik9XZc32iY1rEBAzuE5n6j73V3R6s7yeAfsJZn5beapFlMUhefWgc30+A1jb9/ImsT59qtKbAxWt6ZZR3vqS3GzKu0r0FKFgIkGKup2gqz1YN+wi4Vt9qddkbc3u3wP0EcB+g06tpJ7NqCLZQbYBLgNx+YsLERY3ZgC69BbIHnSi8AtT2/eozlIy2X29+8QuQZDPNJxf3eSDHKX1m5Qiw/Xr2EhJAPK7+0K21xiYIC1Awh+bMKo06bSZdj3YBObrX+M8e/wkOAXvjELA3DgF74xCwN14AdzgE4KRN4cQAAAAASUVORK5CYII="y="430"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="149"x="358"y="525.148">DynamoDB Table</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M207.5 197h98v118.922h-98z"></path><image height="64"width="64"x="224.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADcElEQVR4Xu1Yy2pcMQzNn3bVZVfddtN1F1130X2h+0I/oPQHkg+4bSAQAiUDYSAQpgeLEWckW/Z9DM6AD2K4Y8vXOrIk2/fqcOG4sg2XhkGgNwaB3hgEemMQ6I1BoDcGgd44O4GXx0fI/vrm6ddv/ELw1yqtwFkIwMp/377fffg4vXlbEvRCB5p28ExsSQCuffjy1dtaFYx6/vPXvq4N2xDA9PefPnvL0Ajjdj9+In4geIDX0VJSXkBjLQHv9dt372FoiykSadDn4WixeiFWEYAFPDfCellMY3GYBp5b+AuWE4CbeUopL2jEgoCJMQgtEkuBZYYG/lqNHBYSwELrTIhdHwmxQD/LBC7g9ABhq+GwhEBLqYHLJYPxaxaEdbI0eG2rHGYT4LcbgbnxPpXNWozyQxA/qhDH0jwCJmtFYFA8hwfeYyqpz37mkF0owQwC8JOPhLmmM2A079Y+WnS1oWa6FDMI+N0ncEw7uB74TUAn9V2CVgKw9RzWCzgyzTpg2bXLp8qhnYA5mfmQXQnmYMJSAwnpzu2CJgLG/aXVXAnmYJytuecXoYkAF368y3ZvB3U2Qj/b7n3XRIDdv3nwGGismolK7qsT4JUNytlW0HA1c2kUmOJRJ8Dx40v1OaClk23Vfc3YUCfA9cfnkAGmxEx6awlOQdDJboIyXNTwBvwVGlpPTXrUCfCstu8IhFnW0BYRKw+FnV5EFKTXpEGFAO8j2TIs8NuciNwE5FiqYrYUlVK7vIfPHRwIFQJsWZwAd8crS3wgVcjtxx9PpuTvffoAYw5LLDpFhUCwQW4FYVLKtBIBNaZCgE//y3aAl/RhCysJiVdGcxcBo8IWwwC1R8OhSODp9IY65XZBD6lCEuiljEQ7FPx6lhJpovRTnYgA+oK5/XU2iOaqPJx+0tqni44RdlyFAAcMT+Dbp1Q0pNj7rom+RGB6DBfBM/S9d6AZVwhFRIB33CkFDIcsnvnmkRUYt0tVSEeV4BNXxCyIKu/Tt+Fd+mYjmpZAe7n0qwE7fEA3AvMax4mYDPaibsoQkAyTci4FRNLf70G386/zJezKiedFc/rAIVSK5pK0FKW52KfvLpzBsjnu0ufh7BZ5ksS+dHq5Px5dXgkyZVSSRktHwP41IEPgsjAI9MYg0BuDQG8MAr0xCPTGINAbg0Bv/Ae3IF2lX4hXSgAAAABJRU5ErkJggg=="y="207"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="78"x="217.5"y="302.148">IAM Role</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M47 197h125v118.922H47z"></path><image height="64"width="64"x="77.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAACEElEQVR4Xu3asUoDQRgE4LyplaWVrY21hXWK9IK94AOIL6APcCoIEpAIIRCQ8SeL63+7uVzIzWw43GGrS3I3XzS7d5dMMPJM0g1jSz9g9fS8fHgsP+y4aZVt2QX4vLltTk6PO77u7tNa7XQC7D3Id3eUYU3Sci6dgPeLy/B6ew/yv2+BYccNBaxJWs6lExBe/HF1nT5QMHb0UCN9wKUClDkCwCau+XSWbj00pQFx2mUZigL8orHnGtSbcgBFe9AB34uFe/wvovbgAqz929l5vqbo2oMLiPvyBml7cAFwJxfBoG4POgDO4IeoPRQAZAZde4gAcAZpe+gAFjvXXb+8plvZEQLKpAL+ISBcCqZbD01pwPL3PgDLUBQQ2zd99xH2TzmAoj2KAUTtQQfYApx7dO3BBcR9eYO0PbiAcEHjN6rbgwtA2+DPSUXtQQegbVC3hwKAtkHaHiIANob5dKa+GIAOUCwVUAEDUwHbAF13SBXX+HyALcC2COQGm1Ib3tcCMWRAvJeYGEL7MLhLGxkAt8do8O1N6J88PHwA2gZ/QkpvDxEAbr/S9tAB0L7FS//sxqgA/v++yT7TxEgAvn08rxYZ+IB8zsnnJWLIgLx9iM5ABsRJM59z4pG4JxRkADaGvH2IzUXc9lAACqcCKmBgBgFG/6O/5dh/donNl8H57gqP3m+rdgFCVuP96fEoMnrADxiOGik5ulnkAAAAAElFTkSuQmCC"y="207"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="105"x="57"y="302.148">Trust Policy</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M340.5 197h184v118.922h-184z"></path><image height="64"width="64"x="400.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAACEElEQVR4Xu3asUoDQRgE4LyplaWVrY21hXWK9IK94AOIL6APcCoIEpAIIRCQ8SeL63+7uVzIzWw43GGrS3I3XzS7d5dMMPJM0g1jSz9g9fS8fHgsP+y4aZVt2QX4vLltTk6PO77u7tNa7XQC7D3Id3eUYU3Sci6dgPeLy/B6ew/yv2+BYccNBaxJWs6lExBe/HF1nT5QMHb0UCN9wKUClDkCwCau+XSWbj00pQFx2mUZigL8orHnGtSbcgBFe9AB34uFe/wvovbgAqz929l5vqbo2oMLiPvyBml7cAFwJxfBoG4POgDO4IeoPRQAZAZde4gAcAZpe+gAFjvXXb+8plvZEQLKpAL+ISBcCqZbD01pwPL3PgDLUBQQ2zd99xH2TzmAoj2KAUTtQQfYApx7dO3BBcR9eYO0PbiAcEHjN6rbgwtA2+DPSUXtQQegbVC3hwKAtkHaHiIANob5dKa+GIAOUCwVUAEDUwHbAF13SBXX+HyALcC2COQGm1Ib3tcCMWRAvJeYGEL7MLhLGxkAt8do8O1N6J88PHwA2gZ/QkpvDxEAbr/S9tAB0L7FS//sxqgA/v++yT7TxEgAvn08rxYZ+IB8zsnnJWLIgLx9iM5ABsRJM59z4pG4JxRkADaGvH2IzUXc9lAACqcCKmBgBgFG/6O/5dh/donNl8H57gqP3m+rdgFCVuP96fEoMnrADxiOGik5ulnkAAAAAElFTkSuQmCC"y="207"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="164"x="350.5"y="302.148">Permissions Policy</text><path d="M6 376v206.727h207V386l-10-10h-89.5l-4-59.86-4 59.86H6"fill="#FBFB77"filter="url(#cf36ad0f994ddb582f0bd6e5f8912ce6e6d1fb0a4f44b322b007ff3ba83fef0a__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M203 376v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="8"x="12"y="393.067">{</text><text font-family="sans-serif"font-size="13"textLength="154"x="20"y="408.2">"Version": "2012-10-17",</text><text font-family="sans-serif"font-size="13"textLength="92"x="20"y="423.332">"Statement": [</text><text font-family="sans-serif"font-size="13"textLength="8"x="28"y="438.465">{</text><text font-family="sans-serif"font-size="13"textLength="100"x="36"y="453.598">"Effect": "Allow",</text><text font-family="sans-serif"font-size="13"textLength="79"x="36"y="468.731">"Principal": {</text><text font-family="sans-serif"font-size="13"textLength="61"x="36"y="483.864">"Service":</text><text font-family="sans-serif"font-size="13"textLength="175"x="12"y="498.997">"appsync.amazonaws.com"</text><text font-family="sans-serif"font-size="13"textLength="12"x="28"y="514.129">},</text><text font-family="sans-serif"font-size="13"textLength="170"x="28"y="529.262">"Action": "sts:AssumeRole"</text><text font-family="sans-serif"font-size="13"textLength="8"x="28"y="544.395">}</text><text font-family="sans-serif"font-size="13"textLength="5"x="20"y="559.528">]</text><text font-family="sans-serif"font-size="13"textLength="8"x="12"y="574.661">}</text><path d="M340.5 6v131.063h88l4 59.687 4-59.688h88V16l-10-10h-174"fill="#FBFB77"filter="url(#cf36ad0f994ddb582f0bd6e5f8912ce6e6d1fb0a4f44b322b007ff3ba83fef0a__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M514.5 6v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="8"x="346.5"y="23.067">{</text><text font-family="sans-serif"font-size="13"textLength="100"x="354.5"y="38.2">"Effect": "Allow",</text><text font-family="sans-serif"font-size="13"textLength="63"x="354.5"y="53.333">"Action": [</text><text font-family="sans-serif"font-size="13"textLength="124"x="362.5"y="68.465">"dynamodb:Query",</text><text font-family="sans-serif"font-size="13"textLength="9"x="354.5"y="83.598">],</text><text font-family="sans-serif"font-size="13"textLength="82"x="354.5"y="98.731">"Resource": [</text><text font-family="sans-serif"font-size="13"textLength="147"x="362.5"y="113.864">"arn:aws:dynamodb:..."</text><text font-family="sans-serif"font-size="13"textLength="8"x="346.5"y="128.997">}</text><path d="M109.5 131.16v60.48"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m109.5 196.86 4-9-4 4-4-4 4 9z"></path><path d="M172.09 256.5h35.28m98.29 0h34.68m92.16 59.64v98.5"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m432.5 419.97 4-9-4 4-4-4 4 9z"></path></svg><figcaption class="caption">AppSync gets access to the table via an IAM Role</figcaption></figure><p>To configure permissions, first create an IAM role and define that AppSync will use it in its <strong>trust policy</strong>:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2012-10-17"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Principal"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"Service"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"appsync.amazonaws.com"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sts:AssumeRole"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span></code></pre><p>Then give access in the role's <strong>permissions policy</strong> to what resources the data source needs:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2012-10-17"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Sid"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"dynamodb:Query"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"arn:aws:dynamodb:...:table/..."</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span></code></pre><p>Finally, configure the role for the data source:<figure class="image prevp"><img srcset="/assets/CwuAZGF0YV9zb3VyY2Vfcm9sZUAzLnBuZyUD.8ce493e72888d1d780396f115aff6218106a03fb.png 3x, /assets/iw2AZGF0YV9zb3VyY2Vfcm9sZUAzLnBuZyV3LTc2OAM.3fb39656b4ba44fe100990455726b71f943cb3b9.png, /assets/Cw6AZGF0YV9zb3VyY2Vfcm9sZUAzLnBuZyV3LTExNTID.bc9048a4cdbcbb8e6ad9c0d3d94ec4ef53c36f44.png 1.5x"title="The IAM role can be configured for a DynamoDB data source"><figcaption class="caption">The IAM role can be configured for a DynamoDB data source</figcaption></figure><div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Note</div><div class="tbox-body"><p>You can configure a different role for each data source. This makes it possible to segment the permissions, for example, give only access to one table per data source.</div></div></div><p>So, the full flow for resolving a field:<ul><li>AppSync runs the request mapping template that produces a JSON<li>it assumes the role configured for the data source and gets temporary credentials<li>invokes the data source<li>then it runs the response mapping template passing the data source's result as the <code>$ctx.result</code><li>the result is the JSON that the template produces</ul><div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Note</div><div class="tbox-body"><p>Data sources are AppSync-related APIs that interact with external resources.</div></div></div><p>What data sources are available?<p>The <a href="https://docs.aws.amazon.com/appsync/latest/devguide/resolver-mapping-template-reference.html">documentation page</a> shows a list of them:<figure class="image prevp"><img srcset="/assets/CwuAZGF0YV9zb3VyY2VfZG9jc0AzLnBuZyUD.a979a6ee19e337ae0acc2e16617ef36a6d52224c.png 3x, /assets/iw2AZGF0YV9zb3VyY2VfZG9jc0AzLnBuZyV3LTI3MwM.56420c945a8a02533f11f98d34ec532e801bece2.png, /assets/iw2AZGF0YV9zb3VyY2VfZG9jc0AzLnBuZyV3LTQwOQM.7c8830da9efe008db0d466a108da70ac5d9b6554.png 1.5x"title="Documentation page for the data sources"><figcaption class="caption">Documentation page for the data sources</figcaption></figure><p>And to see what structure each data source needs and what it returns check the individual documentation page (for example, <a href="https://docs.aws.amazon.com/appsync/latest/devguide/resolver-mapping-template-reference-dynamodb.html">this</a> for DynamoDB).<p>In the next chapters we'll see how some of the most useful data sources work.<div class="tcolorbox tcolorbox-secondary my-5"><div class="tbox-header fw-bold">Master AppSync and GraphQL</div><div class="tbox-body"><div>Support this book and get all future updates and extra chapters in ebook format.</div><div class="d-flex justify-content-center"><a role="button"href="https://tsallai.gumroad.com/l/graphql-on-aws-appsync-book"class="btn btn-primary not-styled mt-3 text-white">Buy the book</a></div></div></div><div class="pagination row"><div class="col-6"><a href="/aws-appsync/api-configuration/waf/"class="border rounded d-block p-3"><div class="pagination-sublabel text-muted small">Previous</div><div class="pagination-title">&lt; WAF</div></a></div><div class="col-6"><a href="/aws-appsync/data-sources/lambda-1/"class="border rounded d-block p-3 text-end ms-auto"><div class="pagination-sublabel text-muted small">Next</div><div class="pagination-title">Lambda &gt;</div></a></div></div><footer>Â© TamÃ¡s Sallai - <a href="https://advancedweb.hu">advancedweb.hu</a></footer></div><div class="col-lg-3 d-none d-lg-block"><div class="toc-container"><a style="margin-left: 0em"href="#defined-data-sources">Data sources</a></div></div></div></div></div><script src="/assets/main.077454cb0bffe3695e9176b1b5f8a7fd9676d920.js"></script>