<!doctypehtml><html lang="en"><meta charset="utf-8"><link rel="icon"type="image/svg+xml"href="/assets/favicon.15621087ab873d484cfdc234ae6d4f0559d2ece6.svg"><meta name="viewport"content="width=device-width,initial-scale=1"><link href="/assets/main.d3c4fd66da45b5fe1b587fd7bc4b64cc7a34bcf3.css"rel="stylesheet"><title>Lambda - Data sources - Building GraphQL APIs with AWS AppSync</title><nav class="navbar navbar-light"><div class="container-fluid flex-nowrap"><a class="navbar-brand"href="/">Building GraphQL APIs with AWS AppSync</a> <button class="navbar-toggler d-lg-none align-self-start"type="button"data-bs-toggle="offcanvas"data-bs-target="#offcanvasNavbar"aria-controls="offcanvasNavbar"><span class="navbar-toggler-icon"></span></button><div class="offcanvas offcanvas-end"tabindex="-1"id="offcanvasNavbar"aria-labelledby="offcanvasNavbarLabel"><div class="offcanvas-header"><h5 class="offcanvas-title"id="offcanvasNavbarLabel">Building GraphQL APIs with AWS AppSync</h5><button type="button"class="btn-close text-reset"data-bs-dismiss="offcanvas"aria-label="Close"></button></div><div class="offcanvas-body keep-scrolltop"><ul class="nav navbar-nav justify-content-end flex-grow-1 pe-3"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link active"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ðŸš§</span><li class="nav-item"><span class="nav-link">RDS ðŸš§</span><li class="nav-item"><span class="nav-link">None ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ðŸš§</span><li class="nav-item"><span class="nav-link">Authorization ðŸš§</span><li class="nav-item"><span class="nav-link">Error handling ðŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ðŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ðŸš§</span><li class="nav-item"><span class="nav-link">CDK ðŸš§</span><li class="nav-item"><span class="nav-link">Amplify ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ðŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul></div></div></div></nav><div class="d-flex flex-row"><ul class="nav flex-column navigation flex-shrink-0 flex-nowrap overflow-auto d-none d-lg-flex keep-scrolltop"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link active"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ðŸš§</span><li class="nav-item"><span class="nav-link">RDS ðŸš§</span><li class="nav-item"><span class="nav-link">None ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ðŸš§</span><li class="nav-item"><span class="nav-link">Authorization ðŸš§</span><li class="nav-item"><span class="nav-link">Error handling ðŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ðŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ðŸš§</span><li class="nav-item"><span class="nav-link">CDK ðŸš§</span><li class="nav-item"><span class="nav-link">Amplify ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ðŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul><div class="flex-grow-1 main container-fluid"><div class="row"><div class="col-lg-9 body p-3"><div class="d-lg-none mb-4"><div class="accordion"id="accordionExample"><div class="accordion-item"><h2 class="accordion-header"id="mobile-toc-header"><button class="accordion-button collapsed"type="button"data-bs-toggle="collapse"data-bs-target="#mobile-toc"aria-expanded="true"aria-controls="mobile-toc">In this chapter</button></h2><div id="mobile-toc"class="accordion-collapse collapse"aria-labelledby="mobile-toc-header"data-bs-parent="#accordionExample"><div class="accordion-body"><div class="toc-container"><a style="margin-left: 0em"href="#lambda-1">Lambda</a> <a style="margin-left: 1em"href="#configuring-the-data-source">Configuring the data source</a> <a style="margin-left: 1em"href="#event-object">Event object</a> <a style="margin-left: 2em"href="#direct-lambda-resolver">Direct Lambda resolver</a> <a style="margin-left: 1em"href="#result-object">Result object</a> <a style="margin-left: 2em"href="#errors">Errors</a> <a style="margin-left: 1em"href="#use-only-one-lambda-function">Use only one Lambda function?</a></div></div></div></div></div></div><h3 id="lambda-1">Lambda</h3><p>(<a href="https://docs.aws.amazon.com/appsync/latest/devguide/resolver-mapping-template-reference-lambda.html">Official docs</a>)<p>The Lambda data source calls the configured Lambda function and returns its result. This is the most versatile data source, as a Lambda function can do any processing, such as getting items from databases, call other functions, and even interact with third-party resources. Because of this, it's a best practice to implement complex functionality with a Lambda data source.<h4 id="configuring-the-data-source">Configuring the data source</h4><p>To add the data source, you'll need two things: the <strong>Lambda function</strong> that AppSync will call and a <strong>role</strong> that gives permission to do that. As usual, the role needs to allow the AppSync service in its trust policy:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2012-10-17"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Principal"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"Service"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"appsync.amazonaws.com"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sts:AssumeRole"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span></code></pre><p>Then it needs to allow the <code>lambda:InvokeFunction</code> in its <strong>permissions policy</strong>:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2012-10-17"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Sid"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"lambda:InvokeFunction"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"arn:aws:lambda:...:function:..."</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span></code></pre><p>Notice that there are two layers of permissions working here. First, <strong>AppSync uses a role to call the Lambda function</strong>. But then <strong>the Lambda function uses another role to access resources</strong> in the account, such as databases or other functions.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"height="575"preserveAspectRatio="none"style="width:570px;height:575px;background:#fff"viewBox="0 0 570 575"width="570"><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M26.5 7h132v118.922h-132z"></path><image height="64"width="64"x="60.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADOUlEQVR4Xu2ZsWocMRCG/cB5g7xBnsC1m1Rp4zpFOneGdALbXGE4MOTgCoNh87M/OyialTSzq4tyIPFj1ruz0nwjzUhe34RPt1etG33rujQAemsA9NYA6K0B0FsDoLcaAzx/vjt+/XF+fHp/OX78Pk9zwwWEm2/fH15v7/Vbe9QGgH6Lx3QaDHCaMJA8Qjv9/HX48k33s0ENABBXcRqeIcbg0WYQnIaxwMBY23i1CwAOMerwCTOgDXLCi5gZ1ys5bQeQwDfxY7M2AtB7BD63Wv6ZtgBg7cJ7rIHu3ocNAFgw9F4/2inWX8ytq0D5ANA1q80lYh9XYcbIAuMDYAWsdkqxYkK40E8TMTRssIf3cq2NYzkAuHiqPVL0gHsww6ltYsnKnKKyBqrqVDsA6E21x7CEU/YpJn153ug6Ouco2iAnKwD2V3v4GU7xmDzl7YJHD3nXfmSyAjCKlvAHRctNo+ATupUZi68tsgJM87al7+fEdOdhrvounI4LDk+y2mxVJgCuAeP6oThj0lzvcsbKOSMyAXBJFNZAIgJL1L156RrOBOAKSVhKitgzL8tJHMs14SYArgd9f1WMX5yFLI7lNEiU9FBQewCmb1KvqoUoUTeA3G7N4mifhMYAjF9hEzjMfytiyMJuzSjg52n+s1MbxGoMUN4d+VRa7tiTmBX843TpaVyVCaBwFuBgiDoPXqw/GnXVLFfWWAZWh9MyAXB4CS1+lbGTwYiaa4lZLsauqm0CCEtp53U8QOIKed6XL0KxtFkuxqxj+v6qrABxGsQwYRkPzh2Xb1urScxHVbNLHebiOjj9namYBDKw6QQQM/o9zcmQMysXDK0KQBwk1kGuH7184R8TVHfiMvMenCoAjMd5+S4rYTZmmFfeU1OoAsBprvikacv9klKrHxVUARAd5r2WMPYMc4mJZF/9lBXg0pIE04/K+i8AOLFxZbOrM4AcK7Z5H/oCyPFuT1I1AEDanZz/MsIrTNnCjmZUAwDmH5cBgpojwWohquzHuC7saEY1AAhzkU22i/g8x+888gjXqDb7XafaAFASYzideEyeN8Pncq9aAnTRAOitAdBbA6C3BkBvDYDeunqAPxdjffOs6ZOIAAAAAElFTkSuQmCC"y="17"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="112"x="36.5"y="112.148">AppSync API</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M7 451h169v118.922H7z"></path><image height="64"width="64"x="59.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADxUlEQVR4Xu1asYrcMBC9H58yjcs026W6Kt02KV2k3SLtQkgRyJFAIMWFFIGA76GHB63Glmdks86BxeO4s2XpvdHMaGTfg7z58qrxYC+9LhwC9sYhYG8cAvbGISChe/v19O7b4/sf5w8/FfgTF3HL9t8Q7QJA8fLp+en738HRnn//Q2c8srmesADYNSeN38Gs//gL5GDvAriIW4XO6+c/dthmBATAeMoDnKDE9qkDkqjW3mqGVwDmJvVtp18PrwA4Mdg3ezAehPJFNKyqSwCmX2l7Z6yj2WfrcAmg/zQHH+w6JP0wxBw4BSLEPl5HQEDbBDKa317PAXnog4nsrToCAhgG+InkaPvMQc1vb+XAsNBpry8iIID7K2UMaQcArUWbecxPkSG7KGIC+CfmQzyoEjaaENe542rPwWF+j8g5tAhQIPhAEfzAGyQAyAA03D3MmOLaokuiAjgZ+HkSttP8DF+WJIrFpxQuAWok/IKfo9cs7Gse8wP5gHmrD65wCZCRTe7c9UV3mr8ASDO0PCtMeAVwEYbkP4uZR8bSQ88GRN2oDezFL0A9lTIwUyWHqtqi1fdyDh5iL34BQ2IvY1mW51CmHUae2pjVgQLmH6oeVbioHy4BzELF9KB4Hg9lqmduTeqVQjN7CQkAS3vLCe4P9rqsYy8hAdQQ9VGpVuPwvblbTgQEcLIhBcNiSskx5z/r2UtIAFc5j2CG7zl7g5IHsT7OICnG3IS9NAjQK5hbs+pkY3/6T7HrkX19K3QiLMDGQJdKOm5VfXbApc8wgeb+w9phE/YSFaDRfHG/Vikqopw9E7E/libhEiDZRsbDAGXYbgUK/yF73Y85zp0EMJNAg87nWQH6D3tyBLLHIFuFgVcAbcmGWW1OnARZyi179cNhtfnFL4Cu3KfDl06vOXSOB/vk7Ak+OIxuuQYuAYUrd6mey5WwsV7Q3ZpHAiqfJDq3wYXgEsBFn/TXU/os0KdX0CzsAApQhZPsZRTgiaUKAgKik9XZc32iY1rEBAzuE5n6j73V3R6s7yeAfsJZn5beapFlMUhefWgc30+A1jb9/ImsT59qtKbAxWt6ZZR3vqS3GzKu0r0FKFgIkGKup2gqz1YN+wi4Vt9qddkbc3u3wP0EcB+g06tpJ7NqCLZQbYBLgNx+YsLERY3ZgC69BbIHnSi8AtT2/eozlIy2X29+8QuQZDPNJxf3eSDHKX1m5Qiw/Xr2EhJAPK7+0K21xiYIC1Awh+bMKo06bSZdj3YBObrX+M8e/wkOAXvjELA3DgF74xCwN14AdzgE4KRN4cQAAAAASUVORK5CYII="y="461"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="149"x="17"y="556.148">DynamoDB Table</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M43.5 215h98v118.922h-98z"></path><image height="64"width="64"x="60.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADcElEQVR4Xu1Yy2pcMQzNn3bVZVfddtN1F1130X2h+0I/oPQHkg+4bSAQAiUDYSAQpgeLEWckW/Z9DM6AD2K4Y8vXOrIk2/fqcOG4sg2XhkGgNwaB3hgEemMQ6I1BoDcGgd44O4GXx0fI/vrm6ddv/ELw1yqtwFkIwMp/377fffg4vXlbEvRCB5p28ExsSQCuffjy1dtaFYx6/vPXvq4N2xDA9PefPnvL0Ajjdj9+In4geIDX0VJSXkBjLQHv9dt372FoiykSadDn4WixeiFWEYAFPDfCellMY3GYBp5b+AuWE4CbeUopL2jEgoCJMQgtEkuBZYYG/lqNHBYSwELrTIhdHwmxQD/LBC7g9ABhq+GwhEBLqYHLJYPxaxaEdbI0eG2rHGYT4LcbgbnxPpXNWozyQxA/qhDH0jwCJmtFYFA8hwfeYyqpz37mkF0owQwC8JOPhLmmM2A079Y+WnS1oWa6FDMI+N0ncEw7uB74TUAn9V2CVgKw9RzWCzgyzTpg2bXLp8qhnYA5mfmQXQnmYMJSAwnpzu2CJgLG/aXVXAnmYJytuecXoYkAF368y3ZvB3U2Qj/b7n3XRIDdv3nwGGismolK7qsT4JUNytlW0HA1c2kUmOJRJ8Dx40v1OaClk23Vfc3YUCfA9cfnkAGmxEx6awlOQdDJboIyXNTwBvwVGlpPTXrUCfCstu8IhFnW0BYRKw+FnV5EFKTXpEGFAO8j2TIs8NuciNwE5FiqYrYUlVK7vIfPHRwIFQJsWZwAd8crS3wgVcjtxx9PpuTvffoAYw5LLDpFhUCwQW4FYVLKtBIBNaZCgE//y3aAl/RhCysJiVdGcxcBo8IWwwC1R8OhSODp9IY65XZBD6lCEuiljEQ7FPx6lhJpovRTnYgA+oK5/XU2iOaqPJx+0tqni44RdlyFAAcMT+Dbp1Q0pNj7rom+RGB6DBfBM/S9d6AZVwhFRIB33CkFDIcsnvnmkRUYt0tVSEeV4BNXxCyIKu/Tt+Fd+mYjmpZAe7n0qwE7fEA3AvMax4mYDPaibsoQkAyTci4FRNLf70G386/zJezKiedFc/rAIVSK5pK0FKW52KfvLpzBsjnu0ufh7BZ5ksS+dHq5Px5dXgkyZVSSRktHwP41IEPgsjAI9MYg0BuDQG8MAr0xCPTGINAbg0Bv/Ae3IF2lX4hXSgAAAABJRU5ErkJggg=="y="225"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="78"x="53.5"y="320.148">IAM Role</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M360.5 451h98v118.922h-98z"></path><image height="64"width="64"x="377.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADcElEQVR4Xu1Yy2pcMQzNn3bVZVfddtN1F1130X2h+0I/oPQHkg+4bSAQAiUDYSAQpgeLEWckW/Z9DM6AD2K4Y8vXOrIk2/fqcOG4sg2XhkGgNwaB3hgEemMQ6I1BoDcGgd44O4GXx0fI/vrm6ddv/ELw1yqtwFkIwMp/377fffg4vXlbEvRCB5p28ExsSQCuffjy1dtaFYx6/vPXvq4N2xDA9PefPnvL0Ajjdj9+In4geIDX0VJSXkBjLQHv9dt372FoiykSadDn4WixeiFWEYAFPDfCellMY3GYBp5b+AuWE4CbeUopL2jEgoCJMQgtEkuBZYYG/lqNHBYSwELrTIhdHwmxQD/LBC7g9ABhq+GwhEBLqYHLJYPxaxaEdbI0eG2rHGYT4LcbgbnxPpXNWozyQxA/qhDH0jwCJmtFYFA8hwfeYyqpz37mkF0owQwC8JOPhLmmM2A079Y+WnS1oWa6FDMI+N0ncEw7uB74TUAn9V2CVgKw9RzWCzgyzTpg2bXLp8qhnYA5mfmQXQnmYMJSAwnpzu2CJgLG/aXVXAnmYJytuecXoYkAF368y3ZvB3U2Qj/b7n3XRIDdv3nwGGismolK7qsT4JUNytlW0HA1c2kUmOJRJ8Dx40v1OaClk23Vfc3YUCfA9cfnkAGmxEx6awlOQdDJboIyXNTwBvwVGlpPTXrUCfCstu8IhFnW0BYRKw+FnV5EFKTXpEGFAO8j2TIs8NuciNwE5FiqYrYUlVK7vIfPHRwIFQJsWZwAd8crS3wgVcjtxx9PpuTvffoAYw5LLDpFhUCwQW4FYVLKtBIBNaZCgE//y3aAl/RhCysJiVdGcxcBo8IWwwC1R8OhSODp9IY65XZBD6lCEuiljEQ7FPx6lhJpovRTnYgA+oK5/XU2iOaqPJx+0tqni44RdlyFAAcMT+Dbp1Q0pNj7rom+RGB6DBfBM/S9d6AZVwhFRIB33CkFDIcsnvnmkRUYt0tVSEeV4BNXxCyIKu/Tt+Fd+mYjmpZAe7n0qwE7fEA3AvMax4mYDPaibsoQkAyTci4FRNLf70G386/zJezKiedFc/rAIVSK5pK0FKW52KfvLpzBsjnu0ufh7BZ5ksS+dHq5Px5dXgkyZVSSRktHwP41IEPgsjAI9MYg0BuDQG8MAr0xCPTGINAbg0Bv/Ae3IF2lX4hXSgAAAABJRU5ErkJggg=="y="461"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="78"x="370.5"y="556.148">IAM Role</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M365.5 215h88v118.922h-88z"></path><image height="64"width="64"x="377.5"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAEJ0lEQVR4XtVay44UMQzk2/kDPoEfQOLGFc4cuHGF82il0UojrVZamai91Lj9qCTdvYIu+TB0EqfKdpxmdt7JyfHOPzgb3krA8+WXMz/jIBwmoFF8/P75+u3j5dN7Ym1Cm3agnr0Cnn7/6JKurC1sy73HSWwXcPv59eHLB8epPdEYt9FGDtb+qflJl7RR730YWwS0/dJYvtyufmqGNi3N2zYZcwJa7doQavAGeUe0hS6N7fPs8ZgQ4AK/LWAp9ngeFWAz3qpZH9oqr2w8P80ttmjb+eECQwIse6Q4HsfKnoZbTXOOVYMa+gJAtH2w4YxEK2sLjb8O2hZ2Rz8c0BGA2Md44HksGxiWzx5Nsq8DE8C96BDOQ4oWTuKBg+8OlALQGao8jggQw2M2CWKql/SlXIA9TFUbGRQAVzyQKZBAoj8XAOnVMhkWICYJVSwIoL8qhEQAioeTQ1wbLZiftAAkuMMKuB/SQkoE6OxmfmANTHOWboOUViI5CCUvAOFPeViQiyyybC110G0KwsoLUFpVwVnoq5g1nmsI9gNjqIitBOyMk1CWO50jCe7FZCVgT7tQcJY6FKM4gupOXAlIZ8yCsKyiOAjE1z68C0Cz2+Yd4CyJvC6QXns73QXgCG6oH40NGBOW2IVckRVQRfY+uQtQEumuHPGyBMuYhKqUB6FNwq69C9jsF6UJxmCZhmNPEuIx8AJmb3v72mcZE5Z7kgC3ePIqAE7T9keAkOCDS0LKcnO/RofAwlcB21qQfVWOZUNYbn69i41olwBQVHeubDhL3NlRHsGRAmKRTCUBVFJ5FY4UkB7TbUnwAzVKAbOHOIa/ek5Ygs3gpkIOsUy20TT86RBnqfLS6yJF2UZl5iKLtW4Ry4Ykgb84RbCLTMdSTg4IQ7pr5IQnaRJ0aGRf4a8SoBU7hgPfMh1NHypsOF7olwPIvK3zu4DBRhQDnI66YJNVoGUtPYqxBYkVIGPHQOeksRRa7mQhkgBLp8UDIE4AuXcUJJDSazikccmy9rZ8M1D1pdigFSsBnIH0uh4Jv9QMHKotqtitBEi9XnryMJqWr4InQVERqJ57AdUplF6AMVqVn4wlISVKWHkB8ve0OaI8/PHyqtA9ZqmAlJIiEQC5lg0Pf5cW0JUaBaDw0tglAsTQde8z3CpODlBLDAIgOFa/IheAZZclqMgJt274FdZ5ZXpI7B1XnftcgJhCelj+ONmiyy29GSrclm+CiWksUAhp8ShKAbL+D7sfe3sM7s4EyLCXwzG+b0eAmDxqLfnho/Fy7B+6FbZvVIfpENjz3Y29YkiArDU8jrXLWTyad9JB9jIuQExfUiOdYRZ7PE8IkCXFKNDLUqO3E/3gCYj32vUsPzmzcMFDCK///4/+LNJYDprmzXucxF4BwPNJf/ha4fl0Pz3+Vzi9gD85rbGUz+zZ3wAAAABJRU5ErkJggg=="y="225"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="68"x="375.5"y="320.148">Lambda</text><path d="M92.5 126.26v83.15"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m92.5 214.67 4-9-4 4-4-4 4 9z"></path><text fill="#666"font-family="sans-serif"font-size="12"textLength="207"x="93.5"y="168.139">Service:appsync.amazonaws.com</text><text fill="#666"font-family="sans-serif"font-size="12"textLength="142"x="93.5"y="182.107">Action:sts:AssumeRole</text><path d="M141.68 274.5h218.36"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m365.32 274.5-9-4 4 4-4 4 9-4z"></path><text fill="#666"font-family="sans-serif"font-size="12"textLength="187"x="160"y="268.639">Action:lambda:InvokeFunction</text><path d="M409.5 334.25v111.41"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m409.5 450.73 4-9-4 4-4-4 4 9z"></path><text fill="#666"font-family="sans-serif"font-size="12"textLength="49"x="410.5"y="376.139">Service:</text><text fill="#666"font-family="sans-serif"font-size="12"textLength="152"x="410.5"y="390.107">lambda.amazonaws.com</text><text fill="#666"font-family="sans-serif"font-size="12"textLength="43"x="410.5"y="404.076">Action:</text><text fill="#666"font-family="sans-serif"font-size="12"textLength="99"x="410.5"y="418.045">sts:AssumeRole</text><path d="M181.5 510.5h178.59"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m176.3 510.5 9 4-4-4 4-4-9 4z"></path><text fill="#666"font-family="sans-serif"font-size="12"textLength="148"x="194.25"y="504.639">Action:dynamodb:Query</text></svg><figcaption class="caption">Lambda data source permissions</figcaption></figure><div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Note</div><div class="tbox-body"><p>Use environment variables for the Lambda function to pass configuration to the function, such as the name of DynamoDB tables, S3 bucket names, and other non-changing values.</div></div></div><h4 id="event-object">Event object</h4><p>In the request mapping template you can define what the Lambda function gets in the <code>event</code> object. For example, this template passes the field arguments and an constant text to the function:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2018-05-29"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"operation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Invoke"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"payload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"arguments"</span><span class="hljs-punctuation">:</span> $util.toJson($ctx.arguments)<span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"extra_data"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"something else"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><p>For a field, such as <code>field(fieldArg: String)</code>, the <code>event</code> object will be:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"arguments"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"fieldArg"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"arg1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"extra_data"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"something else"</span>
<span class="hljs-punctuation">}</span></code></pre><p>This gives a flexible structure: the Lambda function can do a specific thing and the AppSync resolver calls it with the appropriate arguments. For example, you might need to create Cognito users in various parts in the API. For this, you can write one function that gets the email address and other required parameters and create the user. Then the mapping templates can adapt the GraphQL arguments to the Lambda. This is especially useful for mutations.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Batching</div><div class="tbox-body"><p>The Lambda function runs for every value that can result in several calls for a single query. This usually happens when one of the upper fields in the query returns a list.<p>For example, when the users are managed by Cognito, the <code>email</code> field requires a call to the service. When this query runs:<pre class="highlight prevp"><code><span class="hljs-keyword">query</span> project {
  users {
    email
  }
}</code></pre><p>AppSync first resolves the <code>project</code> field, then moves to the <code>users</code>. This returns a list, so the <code>email</code> resolver runs for every single user in the result list. If a project has 100 users, that means there are 100 Lambda calls.<p>Batching is a performance boost in cases like this one: instead of calling the function for every single item, AppSync groups the requests into batches and sends a list.<p>See more in the <a href="https://docs.aws.amazon.com/appsync/latest/devguide/tutorial-lambda-resolvers.html#advanced-use-case-batching">official docs</a>.</div></div></div><h5 id="direct-lambda-resolver">Direct Lambda resolver</h5><p>(<a href="https://docs.aws.amazon.com/appsync/latest/devguide/resolver-context-reference.html">Official docs</a>)<p>Lambda is a special data source as the request and the response mapping templates are optional. If the request template is missing, the whole context object is passed to the Lambda function as the <code>event</code>.<p>To extract the various parts, it's best practice to destructure the incoming object:<pre class="highlight prevp"><code><span class="hljs-built_in">exports</span>.<span class="hljs-property">handler</span> = <span class="hljs-keyword">async</span> (event, context) =&gt; {
  <span class="hljs-keyword">const</span> {<span class="hljs-variable language_">arguments</span>, prev, stash, identity, source, info} = event;

  <span class="hljs-comment">// ...</span>
};</code></pre><p>The various fields:<ul><li><code>arguments</code>: the arguments passed to the field<li><code>prev</code>: in case of a pipeline resolver, this is the result of the previous step<li><code>stash</code>: in a pipeline resolvers, this is the stash<li><code>identity</code>: contains information about the caller user<li><code>source</code>: the parent object (if any)<li><code>info</code>: information about the GraphQL query for this field</ul><p>For example, a unit (non-pipeline) resolver might get these values:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"arguments"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user@example.com"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"identity"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"accountId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"..."</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"projectId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"abc123"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"info"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    fieldName<span class="hljs-punctuation">:</span> <span class="hljs-string">"searchUser"</span><span class="hljs-punctuation">,</span>
    parentTypeName<span class="hljs-punctuation">:</span> <span class="hljs-string">"Project"</span><span class="hljs-punctuation">,</span>
    selectionSetGraphQL<span class="hljs-punctuation">:</span> <span class="hljs-string">"{\n	id\n}"</span><span class="hljs-punctuation">,</span>
    selectionSetList<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"id"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"prev"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"stash"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Direct Lambda resolver or template?</div><div class="tbox-body"><p>Using a mapping template provides greater reusability for the function but direct Lambda resolvers take less mental space.</div></div></div><h4 id="result-object">Result object</h4><p>Whatever the function returns will be available in the response mapping template at <code>$ctx.result</code>. Here, you can do arbitrary transformations, such as adding or removing fields in objects, or calculate values based on the response.<p>As with the request, the response mapping template is optional. If it is missing, the resolver returns with whatever the Lambda returned with. This is equivalent to <code>$util.toJson($ctx.result)</code> (apart from error handling).<h5 id="errors">Errors</h5><p>If the Lambda function throws an Exception then it will be available in the <code>$ctx.error</code> value. As a best practice, the response template should check if there was an error during resolving the field and rethrow it:<pre class="highlight prevp"><code>#if($ctx.error)
  $util.error($ctx.error.message, $ctx.error.type)
#end</code></pre><p>As for a Lambda invocation, when the function throws an Error:<pre class="highlight prevp"><code><span class="hljs-built_in">exports</span>.<span class="hljs-property">handler</span> = <span class="hljs-keyword">async</span> (event, context) =&gt; {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"ErrorMsg"</span>);
};</code></pre><p>Rethrowing it will provide a response similar to this one:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"item"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"field2"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"errors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"item"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"field2"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"errorType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Lambda:Unhandled"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"errorInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"locations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"line"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"column"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"sourceName"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ErrorMsg"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span></code></pre><h4 id="use-only-one-lambda-function">Use only one Lambda function?</h4><p>As we've seen in this chapter, the Lambda data source is extremely versatile. Without a request mapping template, it gets all the information AppSync has about the field. This prompts a question: is it possible to handle <em>all</em> resolvers with a single Lambda function?<p>This is certainly possible as the <code>info</code> contains which field the Lambda needs to resolve, so it can decide how to handle requests.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"height="310"preserveAspectRatio="none"style="width:558px;height:310px;background:#fff"viewBox="0 0 558 310"width="558"><defs><filter height="300%"id="6f24c79b88044b1e556d17545a6b28c6981c2d0fcedc34bc8b7e0067a743fa4d__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M7 7h132v118.922H7z"></path><image height="64"width="64"x="41"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADOUlEQVR4Xu2ZsWocMRCG/cB5g7xBnsC1m1Rp4zpFOneGdALbXGE4MOTgCoNh87M/OyialTSzq4tyIPFj1ruz0nwjzUhe34RPt1etG33rujQAemsA9NYA6K0B0FsDoLcaAzx/vjt+/XF+fHp/OX78Pk9zwwWEm2/fH15v7/Vbe9QGgH6Lx3QaDHCaMJA8Qjv9/HX48k33s0ENABBXcRqeIcbg0WYQnIaxwMBY23i1CwAOMerwCTOgDXLCi5gZ1ys5bQeQwDfxY7M2AtB7BD63Wv6ZtgBg7cJ7rIHu3ocNAFgw9F4/2inWX8ytq0D5ANA1q80lYh9XYcbIAuMDYAWsdkqxYkK40E8TMTRssIf3cq2NYzkAuHiqPVL0gHsww6ltYsnKnKKyBqrqVDsA6E21x7CEU/YpJn153ug6Ouco2iAnKwD2V3v4GU7xmDzl7YJHD3nXfmSyAjCKlvAHRctNo+ATupUZi68tsgJM87al7+fEdOdhrvounI4LDk+y2mxVJgCuAeP6oThj0lzvcsbKOSMyAXBJFNZAIgJL1L156RrOBOAKSVhKitgzL8tJHMs14SYArgd9f1WMX5yFLI7lNEiU9FBQewCmb1KvqoUoUTeA3G7N4mifhMYAjF9hEzjMfytiyMJuzSjg52n+s1MbxGoMUN4d+VRa7tiTmBX843TpaVyVCaBwFuBgiDoPXqw/GnXVLFfWWAZWh9MyAXB4CS1+lbGTwYiaa4lZLsauqm0CCEtp53U8QOIKed6XL0KxtFkuxqxj+v6qrABxGsQwYRkPzh2Xb1urScxHVbNLHebiOjj9namYBDKw6QQQM/o9zcmQMysXDK0KQBwk1kGuH7184R8TVHfiMvMenCoAjMd5+S4rYTZmmFfeU1OoAsBprvikacv9klKrHxVUARAd5r2WMPYMc4mJZF/9lBXg0pIE04/K+i8AOLFxZbOrM4AcK7Z5H/oCyPFuT1I1AEDanZz/MsIrTNnCjmZUAwDmH5cBgpojwWohquzHuC7saEY1AAhzkU22i/g8x+888gjXqDb7XafaAFASYzideEyeN8Pncq9aAnTRAOitAdBbA6C3BkBvDYDeunqAPxdjffOs6ZOIAAAAAElFTkSuQmCC"y="17"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="112"x="17"y="112.148">AppSync API</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M169.5 186h169v118.922h-169z"></path><image height="64"width="64"x="222"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADxUlEQVR4Xu1asYrcMBC9H58yjcs026W6Kt02KV2k3SLtQkgRyJFAIMWFFIGA76GHB63Glmdks86BxeO4s2XpvdHMaGTfg7z58qrxYC+9LhwC9sYhYG8cAvbGISChe/v19O7b4/sf5w8/FfgTF3HL9t8Q7QJA8fLp+en738HRnn//Q2c8srmesADYNSeN38Gs//gL5GDvAriIW4XO6+c/dthmBATAeMoDnKDE9qkDkqjW3mqGVwDmJvVtp18PrwA4Mdg3ezAehPJFNKyqSwCmX2l7Z6yj2WfrcAmg/zQHH+w6JP0wxBw4BSLEPl5HQEDbBDKa317PAXnog4nsrToCAhgG+InkaPvMQc1vb+XAsNBpry8iIID7K2UMaQcArUWbecxPkSG7KGIC+CfmQzyoEjaaENe542rPwWF+j8g5tAhQIPhAEfzAGyQAyAA03D3MmOLaokuiAjgZ+HkSttP8DF+WJIrFpxQuAWok/IKfo9cs7Gse8wP5gHmrD65wCZCRTe7c9UV3mr8ASDO0PCtMeAVwEYbkP4uZR8bSQ88GRN2oDezFL0A9lTIwUyWHqtqi1fdyDh5iL34BQ2IvY1mW51CmHUae2pjVgQLmH6oeVbioHy4BzELF9KB4Hg9lqmduTeqVQjN7CQkAS3vLCe4P9rqsYy8hAdQQ9VGpVuPwvblbTgQEcLIhBcNiSskx5z/r2UtIAFc5j2CG7zl7g5IHsT7OICnG3IS9NAjQK5hbs+pkY3/6T7HrkX19K3QiLMDGQJdKOm5VfXbApc8wgeb+w9phE/YSFaDRfHG/Vikqopw9E7E/libhEiDZRsbDAGXYbgUK/yF73Y85zp0EMJNAg87nWQH6D3tyBLLHIFuFgVcAbcmGWW1OnARZyi179cNhtfnFL4Cu3KfDl06vOXSOB/vk7Ak+OIxuuQYuAYUrd6mey5WwsV7Q3ZpHAiqfJDq3wYXgEsBFn/TXU/os0KdX0CzsAApQhZPsZRTgiaUKAgKik9XZc32iY1rEBAzuE5n6j73V3R6s7yeAfsJZn5beapFlMUhefWgc30+A1jb9/ImsT59qtKbAxWt6ZZR3vqS3GzKu0r0FKFgIkGKup2gqz1YN+wi4Vt9qddkbc3u3wP0EcB+g06tpJ7NqCLZQbYBLgNx+YsLERY3ZgC69BbIHnSi8AtT2/eozlIy2X29+8QuQZDPNJxf3eSDHKX1m5Qiw/Xr2EhJAPK7+0K21xiYIC1Awh+bMKo06bSZdj3YBObrX+M8e/wkOAXvjELA3DgF74xCwN14AdzgE4KRN4cQAAAAASUVORK5CYII="y="196"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="149"x="179.5"y="291.148">DynamoDB Table</text><path fill="#FEFECE"filter="url(#6f24c79b88044b1e556d17545a6b28c6981c2d0fcedc34bc8b7e0067a743fa4d__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M174.5 40h105v52.594h-105z"></path><text font-family="sans-serif"font-size="14"textLength="54"x="200"y="62.995">Lambda</text><text font-family="sans-serif"font-size="14"textLength="85"x="184.5"y="79.292">Data Source</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M315 7h88v118.922h-88z"></path><image height="64"width="64"x="327"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAEJ0lEQVR4XtVay44UMQzk2/kDPoEfQOLGFc4cuHGF82il0UojrVZamai91Lj9qCTdvYIu+TB0EqfKdpxmdt7JyfHOPzgb3krA8+WXMz/jIBwmoFF8/P75+u3j5dN7Ym1Cm3agnr0Cnn7/6JKurC1sy73HSWwXcPv59eHLB8epPdEYt9FGDtb+qflJl7RR730YWwS0/dJYvtyufmqGNi3N2zYZcwJa7doQavAGeUe0hS6N7fPs8ZgQ4AK/LWAp9ngeFWAz3qpZH9oqr2w8P80ttmjb+eECQwIse6Q4HsfKnoZbTXOOVYMa+gJAtH2w4YxEK2sLjb8O2hZ2Rz8c0BGA2Md44HksGxiWzx5Nsq8DE8C96BDOQ4oWTuKBg+8OlALQGao8jggQw2M2CWKql/SlXIA9TFUbGRQAVzyQKZBAoj8XAOnVMhkWICYJVSwIoL8qhEQAioeTQ1wbLZiftAAkuMMKuB/SQkoE6OxmfmANTHOWboOUViI5CCUvAOFPeViQiyyybC110G0KwsoLUFpVwVnoq5g1nmsI9gNjqIitBOyMk1CWO50jCe7FZCVgT7tQcJY6FKM4gupOXAlIZ8yCsKyiOAjE1z68C0Cz2+Yd4CyJvC6QXns73QXgCG6oH40NGBOW2IVckRVQRfY+uQtQEumuHPGyBMuYhKqUB6FNwq69C9jsF6UJxmCZhmNPEuIx8AJmb3v72mcZE5Z7kgC3ePIqAE7T9keAkOCDS0LKcnO/RofAwlcB21qQfVWOZUNYbn69i41olwBQVHeubDhL3NlRHsGRAmKRTCUBVFJ5FY4UkB7TbUnwAzVKAbOHOIa/ek5Ygs3gpkIOsUy20TT86RBnqfLS6yJF2UZl5iKLtW4Ry4Ykgb84RbCLTMdSTg4IQ7pr5IQnaRJ0aGRf4a8SoBU7hgPfMh1NHypsOF7olwPIvK3zu4DBRhQDnI66YJNVoGUtPYqxBYkVIGPHQOeksRRa7mQhkgBLp8UDIE4AuXcUJJDSazikccmy9rZ8M1D1pdigFSsBnIH0uh4Jv9QMHKotqtitBEi9XnryMJqWr4InQVERqJ57AdUplF6AMVqVn4wlISVKWHkB8ve0OaI8/PHyqtA9ZqmAlJIiEQC5lg0Pf5cW0JUaBaDw0tglAsTQde8z3CpODlBLDAIgOFa/IheAZZclqMgJt274FdZ5ZXpI7B1XnftcgJhCelj+ONmiyy29GSrclm+CiWksUAhp8ShKAbL+D7sfe3sM7s4EyLCXwzG+b0eAmDxqLfnho/Fy7B+6FbZvVIfpENjz3Y29YkiArDU8jrXLWTyad9JB9jIuQExfUiOdYRZ7PE8IkCXFKNDLUqO3E/3gCYj32vUsPzmzcMFDCK///4/+LNJYDprmzXucxF4BwPNJf/ha4fl0Pz3+Vzi9gD85rbGUz+zZ3wAAAABJRU5ErkJggg=="y="17"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="68"x="325"y="112.148">Lambda</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M373.5 186h179v118.922h-179z"></path><image height="64"width="64"x="431"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADA0lEQVR4Xu2YzWrcMBSF88JZdZtN1l103UX2ge4LfYDSF2hfoBEEimFIoAwEBuWggy83uhpJ45GsCbE5DI4sS/eT7o+cK3f96V3ryja9L20Ao7UBjNYGMFobwGh9AIDd/bf97z8vfx9W0/+fvx5vbq0lSRUAMJb3/vD0ZKfpJ85ojUkqB4BlwFhYfvuoq7DnmBe/9pFVDoADTV/v7KPeql+4MsC/z1/so96CCw0DoOMtuxByHGQkAPrjLcTi8/cfJ4lvcZDxADDIPnJhf2wjxVwn9xcHgBaYRVeBoTY39ALALyarF9+KAJjdX0KRgmXEiBIlATiIb5iFll0agNVQt8CRiKS3V/aHVzOA83fAq+gU0dMk7bh+O3BmDDCrakNFkZW9YuCjA7g5gqMEKv4pLZcLQJ+GcTIURz68PXL2BWClPHZpU6wLSd6MLry13g5gFTHiMWkX1wBcex9iAPdoZH+MDDFvwmh6V1+AegkAb2BKZgRuLO2+OAAucObwQ5EB+4MXZa72ALDDKmrnW7Lw3hwWjsmuUXuAZBDrdpmPAN4kmZPUHgC/jDwt3T7Np0sBSBavSrUHqJcA1PgPHI/ZCUJ/mUvHQ17tAR6zn5TSDcPuU/UhKg5FtQdwITBsrdircsGRfYgc5h9g41dylxSHoroA5MVh9cki2QEkNQw5ANbRkza0KDkX2UcLurk8gAvZgAzyvbJMspbJk2lSTNDF5SsAYJfJcOZFb5nCuuqDqtUUvul4j6mLxaQA4OZMx2S/WFxyfhxnlp+E4v3chEx/VwPQUPCfzIqK9RLcbJnMP2C01gaQuGQdkEfWemncZcNgGIA+SCetl/YLAmDpFZ8WhqT10sG2a60KsAsVSvs0TUxa70oxQ60KwGNSZJOuElG7rzjSrgrg5k0omgUk1p8km9baAG6OhAyDVM98AqUGALiZ4RBOznqNYTqLXaX1bhSAe/uNyiOD/Jk5qFoNA3DB0bEDWHLWB2zLc/hnjO2Z0UiAJtoARmsDGK0NYLQ2gNHaAEbrFYLmtZPciPaJAAAAAElFTkSuQmCC"y="196"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="159"x="383.5"y="291.148">Cognito User Pool</text><path d="M139.17 66.5h29.8"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m174.17 66.5-9-4 4 4-4 4 9-4z"></path><path d="M279.59 66.5h30.12"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m314.95 66.5-9-4 4 4-4 4 9-4z"></path><path d="M324.04 126.44c-10.45 17.61-21.95 36.99-32.55 54.87"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m288.81 185.82 8.024-5.71-5.479 1.406-1.407-5.479-1.138 9.783z"></path><path d="M393.63 126.44c10.35 17.61 21.74 36.99 32.24 54.87"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m428.52 185.82-1.1-9.787-1.428 5.473-5.474-1.428 8.002 5.742z"></path></svg><figcaption class="caption">One Lambda function for all fields</figcaption></figure><p>There are several advantages to this approach. First, <strong>Lambda cold starts are rarer</strong> as more requests invoke the same function. This helps keeping the response times to vary a bit less.<p>Then with a single function there are <strong>fewer AppSync resources</strong> that you need to deploy. I've found that for a medium-sized schema the resolvers and the data sources can span hundreds of resources and that can slow down deployment and eventually hit CloudFormation's 500 resources limit.<p>Finally, using a Lambda function to back the whole API <strong>gives you familiar tools and greater control</strong> over how things are working. One of AppSync's greatest weakness is its reliance on a lot of foreign concepts. Starting out with a single Lambda function and a schema while still getting all the benefits of GraphQL is an easy way to get up to speed with AppSync.<p>The other end of the spectrum is to write several Lambda functions and also take advantage of other data sources and the pipelining feature of AppSync. For example, a DynamoDB data source with appropriate resolvers can read data from tables, a Lambda resolver can interact with Cognito and another one with SNS.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"height="489"preserveAspectRatio="none"style="width:528px;height:489px;background:#fff"viewBox="0 0 528 489"width="528"><defs><filter height="300%"id="1840ec2994baace12ffdfc01ef921ab1ed2522229c00823497d7f0e1588eb91c__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M7 186h132v118.922H7z"></path><image height="64"width="64"x="41"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADOUlEQVR4Xu2ZsWocMRCG/cB5g7xBnsC1m1Rp4zpFOneGdALbXGE4MOTgCoNh87M/OyialTSzq4tyIPFj1ruz0nwjzUhe34RPt1etG33rujQAemsA9NYA6K0B0FsDoLcaAzx/vjt+/XF+fHp/OX78Pk9zwwWEm2/fH15v7/Vbe9QGgH6Lx3QaDHCaMJA8Qjv9/HX48k33s0ENABBXcRqeIcbg0WYQnIaxwMBY23i1CwAOMerwCTOgDXLCi5gZ1ys5bQeQwDfxY7M2AtB7BD63Wv6ZtgBg7cJ7rIHu3ocNAFgw9F4/2inWX8ytq0D5ANA1q80lYh9XYcbIAuMDYAWsdkqxYkK40E8TMTRssIf3cq2NYzkAuHiqPVL0gHsww6ltYsnKnKKyBqrqVDsA6E21x7CEU/YpJn153ug6Ouco2iAnKwD2V3v4GU7xmDzl7YJHD3nXfmSyAjCKlvAHRctNo+ATupUZi68tsgJM87al7+fEdOdhrvounI4LDk+y2mxVJgCuAeP6oThj0lzvcsbKOSMyAXBJFNZAIgJL1L156RrOBOAKSVhKitgzL8tJHMs14SYArgd9f1WMX5yFLI7lNEiU9FBQewCmb1KvqoUoUTeA3G7N4mifhMYAjF9hEzjMfytiyMJuzSjg52n+s1MbxGoMUN4d+VRa7tiTmBX843TpaVyVCaBwFuBgiDoPXqw/GnXVLFfWWAZWh9MyAXB4CS1+lbGTwYiaa4lZLsauqm0CCEtp53U8QOIKed6XL0KxtFkuxqxj+v6qrABxGsQwYRkPzh2Xb1urScxHVbNLHebiOjj9namYBDKw6QQQM/o9zcmQMysXDK0KQBwk1kGuH7184R8TVHfiMvMenCoAjMd5+S4rYTZmmFfeU1OoAsBprvikacv9klKrHxVUARAd5r2WMPYMc4mJZF/9lBXg0pIE04/K+i8AOLFxZbOrM4AcK7Z5H/oCyPFuT1I1AEDanZz/MsIrTNnCjmZUAwDmH5cBgpojwWohquzHuC7saEY1AAhzkU22i/g8x+888gjXqDb7XafaAFASYzideEyeN8Pncq9aAnTRAOitAdBbA6C3BkBvDYDeunqAPxdjffOs6ZOIAAAAAElFTkSuQmCC"y="196"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="112"x="17"y="291.148">AppSync API</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M160.5 365h169v118.922h-169z"></path><image height="64"width="64"x="213"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADxUlEQVR4Xu1asYrcMBC9H58yjcs026W6Kt02KV2k3SLtQkgRyJFAIMWFFIGA76GHB63Glmdks86BxeO4s2XpvdHMaGTfg7z58qrxYC+9LhwC9sYhYG8cAvbGISChe/v19O7b4/sf5w8/FfgTF3HL9t8Q7QJA8fLp+en738HRnn//Q2c8srmesADYNSeN38Gs//gL5GDvAriIW4XO6+c/dthmBATAeMoDnKDE9qkDkqjW3mqGVwDmJvVtp18PrwA4Mdg3ezAehPJFNKyqSwCmX2l7Z6yj2WfrcAmg/zQHH+w6JP0wxBw4BSLEPl5HQEDbBDKa317PAXnog4nsrToCAhgG+InkaPvMQc1vb+XAsNBpry8iIID7K2UMaQcArUWbecxPkSG7KGIC+CfmQzyoEjaaENe542rPwWF+j8g5tAhQIPhAEfzAGyQAyAA03D3MmOLaokuiAjgZ+HkSttP8DF+WJIrFpxQuAWok/IKfo9cs7Gse8wP5gHmrD65wCZCRTe7c9UV3mr8ASDO0PCtMeAVwEYbkP4uZR8bSQ88GRN2oDezFL0A9lTIwUyWHqtqi1fdyDh5iL34BQ2IvY1mW51CmHUae2pjVgQLmH6oeVbioHy4BzELF9KB4Hg9lqmduTeqVQjN7CQkAS3vLCe4P9rqsYy8hAdQQ9VGpVuPwvblbTgQEcLIhBcNiSskx5z/r2UtIAFc5j2CG7zl7g5IHsT7OICnG3IS9NAjQK5hbs+pkY3/6T7HrkX19K3QiLMDGQJdKOm5VfXbApc8wgeb+w9phE/YSFaDRfHG/Vikqopw9E7E/libhEiDZRsbDAGXYbgUK/yF73Y85zp0EMJNAg87nWQH6D3tyBLLHIFuFgVcAbcmGWW1OnARZyi179cNhtfnFL4Cu3KfDl06vOXSOB/vk7Ak+OIxuuQYuAYUrd6mey5WwsV7Q3ZpHAiqfJDq3wYXgEsBFn/TXU/os0KdX0CzsAApQhZPsZRTgiaUKAgKik9XZc32iY1rEBAzuE5n6j73V3R6s7yeAfsJZn5beapFlMUhefWgc30+A1jb9/ImsT59qtKbAxWt6ZZR3vqS3GzKu0r0FKFgIkGKup2gqz1YN+wi4Vt9qddkbc3u3wP0EcB+g06tpJ7NqCLZQbYBLgNx+YsLERY3ZgC69BbIHnSi8AtT2/eozlIy2X29+8QuQZDPNJxf3eSDHKX1m5Qiw/Xr2EhJAPK7+0K21xiYIC1Awh+bMKo06bSZdj3YBObrX+M8e/wkOAXvjELA3DgF74xCwN14AdzgE4KRN4cQAAAAASUVORK5CYII="y="375"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="149"x="170.5"y="470.148">DynamoDB Table</text><path fill="#FEFECE"filter="url(#1840ec2994baace12ffdfc01ef921ab1ed2522229c00823497d7f0e1588eb91c__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M20.5 40h105v52.594h-105z"></path><text font-family="sans-serif"font-size="14"textLength="54"x="46"y="62.995">Lambda</text><text font-family="sans-serif"font-size="14"textLength="85"x="30.5"y="79.292">Data Source</text><path fill="#FEFECE"filter="url(#1840ec2994baace12ffdfc01ef921ab1ed2522229c00823497d7f0e1588eb91c__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M20.5 398h105v52.594h-105z"></path><text font-family="sans-serif"font-size="14"textLength="78"x="34"y="420.995">DynamoDB</text><text font-family="sans-serif"font-size="14"textLength="85"x="30.5"y="437.292">Data Source</text><path fill="#FEFECE"filter="url(#1840ec2994baace12ffdfc01ef921ab1ed2522229c00823497d7f0e1588eb91c__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M174.5 219h105v52.594h-105z"></path><text font-family="sans-serif"font-size="14"textLength="54"x="200"y="241.995">Lambda</text><text font-family="sans-serif"font-size="14"textLength="85"x="184.5"y="258.292">Data Source</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M161 7h88v118.922h-88z"></path><image height="64"width="64"x="173"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAEJ0lEQVR4XtVay44UMQzk2/kDPoEfQOLGFc4cuHGF82il0UojrVZamai91Lj9qCTdvYIu+TB0EqfKdpxmdt7JyfHOPzgb3krA8+WXMz/jIBwmoFF8/P75+u3j5dN7Ym1Cm3agnr0Cnn7/6JKurC1sy73HSWwXcPv59eHLB8epPdEYt9FGDtb+qflJl7RR730YWwS0/dJYvtyufmqGNi3N2zYZcwJa7doQavAGeUe0hS6N7fPs8ZgQ4AK/LWAp9ngeFWAz3qpZH9oqr2w8P80ttmjb+eECQwIse6Q4HsfKnoZbTXOOVYMa+gJAtH2w4YxEK2sLjb8O2hZ2Rz8c0BGA2Md44HksGxiWzx5Nsq8DE8C96BDOQ4oWTuKBg+8OlALQGao8jggQw2M2CWKql/SlXIA9TFUbGRQAVzyQKZBAoj8XAOnVMhkWICYJVSwIoL8qhEQAioeTQ1wbLZiftAAkuMMKuB/SQkoE6OxmfmANTHOWboOUViI5CCUvAOFPeViQiyyybC110G0KwsoLUFpVwVnoq5g1nmsI9gNjqIitBOyMk1CWO50jCe7FZCVgT7tQcJY6FKM4gupOXAlIZ8yCsKyiOAjE1z68C0Cz2+Yd4CyJvC6QXns73QXgCG6oH40NGBOW2IVckRVQRfY+uQtQEumuHPGyBMuYhKqUB6FNwq69C9jsF6UJxmCZhmNPEuIx8AJmb3v72mcZE5Z7kgC3ePIqAE7T9keAkOCDS0LKcnO/RofAwlcB21qQfVWOZUNYbn69i41olwBQVHeubDhL3NlRHsGRAmKRTCUBVFJ5FY4UkB7TbUnwAzVKAbOHOIa/ek5Ygs3gpkIOsUy20TT86RBnqfLS6yJF2UZl5iKLtW4Ry4Ykgb84RbCLTMdSTg4IQ7pr5IQnaRJ0aGRf4a8SoBU7hgPfMh1NHypsOF7olwPIvK3zu4DBRhQDnI66YJNVoGUtPYqxBYkVIGPHQOeksRRa7mQhkgBLp8UDIE4AuXcUJJDSazikccmy9rZ8M1D1pdigFSsBnIH0uh4Jv9QMHKotqtitBEi9XnryMJqWr4InQVERqJ57AdUplF6AMVqVn4wlISVKWHkB8ve0OaI8/PHyqtA9ZqmAlJIiEQC5lg0Pf5cW0JUaBaDw0tglAsTQde8z3CpODlBLDAIgOFa/IheAZZclqMgJt274FdZ5ZXpI7B1XnftcgJhCelj+ONmiyy29GSrclm+CiWksUAhp8ShKAbL+D7sfe3sM7s4EyLCXwzG+b0eAmDxqLfnho/Fy7B+6FbZvVIfpENjz3Y29YkiArDU8jrXLWTyad9JB9jIuQExfUiOdYRZ7PE8IkCXFKNDLUqO3E/3gCYj32vUsPzmzcMFDCK///4/+LNJYDprmzXucxF4BwPNJf/ha4fl0Pz3+Vzi9gD85rbGUz+zZ3wAAAABJRU5ErkJggg=="y="17"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="68"x="171"y="112.148">Lambda</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M315 186h88v118.922h-88z"></path><image height="64"width="64"x="327"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAEJ0lEQVR4XtVay44UMQzk2/kDPoEfQOLGFc4cuHGF82il0UojrVZamai91Lj9qCTdvYIu+TB0EqfKdpxmdt7JyfHOPzgb3krA8+WXMz/jIBwmoFF8/P75+u3j5dN7Ym1Cm3agnr0Cnn7/6JKurC1sy73HSWwXcPv59eHLB8epPdEYt9FGDtb+qflJl7RR730YWwS0/dJYvtyufmqGNi3N2zYZcwJa7doQavAGeUe0hS6N7fPs8ZgQ4AK/LWAp9ngeFWAz3qpZH9oqr2w8P80ttmjb+eECQwIse6Q4HsfKnoZbTXOOVYMa+gJAtH2w4YxEK2sLjb8O2hZ2Rz8c0BGA2Md44HksGxiWzx5Nsq8DE8C96BDOQ4oWTuKBg+8OlALQGao8jggQw2M2CWKql/SlXIA9TFUbGRQAVzyQKZBAoj8XAOnVMhkWICYJVSwIoL8qhEQAioeTQ1wbLZiftAAkuMMKuB/SQkoE6OxmfmANTHOWboOUViI5CCUvAOFPeViQiyyybC110G0KwsoLUFpVwVnoq5g1nmsI9gNjqIitBOyMk1CWO50jCe7FZCVgT7tQcJY6FKM4gupOXAlIZ8yCsKyiOAjE1z68C0Cz2+Yd4CyJvC6QXns73QXgCG6oH40NGBOW2IVckRVQRfY+uQtQEumuHPGyBMuYhKqUB6FNwq69C9jsF6UJxmCZhmNPEuIx8AJmb3v72mcZE5Z7kgC3ePIqAE7T9keAkOCDS0LKcnO/RofAwlcB21qQfVWOZUNYbn69i41olwBQVHeubDhL3NlRHsGRAmKRTCUBVFJ5FY4UkB7TbUnwAzVKAbOHOIa/ek5Ygs3gpkIOsUy20TT86RBnqfLS6yJF2UZl5iKLtW4Ry4Ykgb84RbCLTMdSTg4IQ7pr5IQnaRJ0aGRf4a8SoBU7hgPfMh1NHypsOF7olwPIvK3zu4DBRhQDnI66YJNVoGUtPYqxBYkVIGPHQOeksRRa7mQhkgBLp8UDIE4AuXcUJJDSazikccmy9rZ8M1D1pdigFSsBnIH0uh4Jv9QMHKotqtitBEi9XnryMJqWr4InQVERqJ57AdUplF6AMVqVn4wlISVKWHkB8ve0OaI8/PHyqtA9ZqmAlJIiEQC5lg0Pf5cW0JUaBaDw0tglAsTQde8z3CpODlBLDAIgOFa/IheAZZclqMgJt274FdZ5ZXpI7B1XnftcgJhCelj+ONmiyy29GSrclm+CiWksUAhp8ShKAbL+D7sfe3sM7s4EyLCXwzG+b0eAmDxqLfnho/Fy7B+6FbZvVIfpENjz3Y29YkiArDU8jrXLWTyad9JB9jIuQExfUiOdYRZ7PE8IkCXFKNDLUqO3E/3gCYj32vUsPzmzcMFDCK///4/+LNJYDprmzXucxF4BwPNJf/ha4fl0Pz3+Vzi9gD85rbGUz+zZ3wAAAABJRU5ErkJggg=="y="196"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="68"x="325"y="291.148">Lambda</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M284.5 7h179v118.922h-179z"></path><image height="64"width="64"x="342"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADA0lEQVR4Xu2YzWrcMBSF88JZdZtN1l103UX2ge4LfYDSF2hfoBEEimFIoAwEBuWggy83uhpJ45GsCbE5DI4sS/eT7o+cK3f96V3ryja9L20Ao7UBjNYGMFobwGh9AIDd/bf97z8vfx9W0/+fvx5vbq0lSRUAMJb3/vD0ZKfpJ85ojUkqB4BlwFhYfvuoq7DnmBe/9pFVDoADTV/v7KPeql+4MsC/z1/so96CCw0DoOMtuxByHGQkAPrjLcTi8/cfJ4lvcZDxADDIPnJhf2wjxVwn9xcHgBaYRVeBoTY39ALALyarF9+KAJjdX0KRgmXEiBIlATiIb5iFll0agNVQt8CRiKS3V/aHVzOA83fAq+gU0dMk7bh+O3BmDDCrakNFkZW9YuCjA7g5gqMEKv4pLZcLQJ+GcTIURz68PXL2BWClPHZpU6wLSd6MLry13g5gFTHiMWkX1wBcex9iAPdoZH+MDDFvwmh6V1+AegkAb2BKZgRuLO2+OAAucObwQ5EB+4MXZa72ALDDKmrnW7Lw3hwWjsmuUXuAZBDrdpmPAN4kmZPUHgC/jDwt3T7Np0sBSBavSrUHqJcA1PgPHI/ZCUJ/mUvHQ17tAR6zn5TSDcPuU/UhKg5FtQdwITBsrdircsGRfYgc5h9g41dylxSHoroA5MVh9cki2QEkNQw5ANbRkza0KDkX2UcLurk8gAvZgAzyvbJMspbJk2lSTNDF5SsAYJfJcOZFb5nCuuqDqtUUvul4j6mLxaQA4OZMx2S/WFxyfhxnlp+E4v3chEx/VwPQUPCfzIqK9RLcbJnMP2C01gaQuGQdkEfWemncZcNgGIA+SCetl/YLAmDpFZ8WhqT10sG2a60KsAsVSvs0TUxa70oxQ60KwGNSZJOuElG7rzjSrgrg5k0omgUk1p8km9baAG6OhAyDVM98AqUGALiZ4RBOznqNYTqLXaX1bhSAe/uNyiOD/Jk5qFoNA3DB0bEDWHLWB2zLc/hnjO2Z0UiAJtoARmsDGK0NYLQ2gNHaAEbrFYLmtZPciPaJAAAAAElFTkSuQmCC"y="17"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="159"x="294.5"y="112.148">Cognito User Pool</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M438 186h84v118.922h-84z"></path><image height="64"width="64"x="448"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADMklEQVR4Xu2Zz4oUMRDG94F9A9/AJ9izF09e9ezBmzfBW8CVOQgLgsIchIH2oz+2KFP5U+lOd3Yhzccym07S9atUVdIzd+HV/YvWnW16WZoAozUBRmsCjNYEGK0JYPTw+u3P+4+/Pnz58/nb9ev3vz8eIXzAv2jHXTtkj7oBwLLHd59g6PL/dft9hXQLeNDTzrBNHQBgOvwtVoIB9l3evLfd0I51YDf0xyg7W6v2AiAqaDr+Ov1KEhmFGWwfv3YB0J1+0yNhFFfDLpdfGwHgRYQyA2ZPXnI1okbw+OfcAoDZGQD22Tsla4LLmSHNAOL77tbD8QxImO5/RDMAC6Vn6qpgMXcJiqsq+cD4tKMitQFwiZG79tYGcbbzAGSJ/RlWFgHE4sNDiMGzp+RFigCkhVfnJKZ7PGvqlwWgDimj3LPswyLhwegjKtuRA2iSCwB2LGu22VthdRjwohObvjAQ8WBhzgPAcWXJpBRDa1mTDwEGQyH0hORETTbLfx5AIX7IxuMQPus+DCc0ygk0GnseAIu0jQGqEDz6slWlAEB4225VB6iWNjTylg4b/JVwWjK7RxIA3eStCKOqGBUAhnh5c2GK5yosrUySJwEYb0ynHLlWBSCKfjpGH2BoGX2WfNJtfaXkLT1Qzg5RI1s4loTlN54+AExl6+bI/QMAPCFE0dPJxuTKhHNCKDiSmOLztLcK0a87HJvEFJe77Am7W5fdHzIAVM8yGp6WtWCK7ZbLCq0CgF8ugMJRQksb5DHO06cqF0C50oueL0Aw9TSpZw1wcbzQiEFSScrG5QA4g+2flBcgrLUo+TwRDZIieK1952UB2MKrXABEDQBcBF0oI8nj0ae8fer+AsD5PZumVgNAUAdPe4u6rG+Stj0pAkQnCxm+1CKWagMIT4HkcXBVl/O/2Arqi9EuDFpnhBB1HMOxSawFb5EB+0O51FSFqSJPH1VGI0mxv239lQUzyPu+3+JI2wGo1tJJadMx0F+4rPYChNUalleuxjXzI19YD4WSoDTdk6ZldQCgiCHGycW3gqgRkEnCDeoGIHrI/9CdW5k96g9wsibAaE2A0ZoAozUBRmsCjNY/9GDZ42b9ME0AAAAASUVORK5CYII="y="196"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="35"x="462.5"y="291.148">SNS</text><path d="M73 98.52v87.27"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m73 93.24-4 9 4-4 4 4-4-9z"></path><path d="M73 305.44v87.18"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m73 397.89 4-9-4 4-4-4 4 9z"></path><path d="M139.17 245.5h29.8"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m174.17 245.5-9-4 4 4-4 4 9-4z"></path><path d="M125.59 66.5h30.12"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m160.95 66.5-9-4 4 4-4 4 9-4z"></path><path d="M125.74 424.5h29.36"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m160.22 424.5-9-4 4 4-4 4 9-4z"></path><path d="M279.59 245.5h30.12"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m314.95 245.5-9-4 4 4-4 4 9-4z"></path><path d="M403.43 245.5h29.29"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m437.83 245.5-9-4 4 4-4 4 9-4z"></path><path d="M249.23 66.5h29.88"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m284.32 66.5-9-4 4 4-4 4 9-4z"></path></svg><figcaption class="caption">Using granular data sources</figcaption></figure><p>While this requires a lot more resources working together to provide the same functionality, it is the "native AppSync way". This provides clearer separation of each part of the API and only calls the appropriate data source required for the resolver.<p>Granular resolvers <strong>help with the "lousy neighbour" problem</strong>: while Lambda can scale to a heavy load, it is still limited. If one part of the API calls the function too many times, other parts that don't rely on that function can still work.<p>Also many small parts <strong>provide better visibility</strong>. If all requests call the same function it's hard to see what is happening inside. Logging and monitoring of the underlying processors are easier when they are small.<p>Finally, since permissions are tied to data sources, having multiple of them allows the implementation of <strong>least privilege</strong>. Instead of one Lambda function that has full access to everything, small and limited components provide defense in depth.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Tip</div><div class="tbox-body"><p>While it's tempting to add a single Lambda function and handle everything there, it is easier to operate an API that relies more on the resolvers infrastructure AppSync provides.</div></div></div><div class="tcolorbox tcolorbox-secondary my-5"><div class="tbox-header fw-bold">Master AppSync and GraphQL</div><div class="tbox-body"><div>Support this book and get all future updates and extra chapters in ebook format.</div><div class="d-flex justify-content-center"><a role="button"href="https://tsallai.gumroad.com/l/graphql-on-aws-appsync-book"class="btn btn-primary not-styled mt-3 text-white">Buy the book</a></div></div></div><div class="pagination row"><div class="col-6"><a href="/aws-appsync/data-sources/"class="border rounded d-block p-3"><div class="pagination-sublabel text-muted small">Previous</div><div class="pagination-title">&lt; Data sources</div></a></div><div class="col-6"><a href="/aws-appsync/data-sources/dynamodb/"class="border rounded d-block p-3 text-end ms-auto"><div class="pagination-sublabel text-muted small">Next</div><div class="pagination-title">DynamoDB &gt;</div></a></div></div><footer>Â© TamÃ¡s Sallai - <a href="https://advancedweb.hu">advancedweb.hu</a></footer></div><div class="col-lg-3 d-none d-lg-block"><div class="toc-container"><a style="margin-left: 0em"href="#lambda-1">Lambda</a> <a style="margin-left: 1em"href="#configuring-the-data-source">Configuring the data source</a> <a style="margin-left: 1em"href="#event-object">Event object</a> <a style="margin-left: 2em"href="#direct-lambda-resolver">Direct Lambda resolver</a> <a style="margin-left: 1em"href="#result-object">Result object</a> <a style="margin-left: 2em"href="#errors">Errors</a> <a style="margin-left: 1em"href="#use-only-one-lambda-function">Use only one Lambda function?</a></div></div></div></div></div><script src="/assets/main.077454cb0bffe3695e9176b1b5f8a7fd9676d920.js"></script>