<!doctypehtml><html lang="en"><meta charset="utf-8"><link rel="icon"type="image/svg+xml"href="/assets/favicon.15621087ab873d484cfdc234ae6d4f0559d2ece6.svg"><meta name="viewport"content="width=device-width,initial-scale=1"><link href="/assets/main.d3c4fd66da45b5fe1b587fd7bc4b64cc7a34bcf3.css"rel="stylesheet"><title>Custom domains - API configuration - Building GraphQL APIs with AWS AppSync</title><nav class="navbar navbar-light"><div class="container-fluid flex-nowrap"><a class="navbar-brand"href="/">Building GraphQL APIs with AWS AppSync</a> <button class="navbar-toggler d-lg-none align-self-start"type="button"data-bs-toggle="offcanvas"data-bs-target="#offcanvasNavbar"aria-controls="offcanvasNavbar"><span class="navbar-toggler-icon"></span></button><div class="offcanvas offcanvas-end"tabindex="-1"id="offcanvasNavbar"aria-labelledby="offcanvasNavbarLabel"><div class="offcanvas-header"><h5 class="offcanvas-title"id="offcanvasNavbarLabel">Building GraphQL APIs with AWS AppSync</h5><button type="button"class="btn-close text-reset"data-bs-dismiss="offcanvas"aria-label="Close"></button></div><div class="offcanvas-body keep-scrolltop"><ul class="nav navbar-nav justify-content-end flex-grow-1 pe-3"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link active"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link active"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ðŸš§</span><li class="nav-item"><span class="nav-link">RDS ðŸš§</span><li class="nav-item"><span class="nav-link">None ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ðŸš§</span><li class="nav-item"><span class="nav-link">Authorization ðŸš§</span><li class="nav-item"><span class="nav-link">Error handling ðŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ðŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ðŸš§</span><li class="nav-item"><span class="nav-link">CDK ðŸš§</span><li class="nav-item"><span class="nav-link">Amplify ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ðŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul></div></div></div></nav><div class="d-flex flex-row"><ul class="nav flex-column navigation flex-shrink-0 flex-nowrap overflow-auto d-none d-lg-flex keep-scrolltop"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link active"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link active"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ðŸš§</span><li class="nav-item"><span class="nav-link">RDS ðŸš§</span><li class="nav-item"><span class="nav-link">None ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ðŸš§</span><li class="nav-item"><span class="nav-link">Authorization ðŸš§</span><li class="nav-item"><span class="nav-link">Error handling ðŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ðŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ðŸš§</span><li class="nav-item"><span class="nav-link">CDK ðŸš§</span><li class="nav-item"><span class="nav-link">Amplify ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ðŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul><div class="flex-grow-1 main container-fluid"><div class="row"><div class="col-lg-9 body p-3"><div class="d-lg-none mb-4"><div class="accordion"id="accordionExample"><div class="accordion-item"><h2 class="accordion-header"id="mobile-toc-header"><button class="accordion-button collapsed"type="button"data-bs-toggle="collapse"data-bs-target="#mobile-toc"aria-expanded="true"aria-controls="mobile-toc">In this chapter</button></h2><div id="mobile-toc"class="accordion-collapse collapse"aria-labelledby="mobile-toc-header"data-bs-parent="#accordionExample"><div class="accordion-body"><div class="toc-container"><a style="margin-left: 0em"href="#custom-domains">Custom domains</a> <a style="margin-left: 1em"href="#acm-setup">ACM setup</a> <a style="margin-left: 1em"href="#custom-domain-setting">Custom domain setting</a> <a style="margin-left: 1em"href="#forward-traffic">Forward traffic</a></div></div></div></div></div></div><h3 id="custom-domains">Custom domains</h3><p>By default, an AppSync API is available under <code>https://&lt;apiid&gt;.appsync-api.eu-central-1.amazonaws.com/graphql</code>. While it works for most cases, such as when you provide a webapp or a mobile app, as clients might not see this generated domain name. On cases when clients directly go to the API instead of some frontend application, offering the API under your own domain name is a requirement.<p>AppSync <a href="https://aws.amazon.com/blogs/mobile/introducing-custom-domain-names-for-aws-appsync-apis/">just recently started</a> supporting custom domains. This works by creating a CloudFront distribution in the background and configure it to forward traffic to the AppSync endpoint.<p>In this chapter, we'll look into how to set up an AppSync domain on a custom URL. We'll see what prerequisites are needed in terms of certificates and domain setup and how to use the resulting endpoints.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Note</div><div class="tbox-body"><p>A custom endpoint supports only the AppSync API on it, so you can't host other parts of the infrastructure on the same host. For example, it's not possible to set up <code>example.com</code> as a webapp and <code>example.com/graphql</code> as the API enpoint.</div></div></div><p>To setup a custom domain, we need to do several steps:<ul><li>Set up a certificate on ACM<li>Add the custom domain on AppSync<li>Associate the API with the custom domain<li>Forward traffic to the AppSync API</ul><figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"height="448"preserveAspectRatio="none"style="width:511px;height:448px;background:#fff"viewBox="0 0 511 448"width="511"><defs><filter height="300%"id="21738e8ddaa9b55c9deca5cfe3b2b68ba196b39600924a17244acc7a48a1aaf7__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FEFECE"filter="url(#21738e8ddaa9b55c9deca5cfe3b2b68ba196b39600924a17244acc7a48a1aaf7__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M7 48.5h210v36.297H7z"></path><text font-family="sans-serif"font-size="14"textLength="190"x="17"y="71.495">test.appsynctest.cloudns.cl</text><circle cx="412"cy="217"fill="#FEFECE"filter="url(#21738e8ddaa9b55c9deca5cfe3b2b68ba196b39600924a17244acc7a48a1aaf7__a)"style="stroke:#a80036;stroke-width:1.5"r="12"></circle><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m408 205 6-5-2 5 2 5-6-5z"></path><text font-family="sans-serif"font-size="14"textLength="109"x="357.5"y="245.995">Custom domain</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M346 324h132v118.922H346z"></path><image height="64"width="64"x="380"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAADOUlEQVR4Xu2ZsWocMRCG/cB5g7xBnsC1m1Rp4zpFOneGdALbXGE4MOTgCoNh87M/OyialTSzq4tyIPFj1ruz0nwjzUhe34RPt1etG33rujQAemsA9NYA6K0B0FsDoLcaAzx/vjt+/XF+fHp/OX78Pk9zwwWEm2/fH15v7/Vbe9QGgH6Lx3QaDHCaMJA8Qjv9/HX48k33s0ENABBXcRqeIcbg0WYQnIaxwMBY23i1CwAOMerwCTOgDXLCi5gZ1ys5bQeQwDfxY7M2AtB7BD63Wv6ZtgBg7cJ7rIHu3ocNAFgw9F4/2inWX8ytq0D5ANA1q80lYh9XYcbIAuMDYAWsdkqxYkK40E8TMTRssIf3cq2NYzkAuHiqPVL0gHsww6ltYsnKnKKyBqrqVDsA6E21x7CEU/YpJn153ug6Ouco2iAnKwD2V3v4GU7xmDzl7YJHD3nXfmSyAjCKlvAHRctNo+ATupUZi68tsgJM87al7+fEdOdhrvounI4LDk+y2mxVJgCuAeP6oThj0lzvcsbKOSMyAXBJFNZAIgJL1L156RrOBOAKSVhKitgzL8tJHMs14SYArgd9f1WMX5yFLI7lNEiU9FBQewCmb1KvqoUoUTeA3G7N4mifhMYAjF9hEzjMfytiyMJuzSjg52n+s1MbxGoMUN4d+VRa7tiTmBX843TpaVyVCaBwFuBgiDoPXqw/GnXVLFfWWAZWh9MyAXB4CS1+lbGTwYiaa4lZLsauqm0CCEtp53U8QOIKed6XL0KxtFkuxqxj+v6qrABxGsQwYRkPzh2Xb1urScxHVbNLHebiOjj9namYBDKw6QQQM/o9zcmQMysXDK0KQBwk1kGuH7184R8TVHfiMvMenCoAjMd5+S4rYTZmmFfeU1OoAsBprvikacv9klKrHxVUARAd5r2WMPYMc4mJZF/9lBXg0pIE04/K+i8AOLFxZbOrM4AcK7Z5H/oCyPFuT1I1AEDanZz/MsIrTNnCjmZUAwDmH5cBgpojwWohquzHuC7saEY1AAhzkU22i/g8x+888gjXqDb7XafaAFASYzideEyeN8Pncq9aAnTRAOitAdBbA6C3BkBvDYDeunqAPxdjffOs6ZOIAAAAAElFTkSuQmCC"y="334"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="112"x="356"y="429.148">AppSync API</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M390 7h84v118.922h-84z"></path><image height="64"width="64"x="400"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAACA0lEQVR4Xu2ZzUrDQBSF+8Ku3Lpx7cK1C/eCe8EHEF9AX0ADQimUCiIUJD30wBBzOz/5mTmkTPgo6c0kc7/JzGTarJqLy0WzsqFlUQXUVAE1VUBNFVBz1gLrm9v9x6ccpGFzc4QEtg+PbdvaK5YECSANm5sjLhBugKyg6ipwBgKbu/uvq2sJqHoGAfk2VeD76Rk7ElD1DAKLHwNTBNiVbTwRvcDfbgdsPBGxAE+PZhBALMDmxxVG3wSlAM/FNMKZBDO6LRNFKcDm5yBujytCWyZKOQFkiWIo//Py+vv2zp6DtudR3gQEcQgFUAyFU2anQgKspruhvZGoSxE7SJ1r4+4WdSgkAJgcPqM5oQALQ8ke7VFOACAhFEbD20NdUCAx+6awQJPgMCj7prxAE3QYmn0jEQC+LOlm4wEEAqzSTaD46k7nZDriakUFeAp/xLHJ2aMSf171EAiwo7Ox22NfchoMnhwePgQC7mmF565b/2CHz+Z24JpCIMAs3Rjo4m6LPeRDIMDeb+OEI8HGfQgE5qUKBAXQGbadv0B88RR8/SqvQG957IunbL6pKa8A4mg5hy+eQqCKjAIFyCuwGTsGfBe05BUYPQbCCXXJKzB6DASedLaKjAIFqALnIeDeeM7OyUXr+v/L6UkCvWvNTorAfsqL7kVQBdRUATVVQE0VUFMF1BwAobWJ/VwbcRgAAAAASUVORK5CYII="y="17"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="40"x="412"y="112.148">ACM</text><path fill="#FFF"style="stroke:#00000000;stroke-width:1.5;fill:#fff"d="M167.5 324h123v118.922h-123z"></path><image height="64"width="64"x="197"xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAEDklEQVR4Xu1aPa/TQBB8f5w/wB+guJbUEWUampTo1UBBEQkkpFAgxJMokMLoBq/2ee9295yAFcnWKEou67uZ/fLZyUN58fGu8WCH7gubgLWxCVgbm4C1sQloYffy0+H1Z+D45ivA9xi0ltfjZgLAD1xPH34+/fh96Rz4CgYwu6GYGwiAd0FLEyVLOl5C8f7dd22G9/tXJzvbKK4SAAbnL7+EEIiCJT+CsbUntGCcfqWM5QKEK97olBBV1CD1IDYYn6XZ49tvdv4klggAFVJ00oDswVtzhVQMgi4G8YpzRS1elxXGsAAsSU6h22B5qYXLemDaNM+CAS177nAwJoCccICQ/XYG5pj2K51tLUuNFWce1TAgAFTo++QaoAt7PQL3zyRpSMR6Bk0MCKD/Mr4nmDOaDUespYBxwEL2qx6yAui8ZgZbsECFDd5DBmeABmuvwXpILlSSAhjcpGNIVBpOTey/R7LVMNTJRE0J4IyZta2bwQOD0MPcw2vIDAvl/RULoPvpUR9hBueZsYOFUktGgK3FJkgu7CEMkbPRIDhbWDAlFJCfKJ+4EDlrr00kHRcIYE/ItE5uOe24BecMjZmQoVkgwOnc8A0yFY4H8l2PQAQylZAJfiCgV3NyVWY+9Mx6YCWE+XY213ILTwALoNl/GBlJraHLXHFn1rC7KQtPABsouIIZXpktJG2Dm8wKQca7rBY/UJ4A2SHyIEURMPOfEPIdJshkEQn4LcQTINsSuwzpCld9sWNVHKM7d57iN5mMTSzAsi+Tb0AUpOXekowf6w0XR/y1LyYPZ7hWgB/Bg7pdPJt7c/kWr70ZwrLxCRCegIwD/DxhDC+dBuVcZPTpywX4ze6Qu/TupicAZ7OXZu7ZUwQsdN9HnoDiRjn0nwapPD2/bd/Xmx5rLMgsEQhwpnC0NSF1z4/w674+VrGWgktU5SUU0MtCP7t6EMbSuC6tBkBQcJilgYAeUdZ3szRDkP2pPj+V1LKJntlHlFBA6ezLMw2qCXpEJwY9PfOFNeshFtBcYLGAZmJYroyMTV2LWEBp3dQvTiF7os1SjiQ7REoAV505abZqHnQHvStXCV3HTNpmZVukBJSppHToR9uoYD89HpZDB4R9L++arIBSGWvHnOqvSdYsg119UIcZQFR7enatyGBAwO75w93Mhj6DQ33yXqZEbbZUBwMCyrQGeS9uRMRT3YoXlTMyszV2MCagqAxmBBaXAWfgR1Kf7ZSSGBZQVOvgMRRxQq6yMtVo5giWCCAk6MjgobWlzcsM+Z5jsVxAqZkgoTjVn1mtjQVzj0dvJ5fHVQIIthHhxOZ4bP3QrRMvL9jHDQQQu/v9q4HFzvzZY19/ZbKW1+OfCPif2ASsjU3A2tgErI1NwNr4A2Wk1mwjzu3/AAAAAElFTkSuQmCC"y="334"></image><text font-family="sans-serif"font-size="16"font-weight="bold"textLength="103"x="177.5"y="429.148">Distribution</text><path d="M217.22 66.5h167.4"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m389.86 66.5-9-4 4 4-4 4 9-4z"></path><text fill="#666"font-family="sans-serif"font-size="12"textLength="136"x="235.5"y="46.639">1) Domain verification</text><text fill="#666"font-family="sans-serif"font-size="12"textLength="43"x="282"y="60.607">CNAME</text><path d="M424.5 126.22c-3.04 23.78-6.41 50.14-8.88 69.49"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m414.94 200.97 5.124-8.41-4.481 3.452-3.452-4.482 2.809 9.44z"></path><text fill="#666"font-family="sans-serif"font-size="12"textLength="81"x="422"y="168.139">2) Certificate</text><path d="M412 249.09v69.5"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m412 323.8 4-9-4 4-4-4 4 9z"></path><text fill="#666"font-family="sans-serif"font-size="12"textLength="78"x="413"y="291.139">3) associate</text><path d="M385 249.09c-23.69 20.26-59.13 50.56-90.24 77.17"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m290.6 329.82 9.436-2.82-5.64-.434.434-5.64-4.23 8.894z"></path><text fill="#666"font-family="sans-serif"font-size="12"textLength="48"x="349"y="291.139">creates</text><path d="M118.46 84.88c16.29 43.86 59.7 160.73 87.02 234.29"fill="none"style="stroke:#666;stroke-width:1;fill:none"></path><path fill="#666"style="stroke:#666;stroke-width:1;fill:#666"d="m207.25 323.96.612-9.83-2.355 5.144-5.144-2.355 6.887 7.041z"></path><text fill="#666"font-family="sans-serif"font-size="12"textLength="60"x="180"y="229.639">4) CNAME</text></svg><figcaption class="caption">Custom domain setup</figcaption></figure><div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Note</div><div class="tbox-body"><p>At first sight, it should be possible to set up a CloudFront distribution yourself and point it to the AppSync API URL instead of using the built-in custom domain feature. While this works for GraphQL queries, it won't work for the realtime WebSockets channel as it <a href="https://docs.aws.amazon.com/appsync/latest/devguide/real-time-websocket-client.html#header-parameter-format-based-on-appsync-api-authorization-mode">needs to encode the host in the query parameters</a>. I spent quite some time finding a workaround but it seems like it is not supported.</div></div></div><h4 id="acm-setup">ACM setup</h4><p>Custom domains in AWS require an ACM certificate in the <code>us-east-1</code> region for the domain. Make sure to select the <code>N. Virginia</code> region and add the domain name:<figure class="image prevp"><img srcset="/assets/iwSAYWNtQDMucG5nJQM.078bb3a63dc557941618ca2fad532886a80c2da7.png 3x, /assets/iweAYWNtQDMucG5nJXctMTE2MAM.88f8a6034b5369828ec8f3fa3d74e8ce44279d75.png, /assets/iweAYWNtQDMucG5nJXctMTc0MAM.9b18b537905b824605acc9e7b97e4ab4494bbd17.png 1.5x"title="An ACM certificate for the domain in the us-east-1 region"><figcaption class="caption">An ACM certificate for the domain in the us-east-1 region</figcaption></figure><p>Then AWS requires a verification which can be email-, or domain-based. The latter is the preferred way to verify ownership as after adding a record there is no manual action needed for renewals.<p>ACM shows the validation record you need to add:<figure class="image prevp"><img srcset="/assets/GxwA-MUpZxRQIJG1Fh3-tyKSlGKKnEQWi07XT2j-HBUB.481aabe0e3488009787df93d9eafc7938e31d56c.png 3x, /assets/GyIA8EUnZ3Q89CiL7GtxHGzAgUOcBDrY6SbNl82eF1Bt1Nkfz1AJ.b759e643cb8c02e6dfd3ee1329dcd32e78638d26.png, /assets/CxGAYWNtX3ZhbGlkYXRpb25fcmVjb3Jkc0AzLnBuZyV3LTE5MzgD.1166b5b3fc3d173a16b53cc30e931dcfbc9224bb.png 1.5x"title="ACM requires a CNAME record for verification"><figcaption class="caption">ACM requires a CNAME record for verification</figcaption></figure><p>Go to your DNS settings and add the record:<figure class="image prevp"><img srcset="/assets/CwyAYWNtX2Ruc192YWxpZGF0aW9uQDMucG5nJQM.2945350a3335c97be2dc3c8621966c60d55fb948.png 3x, /assets/iw6AYWNtX2Ruc192YWxpZGF0aW9uQDMucG5nJXctOTkxAw.ce370fbf1b36d8fbf9d39358fcd1341e7c576e30.png, /assets/Cw-AYWNtX2Ruc192YWxpZGF0aW9uQDMucG5nJXctMTQ4NgM.f555762ea502c07fc0806c02093b319e615922ca.png 1.5x"title="The verification record added to the domain"><figcaption class="caption">The verification record added to the domain</figcaption></figure><p>If you use Route53 to manage the domain AWS even provides a button to do this. But if you use anything else, you can always manually add it.<h4 id="custom-domain-setting">Custom domain setting</h4><p>Now that you have a valid ACM certificate for the domain, go to the AppSync console and add the custom domain:<figure class="image prevp"><img srcset="/assets/GxMA-KVLZoC-NCGKMCKJxOAKRaidFw.6f53414bea03c9180f9dabad3432abb56b3df7ba.png 3x, /assets/iwyAY3VzdG9tX2RvbWFpbkAzLnBuZyV3LTExNDID.69234b524296425556044ec2715c9cf9662b5532.png, /assets/iwyAY3VzdG9tX2RvbWFpbkAzLnBuZyV3LTE3MTQD.03992299b414d3cc686e265e6bfafcc3a6e5bb56.png 1.5x"title="The custom domain has a CloudFront domain name"><figcaption class="caption">The custom domain has a CloudFront domain name</figcaption></figure><p>Notice that the AppSync domain name is a <code>cloudfront.net</code> subdomain. This is not a coincidence: AWS creates a CloudFront distribution in the background, which also explains why it takes so long to create or make any changes to it.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-warning"><div class="tbox-header">Note</div><div class="tbox-body"><p>The CloudFront distribution comes with the usual problems regarding domain configuration: it only comes as a domain and not as an IP address. This means you can only setup a CNAME record when you forward traffic to it, and not an A (and AAAA) record and <strong>CNAME records are generally not supported on the apex</strong> (<code>example.com</code>) only on subdomains (<code>test.example.com</code>).<p>Several services support <a href="https://advancedweb.hu/what-is-cname-flattening-and-how-it-helps-redirecting-the-apex-domain/">CNAME flattening</a> which means they emulate the CNAME behavior but under the hood fetch the current IP address and return an A/AAAA record, such as Cloudflare. On Route53, you can configure an ALIAS for the A/AAAA records that point to an AWS service that solves this problem.<p>If you need to use the apex use a service that supports CNAME flattening or set up a Route53 Hosted Zone and use an NS record to delegate domain config there. See <a href="https://advancedweb.hu/how-to-use-a-custom-domain-with-cloudfront-and-route53/">this article</a> for more info.</div></div></div><p>Also notice that the real-time endpoint is on the same domain as the regular GraphQL endpoint. Amplify handles this automatically, but you might need to setup your client library if you use something else.<p>The next step is to associate the custom domain with the AppSync API:<figure class="image prevp"><img srcset="/assets/iwqAYXBpX2Fzc29jaWF0aW9uQDMucG5nJQM.c53e0444b745691ee4ba438e80daf869ac3e57d3.png 3x, /assets/GxoA-EUnZ3S8_J9H1sIsKyWRBZxiJJnPbT_KBk85.a0bd489dca0970aa6c7d6ea4c63d20712a14c862.png, /assets/Cw2AYXBpX2Fzc29jaWF0aW9uQDMucG5nJXctMzUyAw.ab4f7170c312b9b74c2ca55b0bf7b2a52a260fe7.png 1.5x"title="The API has to be associated with the custom domain"><figcaption class="caption">The API has to be associated with the custom domain</figcaption></figure><h4 id="forward-traffic">Forward traffic</h4><p>Finally, forward traffic going to the domain to the CloudFront distribution using a CNAME (or A/AAAA) record:<figure class="image prevp"><img srcset="/assets/CwqAZG5zX2Nsb3VkZnJvbnRAMy5wbmclAw.22c79fe46b3b2a9521ca4a3065e6ac20176ef5b3.png 3x, /assets/iwyAZG5zX2Nsb3VkZnJvbnRAMy5wbmcldy05OTED.1263ba13ab64aa294224fb90dfbab85d4d66b898.png, /assets/Cw2AZG5zX2Nsb3VkZnJvbnRAMy5wbmcldy0xNDg2Aw.0f3090d60dfb2cb0c3fd44871ed655ca8f8abc05.png 1.5x"title="Forward traffic to the CloudFront domain"><figcaption class="caption">Forward traffic to the CloudFront domain</figcaption></figure><p>With this setup, the API is available under the custom domain:<figure class="image prevp"><img srcset="/assets/Cw6AY3VzdG9tX2RvbWFpbl9lbmRwb2ludEAyLnBuZyUD.73738f725a8db5f0878afd7b5aaa596881b07270.png 2x, /assets/ixCAY3VzdG9tX2RvbWFpbl9lbmRwb2ludEAyLnBuZyV3LTc0MAM.09eab1d1e03c21b38dd92737853e6ee1e89076da.png, /assets/CxGAY3VzdG9tX2RvbWFpbl9lbmRwb2ludEAyLnBuZyV3LTExMTAD.1211dd04411c277131bd13fe24aeddac9786fc48.png 1.5x"title="Requests are handled on the custom domain"><figcaption class="caption">Requests are handled on the custom domain</figcaption></figure><p>In the resolvers, the <code>$context.request.domainName</code> contains the domain the request came from. This makes it easy to distinguish between the different sources, especially as the original domain (<code>https://&lt;apiid&gt;.appsync-api.eu-central-1.amazonaws.com/graphql</code>) still works.<div class="tcolorbox tcolorbox-secondary my-5"><div class="tbox-header fw-bold">Master AppSync and GraphQL</div><div class="tbox-body"><div>Support this book and get all future updates and extra chapters in ebook format.</div><div class="d-flex justify-content-center"><a role="button"href="https://tsallai.gumroad.com/l/graphql-on-aws-appsync-book"class="btn btn-primary not-styled mt-3 text-white">Buy the book</a></div></div></div><div class="pagination row"><div class="col-6"><a href="/aws-appsync/api-configuration/logging-and-monitoring/"class="border rounded d-block p-3"><div class="pagination-sublabel text-muted small">Previous</div><div class="pagination-title">&lt; Logging and monitoring</div></a></div><div class="col-6"><a href="/aws-appsync/api-configuration/waf/"class="border rounded d-block p-3 text-end ms-auto"><div class="pagination-sublabel text-muted small">Next</div><div class="pagination-title">WAF &gt;</div></a></div></div><footer>Â© TamÃ¡s Sallai - <a href="https://advancedweb.hu">advancedweb.hu</a></footer></div><div class="col-lg-3 d-none d-lg-block"><div class="toc-container"><a style="margin-left: 0em"href="#custom-domains">Custom domains</a> <a style="margin-left: 1em"href="#acm-setup">ACM setup</a> <a style="margin-left: 1em"href="#custom-domain-setting">Custom domain setting</a> <a style="margin-left: 1em"href="#forward-traffic">Forward traffic</a></div></div></div></div></div><script src="/assets/main.077454cb0bffe3695e9176b1b5f8a7fd9676d920.js"></script>