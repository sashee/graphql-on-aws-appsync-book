<!doctypehtml><html lang="en"><meta charset="utf-8"><link rel="icon"type="image/svg+xml"href="/assets/favicon.15621087ab873d484cfdc234ae6d4f0559d2ece6.svg"><meta name="viewport"content="width=device-width,initial-scale=1"><link href="/assets/main.d3c4fd66da45b5fe1b587fd7bc4b64cc7a34bcf3.css"rel="stylesheet"><title>Logging and monitoring - API configuration - Building GraphQL APIs with AWS AppSync</title><nav class="navbar navbar-light"><div class="container-fluid flex-nowrap"><a class="navbar-brand"href="/">Building GraphQL APIs with AWS AppSync</a> <button class="navbar-toggler d-lg-none align-self-start"type="button"data-bs-toggle="offcanvas"data-bs-target="#offcanvasNavbar"aria-controls="offcanvasNavbar"><span class="navbar-toggler-icon"></span></button><div class="offcanvas offcanvas-end"tabindex="-1"id="offcanvasNavbar"aria-labelledby="offcanvasNavbarLabel"><div class="offcanvas-header"><h5 class="offcanvas-title"id="offcanvasNavbarLabel">Building GraphQL APIs with AWS AppSync</h5><button type="button"class="btn-close text-reset"data-bs-dismiss="offcanvas"aria-label="Close"></button></div><div class="offcanvas-body keep-scrolltop"><ul class="nav navbar-nav justify-content-end flex-grow-1 pe-3"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link active"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link active"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ðŸš§</span><li class="nav-item"><span class="nav-link">RDS ðŸš§</span><li class="nav-item"><span class="nav-link">None ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ðŸš§</span><li class="nav-item"><span class="nav-link">Authorization ðŸš§</span><li class="nav-item"><span class="nav-link">Error handling ðŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ðŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ðŸš§</span><li class="nav-item"><span class="nav-link">CDK ðŸš§</span><li class="nav-item"><span class="nav-link">Amplify ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ðŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul></div></div></div></nav><div class="d-flex flex-row"><ul class="nav flex-column navigation flex-shrink-0 flex-nowrap overflow-auto d-none d-lg-flex keep-scrolltop"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link active"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link active"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link active"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ðŸš§</span><li class="nav-item"><span class="nav-link">RDS ðŸš§</span><li class="nav-item"><span class="nav-link">None ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ðŸš§</span><li class="nav-item"><span class="nav-link">Authorization ðŸš§</span><li class="nav-item"><span class="nav-link">Error handling ðŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ðŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ðŸš§</span><li class="nav-item"><span class="nav-link">CDK ðŸš§</span><li class="nav-item"><span class="nav-link">Amplify ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ðŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul><div class="flex-grow-1 main container-fluid"><div class="row"><div class="col-lg-9 body p-3"><div class="d-lg-none mb-4"><div class="accordion"id="accordionExample"><div class="accordion-item"><h2 class="accordion-header"id="mobile-toc-header"><button class="accordion-button collapsed"type="button"data-bs-toggle="collapse"data-bs-target="#mobile-toc"aria-expanded="true"aria-controls="mobile-toc">In this chapter</button></h2><div id="mobile-toc"class="accordion-collapse collapse"aria-labelledby="mobile-toc-header"data-bs-parent="#accordionExample"><div class="accordion-body"><div class="toc-container"><a style="margin-left: 0em"href="#logging-and-monitoring">Logging and monitoring</a> <a style="margin-left: 1em"href="#logging">Logging</a> <a style="margin-left: 2em"href="#setup-logging">Setup logging</a> <a style="margin-left: 2em"href="#log-levels">Log levels</a> <a style="margin-left: 2em"href="#analyze-logs">Analyze logs</a> <a style="margin-left: 2em"href="#log-costs">Log costs</a> <a style="margin-left: 1em"href="#metrics">Metrics</a> <a style="margin-left: 2em"href="#4xx-and-5xx-errors">4xx and 5xx errors</a> <a style="margin-left: 2em"href="#request-latency">Request latency</a> <a style="margin-left: 2em"href="#number-of-requests">Number of requests</a> <a style="margin-left: 2em"href="#defined-request-tokens">Request tokens</a> <a style="margin-left: 2em"href="#subscription-metrics">Subscription metrics</a> <a style="margin-left: 2em"href="#monitoring-tips">Monitoring tips</a> <a style="margin-left: 1em"href="#x-ray">X-Ray</a></div></div></div></div></div></div><h3 id="logging-and-monitoring">Logging and monitoring</h3><p>AppSync is integrated with CloudWatch, both Logs and Metrics so it can automatically publish debugging and operational information there. And CloudWatch comes with a rich toolset to analyze and monitor this data, this makes it relatively easy to gain insight of what is happening with the API. And as CloudWatch is a managed serverless solution, you can't overwhelm it with too much data. Provided, of course, that you are willing to pay for that.<p>In this chapter we'll take a look into how logging and monitoring works for an AppSync API.<h4 id="logging">Logging</h4><p>The primary purpose of logging is debugging, and AppSync can publish a good range of information (if configured to do so) to the logs. But, of course, there are edge cases you should be looking out for.<h5 id="setup-logging">Setup logging</h5><p>CloudWatch Logs uses a 2-layered system for logs. The top level is the Log Group which is the container for a single entity, such as an AppSync API. It's name is determined by the AppSync service: <code>/aws/appsync/apis/&lt;apiid&gt;</code>.<p>The lower level is the Log Streams. AppSync automatically creates these streams according to some internal logic, and they contain the actual log messages. In practice, you query the stream with the latest log message to see the most recent log events.<p>AppSync follows the usual AWS way in regards to permissions: the service needs an IAM role to gain write access to CloudWatch Logs as by default it has no permissions on its own.<p>The minimal set of permissions give write access to the groups, streams, and messages:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2012-10-17"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"logs:CreateLogGroup"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"logs:CreateLogStream"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"logs:PutLogEvents"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"*"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span></code></pre><div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Tip</div><div class="tbox-body"><p>Don't give <code>logs:CreateLogGroup</code> permission to AppSync.</div></div></div><p>If you use the Management Console, AWS creates the role with these permissions.<p>This is good for getting started, but if you use some Infrastructure-as-Code solution, such as CloudFormation, Terraform, or the CDK, this is not the way you want to manage logging. The problem with letting AppSync to manage the log group is that if you delete the API, the log group will still be there. And since, by default, the log messages have no expiration, you'll pay for storage even when the API is long gone.<p>A better solution is to create the log group with the IaC tool and don't give AppSync the <code>logs:CreateLogGroup</code> permission. This way, the API is still able to manage the streams and push the messages, but deleting the stack clears the logs too. And, as an extra benefit, you'll be able to define the retention too.<p>For example, this is how to create the log group for the AppSync API with Terraform:<pre class="highlight prevp"><code><span class="hljs-keyword">resource</span> <span class="hljs-string">"aws_cloudwatch_log_group"</span> <span class="hljs-string">"appsync_loggroup"</span> {
  name =
    <span class="hljs-string">"/aws/appsync/apis/<span class="hljs-variable">${aws_appsync_graphql_api.appsync.id}</span>"</span>
  retention_in_days = <span class="hljs-number">14</span>
}</code></pre><p>Then give a limited set of permissions to the AppSync API:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2012-10-17"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"logs:CreateLogStream"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"logs:PutLogEvents"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"*"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span></code></pre><h5 id="log-levels">Log levels</h5><p>AppSync supports various settings for what is logged. There are two controls for this:<ul><li>Whether to include verbose content<li>What field resolvers are logged</ul><figure class="image"><img srcset="/assets/CwuAbG9nZ2luZ19zZXR0aW5nc0AzLnBuZyUD.f1ccc7fb2dffded37cdd01cc9c0b69785e283361.png 3x, /assets/iw2AbG9nZ2luZ19zZXR0aW5nc0AzLnBuZyV3LTc4MgM.0332faa8115439d8bca03bd273305dcc287e2d75.png, /assets/Cw6AbG9nZ2luZ19zZXR0aW5nc0AzLnBuZyV3LTExNzQD.81ff6739098cd8cc513610ac4e19d66205c774d2.png 1.5x"title="AppSync logging settings"><figcaption class="caption">AppSync logging settings</figcaption></figure><p>When both are turned off, only the time, id, duration, and the amount of tokens consumed (see the <a href="#defined-request-tokens">Request tokens</a> chapter):<figure class="image prevp"><img srcset="/assets/CwiAbG9nZ2luZ19vbkAzLnBuZyUD.074174ec2921ab44fe63ae4ee32e0b0c40843bb0.png 3x, /assets/iwqAbG9nZ2luZ19vbkAzLnBuZyV3LTc3NAM.bf855401648922197a58666069cf00579e54b75d.png, /assets/CwuAbG9nZ2luZ19vbkAzLnBuZyV3LTExNjED.089df0fc680998786445a14a977fbfc755641344.png 1.5x"title="Without verbose content or resolver logging, very little information is included"><figcaption class="caption">Without verbose content or resolver logging, very little information is included</figcaption></figure><p>Including verbose content adds the GraphQL query and the request/response headers:<figure class="image prevp"><img srcset="/assets/iwqAbG9nZ2luZ192ZXJib3NlQDMucG5nJQM.a79f8c3114fad938231985d215a1e64ebc216777.png 3x, /assets/Cw2AbG9nZ2luZ192ZXJib3NlQDMucG5nJXctOTQ5Aw.18502c28bca33b4280b5d411b15e614656a2ec92.png, /assets/iw2AbG9nZ2luZ192ZXJib3NlQDMucG5nJXctMTQyNAM.072376d53a3525755857fafbeb1795c4548f0b75.png 1.5x"title="Verbose logging includes the query, and headers"><figcaption class="caption">Verbose logging includes the query, and headers</figcaption></figure><p>To get more insight of what is happening during a request, you can enable resolver logging. This shows which resolvers are run, and what their request templates were:<figure class="image prevp"><img srcset="/assets/iwuAbG9nZ2luZ19yZXNvbHZlcnNAMy5wbmclAw.6313b2ee8f2f70663c77f41193f40edc4725e199.png 3x, /assets/Cw6AbG9nZ2luZ19yZXNvbHZlcnNAMy5wbmcldy03MjUD.0685f70f7a8fea6acbabd47ab105cd7c014df16b.png, /assets/iw6AbG9nZ2luZ19yZXNvbHZlcnNAMy5wbmcldy0xMDg4Aw.2dffa9b36df482c31c04aceb0b3c8be2be2d1bd6.png 1.5x"title="Resolver logging shows what resolvers were run during a request"><figcaption class="caption">Resolver logging shows what resolvers were run during a request</figcaption></figure><p>Then verbose resolver logging also shows the context for each resolver. Since the context is the central part of what a resolver does, this is especially useful for debugging. Usually, it is possible to recreate what happened during an execution with this information.<figure class="image"><img srcset="/assets/Cw-AbG9nZ2luZ19yZXNvbHZlcl92ZXJib3NlQDMucG5nJQM.0b06097b98ea81b2c6537213cacfb35377cb349c.png 3x, /assets/ixGAbG9nZ2luZ19yZXNvbHZlcl92ZXJib3NlQDMucG5nJXctNzQ0Aw.3663e1aada7a6f3486a3ead4dbfab999b72f503a.png, /assets/CxKAbG9nZ2luZ19yZXNvbHZlcl92ZXJib3NlQDMucG5nJXctMTExNgM.9d46921913a16151152f74edf44d83c01c10ba53.png 1.5x"title="Verbose resolver logging shows the value of the context"><figcaption class="caption">Verbose resolver logging shows the value of the context</figcaption></figure><div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Tip</div><div class="tbox-body"><p>Verbose resolver logging allows visibility into what AppSync does during a request. Since GraphQL uses its own logic when it runs the resolvers it can be extremely useful.</div></div></div><h5 id="analyze-logs">Analyze logs</h5><p>Each log entry has a request ID that makes it easy to filter log entries that belong to the same request. This is a UUID that is unique enough that it's not likely that it appears accidentally on an unrelated entry. In practice, whenever you find an entry, you can quickly switch to seeing the whole flow. Just don't forget to use <code>""</code> in the search field for exact match.<figure class="image"><img srcset="/assets/CwyAbG9nZ2luZ19yZXF1ZXN0X2lkQDMucG5nJQM.eb27da6024442ede10d31bb4ed7824ecdf71749a.png 3x, /assets/iw6AbG9nZ2luZ19yZXF1ZXN0X2lkQDMucG5nJXctNjg4Aw.ebebff686a0bc17818998074b93005d982be9fb2.png, /assets/Cw-AbG9nZ2luZ19yZXF1ZXN0X2lkQDMucG5nJXctMTAzMgM.a9c44a6bb4bb82c0fa3a6120a648f295bae50a0d.png 1.5x"title="Each log entry has a request ID to allow easy filtering"><figcaption class="caption">Each log entry has a request ID to allow easy filtering</figcaption></figure><p>As these logs are available in CloudWatch Logs, you can also write complex queries to visualize various aspects of the API. This is done through CloudWatch Logs Insights, and AWS even provides some example queries, such as most invoked resolvers, slowest fields, and most errors.<figure class="image"><img srcset="/assets/iwmAbG9nc19pbnNpZ2h0c0AzLnBuZyUD.64c292d1bbe00be7012f3beca2e5b5415b592107.png 3x, /assets/iwyAbG9nc19pbnNpZ2h0c0AzLnBuZyV3LTEzMzAD.902a9a8fb1b21bb23c314a42ce5af3de750e3a20.png, /assets/iwyAbG9nc19pbnNpZ2h0c0AzLnBuZyV3LTE5OTYD.0fec5056f12312106d3543081405499d538d9d25.png 1.5x"title="CloudWatch Logs Insights allows complex queries agains AppSync logs"><figcaption class="caption">CloudWatch Logs Insights allows complex queries agains AppSync logs</figcaption></figure><div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">More ideas</div><div class="tbox-body"><p>For more ways to analyze logs, see <a href="https://aws.amazon.com/blogs/mobile/getting-more-visibility-into-graphql-performance-with-aws-appsync-logs/">this blog post</a>.</div></div></div><h5 id="log-costs">Log costs</h5><p>As we've seen, when verbose logging for all resolvers are enabled, AppSync generates a lot of messages. While it's not a scalability problem, CloudWatch bills for all these messages and the overal cost can be significant. It can even be more than the cost of the API itself.<p>For example, a simple query with a single level of nesting generated 12 KB of logs. That's $6/million requests at the current price of $0.5/GB. Worse still, without a limited log retention, these messages are stored forever, adding an ever-increasing amount to the monthly bill.<p>Unfortunately, AppSync does not support log sampling. You can implement something like that by enabling logging for short periods of time and disable it outside these sampling periods. For more info, see <a href="https://theburningmonk.com/2020/09/how-to-sample-appsync-resolver-logs/">this blog post</a>.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Tip</div><div class="tbox-body"><p>Watch out for logging costs. Don't keep full resolver logging enabled in production.</div></div></div><h4 id="metrics">Metrics</h4><p>AppSync also pushes various metrics to CloudWatch. They are free of charge and you don't need to enable them. These metrics are a good data source for monitoring, and you can get some visiblity that your API is humming in the background.<p>The AppSync dashboard shows a few of these metrics, but this is just a sample of all the data published. At this moment, there are 22 different metrics you can watch, such as request latency, messages published to subscriptions, active connections, and more. The documentation <a href="https://docs.aws.amazon.com/appsync/latest/devguide/monitoring.html#cw-metrics">has the full list</a> with description of what the numbers mean.<h5 id="4xx-and-5xx-errors">4xx and 5xx errors</h5><p>The first two metrics AppSync publishes are the <code>4xx</code> and the <code>5xx</code> errors. These are HTTP status codes, and codes in the 400-499 range indicates client-side errors, while ones in the 500-599 range indicates server-side errors. At first look, these metrics seem useful: for an HTTP-based server, you could monitor critical and non-critical errors, setting up alarms for each of them.<p>But this does not apply to GraphQL. The specification defines how to handle when a resolver throws an error: return <code>null</code> for that field and add an entry to the <code>errors</code> structure. Because of this, <code>4xx</code> and <code>5xx</code> errors are extremely rare and they provide almost no visibility of the problems with the API or the calls.<figure class="image"><img srcset="/assets/iweAZ3FsX2Vycm9yQDIucG5nJQM.37947ad78f5a789abb4f7d374f32993ad883551a.png 2x, /assets/CwqAZ3FsX2Vycm9yQDIucG5nJXctOTYwAw.eb9246fb186194b0577096483773c7dc2b98c8ee.png, /assets/iwqAZ3FsX2Vycm9yQDIucG5nJXctMTQ0MAM.f80dc9fe53a2bfe46c9c807e9b75f516a6d6479b.png 1.5x"title="Errors in GraphQL still return a 200 status code"><figcaption class="caption">Errors in GraphQL still return a 200 status code</figcaption></figure><p>Because of this, I don't think monitoring these errors provide much value.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Tip</div><div class="tbox-body"><p><code>4xx</code> and <code>5xx</code> errors are HTTP status codes and they don't apply to GraphQL.</div></div></div><h5 id="request-latency">Request latency</h5><p>AppSync publishes request latency which is a useful metric to monitor. On the AppSync console you can see the 10th, 50th, and 90th percentiles, and you can graph additional statistics.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Percentiles</div><div class="tbox-body"><p>The "nth percentile" means that the n% of the requests is below that number. So the 10th percentile means the slowest 10% of the requests is below slower than that, the 50th percentile (also called median) means half of the requests are slower and half faster, the 90th percentile is that only 10% is faster than that.<p>Percentiles are better than averages as a few extreme outliers won't skew it.</div></div></div><h5 id="number-of-requests">Number of requests</h5><p>AppSync publishes the number of requests for all APIs in a region. This is another useful metric as a sudden rise of requests might indicate a problem.<p>This metric is <strong>region-level</strong>. If you have a single API deployed to a region it's not a problem, but with more than one it's hard to get an accurate number per API.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Regional metric</div><div class="tbox-body"><p>The number of requests is aggregated per region, so you can't get an accurate number for a specific API.</div></div></div><h5 id="defined-request-tokens">Request tokens</h5><p>Another regional metric is the number of consumed tokens. A token is a specified amount of processing done to serve a request, so the consumed tokens is based on the number of requests and how much resources each of them requires. Note that it does not take into account <em>other services</em>, such as databases and Lambda functions, this is only for the AppSync-side processing.<p><strong>Tokens are a way to limit AppSync scalability for the AWS account.</strong> It has nothing to do with pricing, as that is still per-request, only to put a cap on the processing power available.<p>It seems a limitation, but it is actually a good feature from AWS. By default, you get 2000 tokens, which is 2000 units of processing per second, so even if you accidentally have an infinite loop or under attack it puts a limit on your costs. This value is adjustable, so you can open a support ticket and AWS increases it for you.<p>This metric is <strong>per region</strong>, so you won't see which API consumes the most tokens.<div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Tip</div><div class="tbox-body"><p>Set up an alarm for this metric so you'll know in advance when you are about to reach it.</div></div></div><h5 id="subscription-metrics">Subscription metrics</h5><p>Most of the metrics AppSync publishes are related to real-time subscription updates. The most useful are <code>ActiveConnections</code> and <code>PublishDataMessageSuccess</code>. There are a lot of error metrics too.<h5 id="monitoring-tips">Monitoring tips</h5><p>My recommendation is to <strong>set up an alarm for the request tokens</strong>, and <strong>monitor the number of requests</strong> and the <strong>50th percentile for latency</strong>.<p>Unfortunately, there is no good metric to monitor errors. Also, AppSync resolvers do not have a concept of consistency or transactions, so it can happen that a query throws an error but a retry is successful. On top of this, GraphQL converts errors into 200 responses with an <code>error</code> field.<p>As a result, there is no metric to monitor client-side or server-side errors and alarm ops built-in.<h4 id="x-ray">X-Ray</h4><p>If enabled, AppSync pushes the flow of request execution to X-Ray. This is a service that integrates with many other AWS services and provides visibility into how a request is handled, such as what functions are called, what databases were involved, and other things.<figure class="image"><img srcset="/assets/CwiAeHJheV90cmFjZUAzLnBuZyUD.5f7596c3d272c510970d75cb65b8e38b95c39175.png 3x, /assets/iwqAeHJheV90cmFjZUAzLnBuZyV3LTM0OQM.d4aa6c4cad2cd2d831f72d2a39c9a20a42c82f97.png, /assets/iwqAeHJheV90cmFjZUAzLnBuZyV3LTUyNAM.6818d97ad7913aaf87d8abd0a6859792f3678181.png 1.5x"title="X-Ray shows each service that processed the request"><figcaption class="caption">X-Ray shows each service that processed the request</figcaption></figure><p>In practice, X-Ray is useful only in a few situations, but since it doesn't need any configuration besides turning it on, it's a nice addition from AWS. Just make sure you don't keep it enabled in production as it might come with a heavy price tag.<figure class="image"><img srcset="/assets/iweAeHJheV9sb2dzQDMucG5nJQM.dc6f62f3e158afded31feb52ffe7081bd5908754.png 3x, /assets/iwqAeHJheV9sb2dzQDMucG5nJXctMTA5MwM.ac73314c56cda5904312e2ed4c512410fe019eaa.png, /assets/iwqAeHJheV9sb2dzQDMucG5nJXctMTY0MAM.bd6e45c6baf9b25bbe8dc1c535e1be382c983750.png 1.5x"title="A log of the processing is also available"><figcaption class="caption">A log of the processing is also available</figcaption></figure><div class="tcolorbox tcolorbox-secondary my-5"><div class="tbox-header fw-bold">Master AppSync and GraphQL</div><div class="tbox-body"><div>Support this book and get all future updates and extra chapters in ebook format.</div><div class="d-flex justify-content-center"><a role="button"href="https://tsallai.gumroad.com/l/graphql-on-aws-appsync-book"class="btn btn-primary not-styled mt-3 text-white">Buy the book</a></div></div></div><div class="pagination row"><div class="col-6"><a href="/aws-appsync/api-configuration/authorization-providers/"class="border rounded d-block p-3"><div class="pagination-sublabel text-muted small">Previous</div><div class="pagination-title">&lt; Authorization providers</div></a></div><div class="col-6"><a href="/aws-appsync/api-configuration/custom-domains/"class="border rounded d-block p-3 text-end ms-auto"><div class="pagination-sublabel text-muted small">Next</div><div class="pagination-title">Custom domains &gt;</div></a></div></div><footer>Â© TamÃ¡s Sallai - <a href="https://advancedweb.hu">advancedweb.hu</a></footer></div><div class="col-lg-3 d-none d-lg-block"><div class="toc-container"><a style="margin-left: 0em"href="#logging-and-monitoring">Logging and monitoring</a> <a style="margin-left: 1em"href="#logging">Logging</a> <a style="margin-left: 2em"href="#setup-logging">Setup logging</a> <a style="margin-left: 2em"href="#log-levels">Log levels</a> <a style="margin-left: 2em"href="#analyze-logs">Analyze logs</a> <a style="margin-left: 2em"href="#log-costs">Log costs</a> <a style="margin-left: 1em"href="#metrics">Metrics</a> <a style="margin-left: 2em"href="#4xx-and-5xx-errors">4xx and 5xx errors</a> <a style="margin-left: 2em"href="#request-latency">Request latency</a> <a style="margin-left: 2em"href="#number-of-requests">Number of requests</a> <a style="margin-left: 2em"href="#defined-request-tokens">Request tokens</a> <a style="margin-left: 2em"href="#subscription-metrics">Subscription metrics</a> <a style="margin-left: 2em"href="#monitoring-tips">Monitoring tips</a> <a style="margin-left: 1em"href="#x-ray">X-Ray</a></div></div></div></div></div><script src="/assets/main.077454cb0bffe3695e9176b1b5f8a7fd9676d920.js"></script>