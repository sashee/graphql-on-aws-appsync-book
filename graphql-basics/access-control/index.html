<!doctypehtml><html lang="en"><meta charset="utf-8"><link rel="icon"type="image/svg+xml"href="/assets/favicon.15621087ab873d484cfdc234ae6d4f0559d2ece6.svg"><meta name="viewport"content="width=device-width,initial-scale=1"><link href="/assets/main.d3c4fd66da45b5fe1b587fd7bc4b64cc7a34bcf3.css"rel="stylesheet"><title>Access control - GraphQL basics - Building GraphQL APIs with AWS AppSync</title><nav class="navbar navbar-light"><div class="container-fluid flex-nowrap"><a class="navbar-brand"href="/">Building GraphQL APIs with AWS AppSync</a> <button class="navbar-toggler d-lg-none align-self-start"type="button"data-bs-toggle="offcanvas"data-bs-target="#offcanvasNavbar"aria-controls="offcanvasNavbar"><span class="navbar-toggler-icon"></span></button><div class="offcanvas offcanvas-end"tabindex="-1"id="offcanvasNavbar"aria-labelledby="offcanvasNavbarLabel"><div class="offcanvas-header"><h5 class="offcanvas-title"id="offcanvasNavbarLabel">Building GraphQL APIs with AWS AppSync</h5><button type="button"class="btn-close text-reset"data-bs-dismiss="offcanvas"aria-label="Close"></button></div><div class="offcanvas-body keep-scrolltop"><ul class="nav navbar-nav justify-content-end flex-grow-1 pe-3"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link active"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link active"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ðŸš§</span><li class="nav-item"><span class="nav-link">RDS ðŸš§</span><li class="nav-item"><span class="nav-link">None ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ðŸš§</span><li class="nav-item"><span class="nav-link">Authorization ðŸš§</span><li class="nav-item"><span class="nav-link">Error handling ðŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ðŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ðŸš§</span><li class="nav-item"><span class="nav-link">CDK ðŸš§</span><li class="nav-item"><span class="nav-link">Amplify ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ðŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul></div></div></div></nav><div class="d-flex flex-row"><ul class="nav flex-column navigation flex-shrink-0 flex-nowrap overflow-auto d-none d-lg-flex keep-scrolltop"><li class="nav-item"><a class="nav-link"href="/introduction/">Introduction</a><li class="nav-item"><a class="nav-link active"href="/graphql-basics/">GraphQL basics</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/graphql-basics/graphql-vs-rest/">GraphQL vs REST</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/schema/">Schema</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/queries-and-mutations/">Queries and Mutations</a><li class="nav-item"><a class="nav-link"href="/graphql-basics/resolvers/">Resolvers</a><li class="nav-item"><a class="nav-link active"href="/graphql-basics/access-control/">Access control</a></ul><li class="nav-item"><a class="nav-link"href="/aws-appsync/">AWS AppSync</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/">API configuration</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/authorization-providers/">Authorization providers</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/logging-and-monitoring/">Logging and monitoring</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/custom-domains/">Custom domains</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/api-configuration/waf/">WAF</a></ul><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/">Data sources</a><ul class="nav flex-column"><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/lambda-1/">Lambda</a><li class="nav-item"><a class="nav-link"href="/aws-appsync/data-sources/dynamodb/">DynamoDB</a><li class="nav-item"><span class="nav-link">HTTP ðŸš§</span><li class="nav-item"><span class="nav-link">RDS ðŸš§</span><li class="nav-item"><span class="nav-link">None ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Resolvers ðŸš§</span><li class="nav-item"><span class="nav-link">Authorization ðŸš§</span><li class="nav-item"><span class="nav-link">Error handling ðŸš§</span><li class="nav-item"><span class="nav-link">Real-time data with subscriptions ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Infrastructure-as-code ðŸš§</span><ul class="nav flex-column"><li class="nav-item"><span class="nav-link">Terraform ðŸš§</span><li class="nav-item"><span class="nav-link">CDK ðŸš§</span><li class="nav-item"><span class="nav-link">Amplify ðŸš§</span></ul><li class="nav-item"><span class="nav-link">Example application ðŸš§</span><li class="nav-item"><a class="nav-link"href="/glossary/">Glossary</a><li class="nav-item"><a class="nav-link"href="/about-the-author/">About the author</a><li class="nav-item"><a class="nav-link"href="/changelog/">Changelog</a><li class="nav-item"><a class="nav-link"href="/copyright/">Copyright</a></ul><div class="flex-grow-1 main container-fluid"><div class="row"><div class="col-lg-9 body p-3"><div class="d-lg-none mb-4"><div class="accordion"id="accordionExample"><div class="accordion-item"><h2 class="accordion-header"id="mobile-toc-header"><button class="accordion-button collapsed"type="button"data-bs-toggle="collapse"data-bs-target="#mobile-toc"aria-expanded="true"aria-controls="mobile-toc">In this chapter</button></h2><div id="mobile-toc"class="accordion-collapse collapse"aria-labelledby="mobile-toc-header"data-bs-parent="#accordionExample"><div class="accordion-body"><div class="toc-container"><a style="margin-left: 0em"href="#access-control">Access control</a> <a style="margin-left: 1em"href="#example-data-model">Example data model</a> <a style="margin-left: 1em"href="#entry-points">Entry points</a> <a style="margin-left: 1em"href="#traversals">Traversals</a> <a style="margin-left: 2em"href="#a-more-complex-example">A more complex example</a> <a style="margin-left: 1em"href="#implementation">Implementation</a> <a style="margin-left: 2em"href="#defined-schema-based-access-control">Schema-based access control</a> <a style="margin-left: 2em"href="#defined-resolver-based-access-control">Resolver-based access control</a> <a style="margin-left: 3em"href="#filtering-results">Filtering results</a></div></div></div></div></div></div><h2 id="access-control">Access control</h2><p>Access control in any API is about the definition of who can do what. For example, there might be users who can add or remove other users, or some data is only accessible to one group but not to others. This is especially important for multitenant applications where you have data for multiple customers available in a single API. But some sort of access control is needed for almost all real-world use-cases.<p>GraphQL is about graphs, so it helps to think in nodes (objects) and edges that connect them. This way, the main question of access control is: what nodes a user can reach?<p>In this chapter, we'll explore the various approaches to control access in a GraphQL API. The methods here are generic to all GraphQL implementations, and not just AWS AppSync.<h3 id="example-data-model">Example data model</h3><p>In this chapter we'll use a data model that has <code>User</code>s, <code>Group</code>s, and <code>Article</code>s. Users belong to <strong>groups</strong>, and these provide <strong>strict separation</strong>, such as Slack workspaces. Users in one group should not know about users in another group.<p>Users in the same group can be <strong>friends</strong>. This provides a link between the <code>User</code> objects.<p>Finally, users can write <strong>articles</strong>. These are <strong>public</strong>, so articles published by a user in a group can be read by users in another group too.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="241"preserveAspectRatio="none"style="width:377px;height:241px;background:#fff"viewBox="0 0 377 241"width="377"><defs><filter height="300%"id="96996d769832bf62be99d99ad9da8daeafed0c18990025a4d2ef4646fa50cc32__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FEFECE"filter="url(#96996d769832bf62be99d99ad9da8daeafed0c18990025a4d2ef4646fa50cc32__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M7 13h78v65.609H7z"></path><circle cx="25.15"cy="29"fill="#FFF"style="stroke:#a80036;stroke-width:1"r="11"></circle><path d="M25.994 35.75H23.54V25.5H20.4v-2.14h8.734v2.14h-3.14v10.25Z"></path><text font-family="sans-serif"font-size="12"textLength="39"x="39.85"y="33.154">Article</text><path style="stroke:#a80036;stroke-width:1.5"d="M8 45h76"></path><text font-family="sans-serif"font-size="11"textLength="32"x="13"y="59.21">id: ID!</text><text font-family="sans-serif"font-size="11"textLength="66"x="13"y="72.015">text: String!</text><path fill="#FEFECE"filter="url(#96996d769832bf62be99d99ad9da8daeafed0c18990025a4d2ef4646fa50cc32__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M164 7h116v78.414H164z"></path><circle cx="203.75"cy="23"fill="#FFF"style="stroke:#a80036;stroke-width:1"r="11"></circle><path d="M204.594 29.75h-2.453V19.5H199v-2.14h8.734v2.14h-3.14v10.25Z"></path><text font-family="sans-serif"font-size="12"textLength="29"x="223.25"y="27.154">User</text><path style="stroke:#a80036;stroke-width:1.5"d="M165 39h114"></path><text font-family="sans-serif"font-size="11"textLength="32"x="170"y="53.21">id: ID!</text><text font-family="sans-serif"font-size="11"textLength="77"x="170"y="66.015">name: String!</text><text font-family="sans-serif"font-size="11"textLength="104"x="170"y="78.82">role: User | Admin</text><path fill="#FEFECE"filter="url(#96996d769832bf62be99d99ad9da8daeafed0c18990025a4d2ef4646fa50cc32__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M177.5 162h89v65.609h-89z"></path><circle cx="201.05"cy="178"fill="#FFF"style="stroke:#a80036;stroke-width:1"r="11"></circle><path d="M201.894 184.75h-2.453V174.5H196.3v-2.14h8.734v2.14h-3.14v10.25Z"></path><text font-family="sans-serif"font-size="12"textLength="38"x="216.95"y="182.154">Group</text><path style="stroke:#a80036;stroke-width:1.5"d="M178.5 194h87"></path><text font-family="sans-serif"font-size="11"textLength="32"x="183.5"y="208.21">id: ID!</text><text font-family="sans-serif"font-size="11"textLength="77"x="183.5"y="221.015">name: String!</text><path d="M280.12 31.75C299.5 31.75 315 36.5 315 46c0 8.61-12.73 13.32-29.54 14.12"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m280.12 60.25 9.09 3.793-4.091-3.907 3.907-4.09-8.906 4.204z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="321"y="50.567">friends</text><path d="M85.06 46h73.72"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m163.99 46-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="103.5"y="39.067">author</text><path d="M222 85.24v71.53"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m222 161.92 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="223"y="128.067">group</text></svg><figcaption class="caption">Data model</figcaption></figure><div class="floatbox floatbox-center"><div class="tcolorbox tcolorbox-info"><div class="tbox-header">Run the example</div><div class="tbox-body"><p>Deploy the schema in your account and run these queries live. You'll need an AWS account, the AWS CLI, and Terraform.<p>How to deploy and more info in the GitHub repository: <a href="https://github.com/sashee/graphql-access-control-example">https://github.com/sashee/graphql-access-control-example</a></div></div></div><p>The schema for these types:<pre class="highlight prevp"><code><span class="hljs-keyword">type</span><span class="hljs-literal"> User</span> {
  username:<span class="hljs-literal"> String</span>!
  friends: [<span class="hljs-literal">User</span>]
  <span class="hljs-comment"># we'll use this to see</span>
  <span class="hljs-comment"># how a naive implementation can be insecure</span>
  group_unsafe:<span class="hljs-literal"> Group</span>
  group:<span class="hljs-literal"> Group</span>
}

<span class="hljs-keyword">type</span><span class="hljs-literal"> Group</span> {
  name:<span class="hljs-literal"> String</span>
  users: [<span class="hljs-literal">User</span>]
}

<span class="hljs-keyword">type</span><span class="hljs-literal"> Article</span> {
  text:<span class="hljs-literal"> String</span>
  author:<span class="hljs-literal"> User</span>
}</code></pre><p>Then the API allows these queries:<pre class="highlight prevp"><code><span class="hljs-keyword">type</span><span class="hljs-literal"> Query</span> {
  user(username:<span class="hljs-literal"> String</span>!):<span class="hljs-literal"> User</span>

  allUsers: [<span class="hljs-literal">User</span>]
  <span class="hljs-meta">@aws_cognito_user_pools</span>(cognito_groups: [<span class="hljs-literal">"admin"</span>])
  <span class="hljs-meta">@aws_auth</span>(cognito_groups: [<span class="hljs-literal">"admin"</span>])

  allArticles: [<span class="hljs-literal">Article</span>]
}</code></pre><figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="298"preserveAspectRatio="none"style="width:586px;height:298px;background:#fff"viewBox="0 0 586 298"width="586"><defs><filter height="300%"id="9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FEFECE"filter="url(#9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M32.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="37.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="40"y="149.107">user1</text><path style="stroke:#a80036;stroke-width:1.5"d="M33.5 153.938h49"></path><path fill="#FEFECE"filter="url(#9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M488.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="493.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="496"y="149.107">user2</text><path style="stroke:#a80036;stroke-width:1.5"d="M489.5 153.938h49"></path><path fill="#FEFECE"filter="url(#9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M163.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="168.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="171"y="149.107">user3</text><path style="stroke:#a80036;stroke-width:1.5"d="M164.5 153.938h49"></path><path fill="#FEFECE"filter="url(#9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M294 122h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="299"y="133.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="302"y="149.107">admin1</text><path style="stroke:#a80036;stroke-width:1.5"d="M295 153.938h60"></path><path fill="#FEFECE"filter="url(#9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M391 122h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="396"y="133.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="399"y="149.107">admin2</text><path style="stroke:#a80036;stroke-width:1.5"d="M392 153.938h60"></path><path fill="#FEFECE"filter="url(#9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M146.5 247h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="166.5"y="260.139">group1</text><path style="stroke:#a80036;stroke-width:1.5"d="M147.5 264.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="152.5"y="278.251">name: Group 1</text><path fill="#FEFECE"filter="url(#9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M421.5 247h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="441.5"y="260.139">group2</text><path style="stroke:#a80036;stroke-width:1.5"d="M422.5 264.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="427.5"y="278.251">name: Group 2</text><path fill="#FEFECE"filter="url(#9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M7 7h102v37.609H7z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="34.5"y="20.139">article1</text><path style="stroke:#a80036;stroke-width:1.5"d="M8 24.969h100"></path><text font-family="sans-serif"font-size="10"textLength="90"x="13"y="38.251">text: Lorem ipsum</text><path fill="#FEFECE"filter="url(#9dc617aa66f90676e54279e249c04b72b8f0e0f2ce10fc2c14a5047001cc8d6b__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M455.5 7h117v37.609h-117z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="490.5"y="20.139">article2</text><path style="stroke:#a80036;stroke-width:1.5"d="M456.5 24.969h115"></path><text font-family="sans-serif"font-size="10"textLength="105"x="461.5"y="38.251">text: Dolor set ameth</text><path d="M83.57 146h74.91"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m163.5 146-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="102"y="139.067">friends</text><path d="M214.58 146h74.04"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m293.8 146-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="232.75"y="139.067">friends</text><path d="M83.57 170.03c23.51 21.18 58.12 52.35 81.19 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m168.65 246.67-3.995-9.002.286 5.65-5.65.285 9.359 3.067z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="137"y="213.067">group</text><path d="M504.24 170.03c-8.79 20.74-21.64 51.07-30.44 71.84"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m471.77 246.67 7.204-6.716-5.246 2.115-2.115-5.247.157 9.848z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="492"y="213.067">group</text><path d="M189 170.03v71.57"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m189 246.67 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="190"y="213.067">group</text><path d="M298.45 170.03c-24.4 21.18-60.33 52.35-84.29 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m210.13 246.67 9.42-2.876-5.643-.4.4-5.643-4.177 8.919z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="263"y="213.067">group</text><path d="M419.4 170.11c-.7 14.01-.05 31.99 5.6 46.89 3.53 9.32 9.63 18.19 15.97 25.71"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m444.5 246.75-2.916-9.407-.377 5.644-5.644-.376 8.937 4.139z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="426"y="213.067">group</text><path d="M58 45.18v71.37"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m58 121.72 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="59"y="88.067">author</text><path d="M514 45.18v71.37"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m514 121.72 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="515"y="88.067">author</text></svg><figcaption class="caption">Example object graph</figcaption></figure><h3 id="entry-points">Entry points</h3><p>Entry points are the queries and the mutations the API defines. They can return a type that provides fields the query can use to move to other objects. These are the easiest to secure, as usually there are not that many of them.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="380"preserveAspectRatio="none"style="width:586px;height:380px;background:#fff"viewBox="0 0 586 380"width="586"><defs><filter height="300%"id="e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#90EE90"filter="url(#e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M32.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="37.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="40"y="149.107">user1</text><path style="stroke:#a80036;stroke-width:1.5"d="M33.5 153.938h49"></path><path fill="#FEFECE"filter="url(#e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M488.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="493.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="496"y="149.107">user2</text><path style="stroke:#a80036;stroke-width:1.5"d="M489.5 153.938h49"></path><path fill="#FEFECE"filter="url(#e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M163.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="168.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="171"y="149.107">user3</text><path style="stroke:#a80036;stroke-width:1.5"d="M164.5 153.938h49"></path><path fill="#FEFECE"filter="url(#e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M294 122h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="299"y="133.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="302"y="149.107">admin1</text><path style="stroke:#a80036;stroke-width:1.5"d="M295 153.938h60"></path><path fill="#FEFECE"filter="url(#e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M391 122h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="396"y="133.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="399"y="149.107">admin2</text><path style="stroke:#a80036;stroke-width:1.5"d="M392 153.938h60"></path><path fill="#FEFECE"filter="url(#e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M146.5 247h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="166.5"y="260.139">group1</text><path style="stroke:#a80036;stroke-width:1.5"d="M147.5 264.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="152.5"y="278.251">name: Group 1</text><path fill="#FEFECE"filter="url(#e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M421.5 247h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="441.5"y="260.139">group2</text><path style="stroke:#a80036;stroke-width:1.5"d="M422.5 264.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="427.5"y="278.251">name: Group 2</text><path fill="#FEFECE"filter="url(#e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M7 7h102v37.609H7z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="34.5"y="20.139">article1</text><path style="stroke:#a80036;stroke-width:1.5"d="M8 24.969h100"></path><text font-family="sans-serif"font-size="10"textLength="90"x="13"y="38.251">text: Lorem ipsum</text><path fill="#FEFECE"filter="url(#e0b4fa220f259f25b605684742e205555865f07ca9a0e8b792b7478cd0873933__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M455.5 7h117v37.609h-117z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="490.5"y="20.139">article2</text><path style="stroke:#a80036;stroke-width:1.5"d="M456.5 24.969h115"></path><text font-family="sans-serif"font-size="10"textLength="105"x="461.5"y="38.251">text: Dolor set ameth</text><path d="M83.57 146h74.91"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m163.5 146-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="102"y="139.067">friends</text><path d="M214.58 146h74.04"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m293.8 146-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="232.75"y="139.067">friends</text><path d="M83.57 170.03c23.51 21.18 58.12 52.35 81.19 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m168.65 246.67-3.995-9.002.286 5.65-5.65.285 9.359 3.067z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="137"y="213.067">group</text><path d="M504.24 170.03c-8.79 20.74-21.64 51.07-30.44 71.84"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m471.77 246.67 7.204-6.716-5.246 2.115-2.115-5.247.157 9.848z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="492"y="213.067">group</text><path d="M189 170.03v71.57"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m189 246.67 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="190"y="213.067">group</text><path d="M298.45 170.03c-24.4 21.18-60.33 52.35-84.29 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m210.13 246.67 9.42-2.876-5.643-.4.4-5.643-4.177 8.919z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="263"y="213.067">group</text><path d="M419.4 170.11c-.7 14.01-.05 31.99 5.6 46.89 3.53 9.32 9.63 18.19 15.97 25.71"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m444.5 246.75-2.916-9.407-.377 5.644-5.644-.376 8.937 4.139z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="426"y="213.067">group</text><path d="M58 45.18v71.37"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m58 121.72 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="59"y="88.067">author</text><path d="M514 45.18v71.37"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m514 121.72 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="515"y="88.067">author</text><rect fill="#DDD"height="58.891"rx="5"ry="5"style="stroke:#000;stroke-width:1"width="157"x="207.75"y="305.609"></rect><text font-family="sans-serif"font-size="14"textLength="36"x="213.75"y="323.604">user(</text><text font-family="sans-serif"font-size="14"textLength="129"x="229.75"y="339.901">username: "user1"</text><text font-family="sans-serif"font-size="14"textLength="5"x="213.75"y="356.198">)</text></svg><figcaption class="caption">User query</figcaption></figure><p>For example, the <code>user(username: String!): User</code> query returns a <code>User</code> object. The query can then define the <em>fields</em> it needs and those can include other types too. Such as this query:<pre class="highlight prevp"><code><span class="hljs-keyword">query</span><span class="hljs-literal"> MyQuery</span> {
  user(username: <span class="hljs-string">"user1"</span>) {
    username
    friends {
      username
    }
  }
}</code></pre><p>The <code>user</code> query returns a <code>User</code> object, then the <code>friends</code> returns other <code>User</code>s. Here, the query provides the <em>entry point</em> to the object graph. If a user can't send a query then they can't enter the graph there.<p>For example, the <code>allUsers</code> provides a way to retrieve multiple <code>User</code> objects. If a normal (non-admin) user can't call it then they can't accidentally get users from other groups.<p>Both queries and mutations can return complex types that allow moving to other objects in the graph, but mutations also make <em>changes</em>, so it's especially important to implement access control for them.<h3 id="traversals">Traversals</h3><p>When a query (or a mutation) has access to an object, it can move to other objects from there, allowing it to reach data deeper in the graph. In the previous example we saw that a Query can return an object and using its <code>friends</code> field it is possible to get other users:<pre class="highlight prevp"><code><span class="hljs-keyword">query</span><span class="hljs-literal"> MyQuery</span> {
  user(username: <span class="hljs-string">"user1"</span>) {
    username
    friends {
      username
    }
  }
}</code></pre><figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="413"preserveAspectRatio="none"style="width:586px;height:413px;background:#fff"viewBox="0 0 586 413"width="586"><defs><filter height="300%"id="2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#90EE90"filter="url(#2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M32.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="37.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="40"y="149.107">user1</text><path style="stroke:#a80036;stroke-width:1.5"d="M33.5 153.938h49"></path><path fill="#FEFECE"filter="url(#2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M488.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="493.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="496"y="149.107">user2</text><path style="stroke:#a80036;stroke-width:1.5"d="M489.5 153.938h49"></path><path fill="#90EE90"filter="url(#2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M163.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="168.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="171"y="149.107">user3</text><path style="stroke:#a80036;stroke-width:1.5"d="M164.5 153.938h49"></path><path fill="#FEFECE"filter="url(#2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M294 122h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="299"y="133.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="302"y="149.107">admin1</text><path style="stroke:#a80036;stroke-width:1.5"d="M295 153.938h60"></path><path fill="#FEFECE"filter="url(#2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M391 122h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="396"y="133.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="399"y="149.107">admin2</text><path style="stroke:#a80036;stroke-width:1.5"d="M392 153.938h60"></path><path fill="#FEFECE"filter="url(#2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M146.5 247h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="166.5"y="260.139">group1</text><path style="stroke:#a80036;stroke-width:1.5"d="M147.5 264.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="152.5"y="278.251">name: Group 1</text><path fill="#FEFECE"filter="url(#2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M421.5 247h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="441.5"y="260.139">group2</text><path style="stroke:#a80036;stroke-width:1.5"d="M422.5 264.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="427.5"y="278.251">name: Group 2</text><path fill="#FEFECE"filter="url(#2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M7 7h102v37.609H7z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="34.5"y="20.139">article1</text><path style="stroke:#a80036;stroke-width:1.5"d="M8 24.969h100"></path><text font-family="sans-serif"font-size="10"textLength="90"x="13"y="38.251">text: Lorem ipsum</text><path fill="#FEFECE"filter="url(#2e084648e524a13e25655acc7e676c2f64ca540a50f32a0dc458e11b0f6b2461__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M455.5 7h117v37.609h-117z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="490.5"y="20.139">article2</text><path style="stroke:#a80036;stroke-width:1.5"d="M456.5 24.969h115"></path><text font-family="sans-serif"font-size="10"textLength="105"x="461.5"y="38.251">text: Dolor set ameth</text><path d="M83.57 146h74.91"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m163.5 146-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="102"y="139.067">friends</text><path d="M214.58 146h74.04"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m293.8 146-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="232.75"y="139.067">friends</text><path d="M83.57 170.03c23.51 21.18 58.12 52.35 81.19 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m168.65 246.67-3.995-9.002.286 5.65-5.65.285 9.359 3.067z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="137"y="213.067">group</text><path d="M504.24 170.03c-8.79 20.74-21.64 51.07-30.44 71.84"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m471.77 246.67 7.204-6.716-5.246 2.115-2.115-5.247.157 9.848z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="492"y="213.067">group</text><path d="M189 170.03v71.57"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m189 246.67 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="190"y="213.067">group</text><path d="M298.45 170.03c-24.4 21.18-60.33 52.35-84.29 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m210.13 246.67 9.42-2.876-5.643-.4.4-5.643-4.177 8.919z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="263"y="213.067">group</text><path d="M419.4 170.11c-.7 14.01-.05 31.99 5.6 46.89 3.53 9.32 9.63 18.19 15.97 25.71"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m444.5 246.75-2.916-9.407-.377 5.644-5.644-.376 8.937 4.139z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="426"y="213.067">group</text><path d="M58 45.18v71.37"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m58 121.72 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="59"y="88.067">author</text><path d="M514 45.18v71.37"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m514 121.72 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="515"y="88.067">author</text><rect fill="#DDD"height="91.484"rx="5"ry="5"style="stroke:#000;stroke-width:1"width="157"x="207.75"y="305.609"></rect><text font-family="sans-serif"font-size="14"textLength="36"x="213.75"y="323.604">user(</text><text font-family="sans-serif"font-size="14"textLength="129"x="229.75"y="339.901">username: "user1"</text><text font-family="sans-serif"font-size="14"textLength="18"x="213.75"y="356.198">) {</text><text font-family="sans-serif"font-size="14"textLength="47"x="229.75"y="372.495">friends</text><text font-family="sans-serif"font-size="14"textLength="9"x="213.75"y="388.792">}</text></svg><figcaption class="caption">Friends field</figcaption></figure><p>The above query returns the <code>user1</code> object, as it is returned by the <code>user</code> query, and all its friends as they are returned by the <code>friends</code> <em>field</em>. Moreover, a query can also fetch the friends of the user's friends:<pre class="highlight prevp"><code><span class="hljs-keyword">query</span><span class="hljs-literal"> MyQuery</span> {
  user(username: <span class="hljs-string">"user1"</span>) {
    username
    friends {
      username
      friends {
        username
      }
    }
  }
}</code></pre><figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="445"preserveAspectRatio="none"style="width:586px;height:445px;background:#fff"viewBox="0 0 586 445"width="586"><defs><filter height="300%"id="6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#90EE90"filter="url(#6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M32.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="37.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="40"y="149.107">user1</text><path style="stroke:#a80036;stroke-width:1.5"d="M33.5 153.938h49"></path><path fill="#FEFECE"filter="url(#6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M488.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="493.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="496"y="149.107">user2</text><path style="stroke:#a80036;stroke-width:1.5"d="M489.5 153.938h49"></path><path fill="#90EE90"filter="url(#6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M163.5 122h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="168.5"y="133.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="171"y="149.107">user3</text><path style="stroke:#a80036;stroke-width:1.5"d="M164.5 153.938h49"></path><path fill="#90EE90"filter="url(#6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M294 122h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="299"y="133.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="302"y="149.107">admin1</text><path style="stroke:#a80036;stroke-width:1.5"d="M295 153.938h60"></path><path fill="#FEFECE"filter="url(#6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M391 122h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="396"y="133.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="399"y="149.107">admin2</text><path style="stroke:#a80036;stroke-width:1.5"d="M392 153.938h60"></path><path fill="#FEFECE"filter="url(#6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M146.5 247h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="166.5"y="260.139">group1</text><path style="stroke:#a80036;stroke-width:1.5"d="M147.5 264.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="152.5"y="278.251">name: Group 1</text><path fill="#FEFECE"filter="url(#6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M421.5 247h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="441.5"y="260.139">group2</text><path style="stroke:#a80036;stroke-width:1.5"d="M422.5 264.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="427.5"y="278.251">name: Group 2</text><path fill="#FEFECE"filter="url(#6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M7 7h102v37.609H7z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="34.5"y="20.139">article1</text><path style="stroke:#a80036;stroke-width:1.5"d="M8 24.969h100"></path><text font-family="sans-serif"font-size="10"textLength="90"x="13"y="38.251">text: Lorem ipsum</text><path fill="#FEFECE"filter="url(#6f0af1a6cdb5d269144c07d91bae8bb30b0746904b094dbc39d8b6e2ff0b3f96__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M455.5 7h117v37.609h-117z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="490.5"y="20.139">article2</text><path style="stroke:#a80036;stroke-width:1.5"d="M456.5 24.969h115"></path><text font-family="sans-serif"font-size="10"textLength="105"x="461.5"y="38.251">text: Dolor set ameth</text><path d="M83.57 146h74.91"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m163.5 146-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="102"y="139.067">friends</text><path d="M214.58 146h74.04"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m293.8 146-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="232.75"y="139.067">friends</text><path d="M83.57 170.03c23.51 21.18 58.12 52.35 81.19 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m168.65 246.67-3.995-9.002.286 5.65-5.65.285 9.359 3.067z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="137"y="213.067">group</text><path d="M504.24 170.03c-8.79 20.74-21.64 51.07-30.44 71.84"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m471.77 246.67 7.204-6.716-5.246 2.115-2.115-5.247.157 9.848z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="492"y="213.067">group</text><path d="M189 170.03v71.57"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m189 246.67 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="190"y="213.067">group</text><path d="M298.45 170.03c-24.4 21.18-60.33 52.35-84.29 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m210.13 246.67 9.42-2.876-5.643-.4.4-5.643-4.177 8.919z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="263"y="213.067">group</text><path d="M419.4 170.11c-.7 14.01-.05 31.99 5.6 46.89 3.53 9.32 9.63 18.19 15.97 25.71"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m444.5 246.75-2.916-9.407-.377 5.644-5.644-.376 8.937 4.139z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="426"y="213.067">group</text><path d="M58 45.18v71.37"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m58 121.72 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="59"y="88.067">author</text><path d="M514 45.18v71.37"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m514 121.72 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="515"y="88.067">author</text><rect fill="#DDD"height="124.078"rx="5"ry="5"style="stroke:#000;stroke-width:1"width="157"x="207.75"y="305.609"></rect><text font-family="sans-serif"font-size="14"textLength="36"x="213.75"y="323.604">user(</text><text font-family="sans-serif"font-size="14"textLength="129"x="229.75"y="339.901">username: "user1"</text><text font-family="sans-serif"font-size="14"textLength="18"x="213.75"y="356.198">) {</text><text font-family="sans-serif"font-size="14"textLength="60"x="229.75"y="372.495">friends {</text><text font-family="sans-serif"font-size="14"textLength="47"x="245.75"y="388.792">friends</text><text font-family="sans-serif"font-size="14"textLength="9"x="229.75"y="405.089">}</text><text font-family="sans-serif"font-size="14"textLength="9"x="213.75"y="421.386">}</text></svg><figcaption class="caption">Friends' friends</figcaption></figure><h4 id="a-more-complex-example">A more complex example</h4><p>But there is a more sinister path built-in to the data model that can expose more data. Let's say the entry points are secure: an administrator can use the <code>user</code> Query to get users in its own group. With this, <code>admin1</code> can only get three users: <code>user1</code>, <code>user3</code>, and <code>admin1</code>, and none from the other group. Since groups are supposed to provide hard boundaries between users, this is the expected functionality.<p>But <strong>articles</strong> are outside the group separation, and they have an <strong>author</strong>. Because of this, users from one group should have limited access to other groups.<p>Visually, an administrator should be able to reach these objects:<figure class="plantuml image prevp"><svg xmlns="http://www.w3.org/2000/svg"height="345"preserveAspectRatio="none"style="width:590px;height:345px;background:#fff"viewBox="0 0 590 345"width="590"><defs><filter height="300%"id="cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FFF"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#000;stroke-width:1.5;fill:#fff"d="M7 119h356v214H7z"></path><path d="M81 119v9.297l-10 10H7"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><text font-family="sans-serif"font-size="14"font-weight="bold"textLength="64"x="10"y="132.995">Group 1</text><path fill="#FFF"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#000;stroke-width:1.5;fill:#fff"d="M387 119h185v214H387z"></path><path d="M461 119v9.297l-10 10h-64"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><text font-family="sans-serif"font-size="14"font-weight="bold"textLength="64"x="390"y="132.995">Group 2</text><path fill="#90EE90"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M23.5 154h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="28.5"y="165.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="31"y="181.107">user1</text><path style="stroke:#a80036;stroke-width:1.5"d="M24.5 185.938h49"></path><path fill="#90EE90"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M285 154h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="290"y="165.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="293"y="181.107">admin1</text><path style="stroke:#a80036;stroke-width:1.5"d="M286 185.938h60"></path><path fill="#90EE90"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M154.5 154h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="159.5"y="165.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="162"y="181.107">user3</text><path style="stroke:#a80036;stroke-width:1.5"d="M155.5 185.938h49"></path><path fill="#90EE90"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M137.5 279h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="157.5"y="292.139">group1</text><path style="stroke:#a80036;stroke-width:1.5"d="M138.5 296.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="143.5"y="310.251">name: Group 1</text><path fill="#90EE90"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M502.5 154h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="507.5"y="165.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="510"y="181.107">user2</text><path style="stroke:#a80036;stroke-width:1.5"d="M503.5 185.938h49"></path><path fill="#FEFECE"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M405 154h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="410"y="165.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="413"y="181.107">admin2</text><path style="stroke:#a80036;stroke-width:1.5"d="M406 185.938h60"></path><path fill="#FEFECE"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M436.5 279h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="456.5"y="292.139">group2</text><path style="stroke:#a80036;stroke-width:1.5"d="M437.5 296.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="442.5"y="310.251">name: Group 2</text><path fill="#90EE90"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M8 7h82v49.25H8z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="25.5"y="20.139">article1</text><path style="stroke:#a80036;stroke-width:1.5"d="M9 24.969h80"></path><text font-family="sans-serif"font-size="10"textLength="23"x="14"y="38.251">text:</text><text font-family="sans-serif"font-size="10"textLength="64"x="20"y="49.892">Lorem ipsum</text><path fill="#90EE90"filter="url(#cf61df29a92c9be3c5e83f0c6ef5579bb30809eabc4c91815990dd4fdf66f3bc__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M479.5 7h97v49.25h-97z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="504.5"y="20.139">article2</text><path style="stroke:#a80036;stroke-width:1.5"d="M480.5 24.969h95"></path><text font-family="sans-serif"font-size="10"textLength="23"x="485.5"y="38.251">text:</text><text font-family="sans-serif"font-size="10"textLength="79"x="491.5"y="49.892">Dolor set ameth</text><path d="M74.57 178h74.91"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m154.5 178-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="93"y="171.067">friends</text><path d="M205.58 178h74.04"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m284.8 178-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="223.75"y="171.067">friends</text><path d="M74.57 202.03c23.51 21.18 58.12 52.35 81.19 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m159.65 278.67-3.995-9.002.286 5.65-5.65.285 9.359 3.067z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="128"y="245.067">group</text><path d="M518.44 202.03c-8.62 20.74-21.21 51.07-29.83 71.84"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m486.61 278.67 7.136-6.788-5.225 2.168-2.168-5.226.257 9.846z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="505"y="245.067">group</text><path d="M180 202.03v71.57"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m180 278.67 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="181"y="245.067">group</text><path d="M289.45 202.03c-24.4 21.18-60.33 52.35-84.29 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m201.13 278.67 9.42-2.876-5.643-.4.4-5.643-4.177 8.919z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="253"y="245.067">group</text><path d="M431.39 202.16c-1.76 14.02-2.16 32 3.61 46.84 3.8 9.78 10.63 18.78 17.79 26.27"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m456.32 278.83-3.498-9.207-.023 5.657-5.657-.023 9.178 3.573z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="436"y="245.067">group</text><path d="M49 56.04v92.69"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m49 153.95 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="50"y="99.067">author</text><path d="M528 56.04v92.69"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m528 153.95 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="529"y="99.067">author</text></svg><figcaption class="caption">Objects admin1 can reach</figcaption></figure><p>Let's focus on the <code>User.group</code> field! Without taking articles into account, limiting the entry points is enough: if a user can only get users in the same group, then there is no way allowing access to the <code>group</code> field would create a vulnerability.<figure class="plantuml image prevp"><svg xmlns="http://www.w3.org/2000/svg"height="412"preserveAspectRatio="none"style="width:584px;height:412px;background:#fff"viewBox="0 0 584 412"width="584"><defs><filter height="300%"id="d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FFF"filter="url(#d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a)"style="stroke:#000;stroke-width:1.5;fill:#fff"d="M7 7h356v214H7z"></path><path d="M81 7v9.297l-10 10H7"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><text font-family="sans-serif"font-size="14"font-weight="bold"textLength="64"x="10"y="20.995">Group 1</text><path fill="#FFF"filter="url(#d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a)"style="stroke:#000;stroke-width:1.5;fill:#fff"d="M387 7h185v214H387z"></path><path d="M461 7v9.297l-10 10h-64"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><text font-family="sans-serif"font-size="14"font-weight="bold"textLength="64"x="390"y="20.995">Group 2</text><path fill="#90EE90"filter="url(#d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M23.5 42h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="28.5"y="53.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="31"y="69.107">user1</text><path style="stroke:#a80036;stroke-width:1.5"d="M24.5 73.938h49"></path><path fill="#90EE90"filter="url(#d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M285 42h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="290"y="53.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="293"y="69.107">admin1</text><path style="stroke:#a80036;stroke-width:1.5"d="M286 73.938h60"></path><path fill="#90EE90"filter="url(#d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M154.5 42h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="159.5"y="53.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="162"y="69.107">user3</text><path style="stroke:#a80036;stroke-width:1.5"d="M155.5 73.938h49"></path><path fill="#90EE90"filter="url(#d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M137.5 167h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="157.5"y="180.139">group1</text><path style="stroke:#a80036;stroke-width:1.5"d="M138.5 184.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="143.5"y="198.251">name: Group 1</text><path fill="#FEFECE"filter="url(#d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M502.5 42h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="507.5"y="53.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="510"y="69.107">user2</text><path style="stroke:#a80036;stroke-width:1.5"d="M503.5 73.938h49"></path><path fill="#FEFECE"filter="url(#d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M405 42h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="410"y="53.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="413"y="69.107">admin2</text><path style="stroke:#a80036;stroke-width:1.5"d="M406 73.938h60"></path><path fill="#FEFECE"filter="url(#d61cfef0bfcad5e0cd370574aa2a2f70c8deea8d05903bc15fc6c8089673c73e__a)"style="stroke:#a80036;stroke-width:1.5;fill:#fefece"d="M436.5 167h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="456.5"y="180.139">group2</text><path style="stroke:#a80036;stroke-width:1.5"d="M437.5 184.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="442.5"y="198.251">name: Group 2</text><path d="M74.57 66h74.91"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m154.5 66-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="93"y="59.067">friends</text><path d="M205.58 66h74.04"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m284.8 66-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="223.75"y="59.067">friends</text><path d="M74.57 90.03c23.51 21.18 58.12 52.35 81.19 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m159.65 166.67-3.995-9.002.286 5.65-5.65.285 9.359 3.067z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="128"y="133.067">group</text><path d="M518.44 90.03c-8.62 20.74-21.21 51.07-29.83 71.84"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m486.61 166.67 7.136-6.788-5.225 2.168-2.168-5.226.257 9.846z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="505"y="133.067">group</text><path d="M180 90.03v71.57"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m180 166.67 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="181"y="133.067">group</text><path d="M289.45 90.03c-24.4 21.18-60.33 52.35-84.29 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m201.13 166.67 9.42-2.876-5.643-.4.4-5.643-4.177 8.919z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="253"y="133.067">group</text><path d="M431.39 90.16c-1.76 14.02-2.16 32 3.61 46.84 3.8 9.78 10.63 18.78 17.79 26.27"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m456.32 166.83-3.498-9.207-.023 5.657-5.657-.023 9.178 3.573z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="436"y="133.067">group</text><rect fill="#DDD"height="156.672"rx="5"ry="5"style="stroke:#000;stroke-width:1"width="157"x="206.5"y="240"></rect><text font-family="sans-serif"font-size="14"textLength="36"x="212.5"y="257.995">user(</text><text font-family="sans-serif"font-size="14"textLength="129"x="228.5"y="274.292">username: "user1"</text><text font-family="sans-serif"font-size="14"textLength="18"x="212.5"y="290.589">) {</text><text font-family="sans-serif"font-size="14"textLength="108"x="228.5"y="306.886">group_unsafe {</text><text font-family="sans-serif"font-size="14"textLength="52"x="244.5"y="323.183">users {</text><text font-family="sans-serif"font-size="14"textLength="70"x="260.5"y="339.479">username</text><text font-family="sans-serif"font-size="14"textLength="9"x="244.5"y="355.776">}</text><text font-family="sans-serif"font-size="14"textLength="9"x="228.5"y="372.073">}</text><text font-family="sans-serif"font-size="14"textLength="9"x="212.5"y="388.37">}</text></svg><figcaption class="caption">Navigating to the group and listing the users</figcaption></figure><p>But add the articles and suddenly a user from one group can navigate to another group and list users there:<figure class="plantuml image prevp"><svg xmlns="http://www.w3.org/2000/svg"height="524"preserveAspectRatio="none"style="width:590px;height:524px;background:#fff"viewBox="0 0 590 524"width="590"><defs><filter height="300%"id="e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FFF"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#000;stroke-width:1.5;fill:#fff"d="M7 119h356v214H7z"></path><path d="M81 119v9.297l-10 10H7"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><text font-family="sans-serif"font-size="14"font-weight="bold"textLength="64"x="10"y="132.995">Group 1</text><path fill="#FFF"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#000;stroke-width:1.5;fill:#fff"d="M387 119h185v214H387z"></path><path d="M461 119v9.297l-10 10h-64"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><text font-family="sans-serif"font-size="14"font-weight="bold"textLength="64"x="390"y="132.995">Group 2</text><path fill="#90EE90"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M23.5 154h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="28.5"y="165.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="31"y="181.107">user1</text><path style="stroke:#a80036;stroke-width:1.5"d="M24.5 185.938h49"></path><path fill="#90EE90"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M285 154h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="290"y="165.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="293"y="181.107">admin1</text><path style="stroke:#a80036;stroke-width:1.5"d="M286 185.938h60"></path><path fill="#90EE90"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M154.5 154h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="159.5"y="165.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="162"y="181.107">user3</text><path style="stroke:#a80036;stroke-width:1.5"d="M155.5 185.938h49"></path><path fill="#90EE90"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M137.5 279h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="157.5"y="292.139">group1</text><path style="stroke:#a80036;stroke-width:1.5"d="M138.5 296.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="143.5"y="310.251">name: Group 1</text><path fill="#90EE90"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M502.5 154h51v47.938h-51z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="41"x="507.5"y="165.139">Â«userÂ»</text><text font-family="sans-serif"font-size="12"textLength="36"x="510"y="181.107">user2</text><path style="stroke:#a80036;stroke-width:1.5"d="M503.5 185.938h49"></path><path fill="#90EE90"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M405 154h62v47.938h-62z"></path><text font-family="sans-serif"font-size="12"font-style="italic"textLength="52"x="410"y="165.139">Â«adminÂ»</text><text font-family="sans-serif"font-size="12"textLength="46"x="413"y="181.107">admin2</text><path style="stroke:#a80036;stroke-width:1.5"d="M406 185.938h60"></path><path fill="#90EE90"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M436.5 279h85v37.609h-85z"></path><text font-family="sans-serif"font-size="12"textLength="45"x="456.5"y="292.139">group2</text><path style="stroke:#a80036;stroke-width:1.5"d="M437.5 296.969h83"></path><text font-family="sans-serif"font-size="10"textLength="73"x="442.5"y="310.251">name: Group 2</text><path fill="#90EE90"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M8 7h82v49.25H8z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="25.5"y="20.139">article1</text><path style="stroke:#a80036;stroke-width:1.5"d="M9 24.969h80"></path><text font-family="sans-serif"font-size="10"textLength="23"x="14"y="38.251">text:</text><text font-family="sans-serif"font-size="10"textLength="64"x="20"y="49.892">Lorem ipsum</text><path fill="#90EE90"filter="url(#e45a4dee720a6f4c696f533e9eb42d3a2215fba71983e9da0cdb56d7c2d2e235__a)"style="stroke:#a80036;stroke-width:1.5;fill:#90ee90"d="M479.5 7h97v49.25h-97z"></path><text font-family="sans-serif"font-size="12"textLength="47"x="504.5"y="20.139">article2</text><path style="stroke:#a80036;stroke-width:1.5"d="M480.5 24.969h95"></path><text font-family="sans-serif"font-size="10"textLength="23"x="485.5"y="38.251">text:</text><text font-family="sans-serif"font-size="10"textLength="79"x="491.5"y="49.892">Dolor set ameth</text><path d="M74.57 178h74.91"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m154.5 178-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="93"y="171.067">friends</text><path d="M205.58 178h74.04"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m284.8 178-9-4 4 4-4 4 9-4z"></path><text font-family="sans-serif"font-size="13"textLength="43"x="223.75"y="171.067">friends</text><path d="M74.57 202.03c23.51 21.18 58.12 52.35 81.19 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m159.65 278.67-3.995-9.002.286 5.65-5.65.285 9.359 3.067z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="128"y="245.067">group</text><path d="M518.44 202.03c-8.62 20.74-21.21 51.07-29.83 71.84"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m486.61 278.67 7.136-6.788-5.225 2.168-2.168-5.226.257 9.846z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="505"y="245.067">group</text><path d="M180 202.03v71.57"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m180 278.67 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="181"y="245.067">group</text><path d="M289.45 202.03c-24.4 21.18-60.33 52.35-84.29 73.14"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m201.13 278.67 9.42-2.876-5.643-.4.4-5.643-4.177 8.919z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="253"y="245.067">group</text><path d="M431.39 202.16c-1.76 14.02-2.16 32 3.61 46.84 3.8 9.78 10.63 18.78 17.79 26.27"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m456.32 278.83-3.498-9.207-.023 5.657-5.657-.023 9.178 3.573z"></path><text font-family="sans-serif"font-size="13"textLength="37"x="436"y="245.067">group</text><path d="M49 56.04v92.69"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m49 153.95 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="50"y="99.067">author</text><path d="M528 56.04v92.69"fill="none"style="stroke:#a80036;stroke-width:1;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m528 153.95 4-9-4 4-4-4 4 9z"></path><text font-family="sans-serif"font-size="13"textLength="42"x="529"y="99.067">author</text><rect fill="#DDD"height="156.672"rx="5"ry="5"style="stroke:#000;stroke-width:1"width="152"x="212.25"y="352"></rect><text font-family="sans-serif"font-size="14"textLength="77"x="218.25"y="369.995">allArticles {</text><text font-family="sans-serif"font-size="14"textLength="58"x="234.25"y="386.292">author {</text><text font-family="sans-serif"font-size="14"textLength="108"x="250.25"y="402.589">group_unsafe {</text><text font-family="sans-serif"font-size="14"textLength="52"x="266.25"y="418.886">users {</text><text font-family="sans-serif"font-size="14"textLength="70"x="282.25"y="435.183">username</text><text font-family="sans-serif"font-size="14"textLength="9"x="266.25"y="451.479">}</text><text font-family="sans-serif"font-size="14"textLength="9"x="250.25"y="467.776">}</text><text font-family="sans-serif"font-size="14"textLength="9"x="234.25"y="484.073">}</text><text font-family="sans-serif"font-size="14"textLength="9"x="218.25"y="500.37">}</text></svg><figcaption class="caption">Navigating from the article to the author and then the group</figcaption></figure><p>This shows how entry points and traversals together define what objects are accessible to users. Securing entry points alone is misleading: an unrelated change (adding a new object type) can open ways to navigate from the allowed portion of the object graph to other parts.<h3 id="implementation">Implementation</h3><p>Now that we've discussed the concepts of GraphQL access control, let's see how to implement it! We'll first look into configuring access on the schema-level, as that is usually the easiest to apply. Then we'll move on the resolver-based implementation, which gives more freedom but also more nuanced.<h4 id="defined-schema-based-access-control">Schema-based access control</h4><p>The easiest approach is to look up what <a href="/graphql-basics/schema/#defined-directives">directives</a> the server you are using supports and add them to the Query/Mutation or Type fields you want to restrict access to. This makes security easy to reason about, as it is defined in the schema with the rest of the data model.<p>In the case of AppSync, it supports the <code>@aws_auth</code> directive with the <code>cognito_groups</code> argument that denies access to the field for any users not in the specified Cognito group:<pre class="highlight prevp"><code><span class="hljs-keyword">type</span><span class="hljs-literal"> Query</span> {
  <span class="hljs-comment"># only admins can call this</span>
  allUsers: [<span class="hljs-literal">User</span>]
  <span class="hljs-meta">@aws_auth</span>(cognito_groups: [<span class="hljs-literal">"admin"</span>])
}</code></pre><p>When a non-administrator sends a query:<pre class="highlight prevp"><code><span class="hljs-keyword">query</span><span class="hljs-literal"> MyQuery</span> {
  allUsers {
    username
  }
}</code></pre><p>The GraphQL server returns an error without running the resolver:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allUsers"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"errors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"allUsers"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"errorType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Unauthorized"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"errorInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"locations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"line"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"column"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"sourceName"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Not Authorized to access
        allUsers on type Query"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span></code></pre><p>Directives for access control works for both entry points (<code>Query.allUsers</code>) and fields (<code>User.group</code>, <code>User.friends</code>). They are great to deny access to data for groups of users.<p>The main problem with directives is that they are usually <strong>all-or-nothing</strong>. If a user is in the group then they can use that field, if they are not then they are denied. This level of granularity is good for the <code>allUsers</code> query, but it is not possible to restrict the <code>user(username: String!)</code> to allow users to fetch only themselves.<p>The second problem with directives is that GraphQL does not define a common set of them for access control. This means you <strong>need to check what the server you are using supports</strong>. And even then it can be confusing, for example, AppSync supports the <code>@aws_auth(cognito_groups)</code> as well as the <code>aws_cognito_user_pools</code> directives and they <a href="https://advancedweb.hu/appsync-cognito-directives/#results">behave differently</a> depending on the API configuration.<h4 id="defined-resolver-based-access-control">Resolver-based access control</h4><p>Resolvers provide the implementation how the GraphQL server returns the results for a query. As we've seen in the <a href="/graphql-basics/resolvers/#defined-resolvers">Resolvers</a> chapter, they work on the field-level and the server runs them independently depending on what fields are requested by the client.<p>They are written in a language the GraphQL server supports, but a common property of all implementations is that they provide fine-level control over how they work. For example, AppSync allows a Lambda function to act as a resolver, and you can write arbitrary code there. This means that you can implement access control in the resolver code and that provides freedom to define whatever access control scheme you want.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="542"preserveAspectRatio="none"style="width:441px;height:542px;background:#fff"viewBox="0 0 441 542"width="441"><defs><filter height="300%"id="30c5b4e18a6e75cdfbd596c8c4d2ebd1160d491507284d91f09a572378d3b670__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FFF"filter="url(#30c5b4e18a6e75cdfbd596c8c4d2ebd1160d491507284d91f09a572378d3b670__a)"style="stroke:#000;stroke-width:2;fill:#fff"d="M136 221.656h291V351.32H136zm0 143.664h291v85.398H136z"></path><path style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5"d="M201 69.594v466.39m162-466.39v466.39"></path><text font-family="sans-serif"font-size="14"textLength="60"x="168"y="49.995">GraphQL</text><text font-family="sans-serif"font-size="14"textLength="60"x="168"y="66.292">backend</text><circle cx="201"cy="21"fill="#FEFECE"filter="url(#30c5b4e18a6e75cdfbd596c8c4d2ebd1160d491507284d91f09a572378d3b670__a)"style="stroke:#a80036;stroke-width:2"r="12"></circle><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m197 9 6-5-2 5 2 5-6-5z"></path><text font-family="sans-serif"font-size="14"textLength="64"x="328"y="66.292">database</text><path d="M345 17.297c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26"fill="#FEFECE"filter="url(#30c5b4e18a6e75cdfbd596c8c4d2ebd1160d491507284d91f09a572378d3b670__a)"style="stroke:#000;stroke-width:1.5;fill:#fefece"></path><path d="M345 17.297c0 10 18 10 18 10s18 0 18-10"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m189 202.656 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M0 206.656h195"></path><text font-family="sans-serif"font-size="13"textLength="108"x="7"y="95.661">query MyQuery {</text><text font-family="sans-serif"font-size="13"textLength="169"x="15"y="110.793">user(username: "user1") {</text><text font-family="sans-serif"font-size="13"textLength="65"x="23"y="125.926">username</text><text font-family="sans-serif"font-size="13"textLength="55"x="23"y="141.059">friends {</text><text font-family="sans-serif"font-size="13"textLength="65"x="31"y="156.192">username</text><text font-family="sans-serif"font-size="13"textLength="8"x="23"y="171.325">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="15"y="186.458">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="7"y="201.59">}</text><path d="M136 221.656h183v7l-10 10H136v-17"fill="#EEE"style="stroke:#000;stroke-width:1;fill:#eee"></path><path fill="none"style="stroke:#000;stroke-width:2;fill:none"d="M136 221.656h291V351.32H136z"></path><text font-family="sans-serif"font-size="13"font-weight="bold"textLength="138"x="151"y="234.723">resolve Query.user</text><path d="M146 243.79v25h267v-15l-10-10H146"fill="#FBFB77"filter="url(#30c5b4e18a6e75cdfbd596c8c4d2ebd1160d491507284d91f09a572378d3b670__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M403 243.79v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="246"x="152"y="260.856">Check username === user.username</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m351 310.188 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M201 314.188h156"></path><text font-family="sans-serif"font-size="13"textLength="68"x="208"y="293.989">query user</text><text font-family="sans-serif"font-size="13"textLength="130"x="216"y="309.122">username = "user1"</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m212 339.32-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M206 343.32h156"></path><text font-family="sans-serif"font-size="13"textLength="28"x="218"y="338.254">user</text><path d="M136 365.32h193v7l-10 10H136v-17"fill="#EEE"style="stroke:#000;stroke-width:1;fill:#eee"></path><path fill="none"style="stroke:#000;stroke-width:2;fill:none"d="M136 365.32h291v85.398H136z"></path><text font-family="sans-serif"font-size="13"font-weight="bold"textLength="148"x="151"y="378.387">resolve User.friends</text><path d="M146 387.453v25h267v-15l-10-10H146"fill="#FBFB77"filter="url(#30c5b4e18a6e75cdfbd596c8c4d2ebd1160d491507284d91f09a572378d3b670__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M403 387.453v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="246"x="152"y="404.52">Check username === user.username</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m351 438.719 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M201 442.719h156"></path><text font-family="sans-serif"font-size="13"textLength="82"x="208"y="437.653">Fetch friends</text><path d="M121 462.719v25h155v-15l-10-10H121"fill="#FBFB77"filter="url(#30c5b4e18a6e75cdfbd596c8c4d2ebd1160d491507284d91f09a572378d3b670__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M266 462.719v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="134"x="127"y="479.786">resolve usernames...</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m11 513.984-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M5 517.984h195"></path><text font-family="sans-serif"font-size="13"textLength="59"x="17"y="512.918">response</text></svg><figcaption class="caption">Resolvers can implement access control</figcaption></figure><p>If <code>user1</code> is sending the request to fetch itself:<pre class="highlight prevp"><code><span class="hljs-keyword">query</span><span class="hljs-literal"> MyQuery</span> {
  user(username: <span class="hljs-string">"user1"</span>) {
    username
  }
}</code></pre><p>The result is the <code>User</code> object:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"user"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user1"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><p>But querying a different user:<pre class="highlight prevp"><code><span class="hljs-keyword">query</span><span class="hljs-literal"> MyQuery</span> {
  user(username: <span class="hljs-string">"user3"</span>) {
    username
  }
}</code></pre><p>Returns an error:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"user"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"errors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"user"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"errorType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Unauthorized"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"errorInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"locations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"line"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"column"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"sourceName"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Not Authorized to access user on type User"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span></code></pre><p>A resolver can provide a safe way to query the <code>group</code> for a <code>User</code>. It needs to fetch the current user (the one who is sending the query) and see if the source's group is the same as the current user's group. If they are different, return an error.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="586"preserveAspectRatio="none"style="width:441px;height:586px;background:#fff"viewBox="0 0 441 586"width="441"><defs><filter height="300%"id="708504787a3c5b92e9b76b1524b141b7ca3d0d660942cc918685ed1a8b0b0d9e__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FFF"filter="url(#708504787a3c5b92e9b76b1524b141b7ca3d0d660942cc918685ed1a8b0b0d9e__a)"style="stroke:#000;stroke-width:2;fill:#fff"d="M136 206.523h291v129.664H136zm2 143.665h288v143.664H138z"></path><path style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5"d="M201 69.594v509.523M363 69.594v509.523"></path><text font-family="sans-serif"font-size="14"textLength="60"x="168"y="49.995">GraphQL</text><text font-family="sans-serif"font-size="14"textLength="60"x="168"y="66.292">backend</text><circle cx="201"cy="21"fill="#FEFECE"filter="url(#708504787a3c5b92e9b76b1524b141b7ca3d0d660942cc918685ed1a8b0b0d9e__a)"style="stroke:#a80036;stroke-width:2"r="12"></circle><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m197 9 6-5-2 5 2 5-6-5z"></path><text font-family="sans-serif"font-size="14"textLength="64"x="328"y="66.292">database</text><path d="M345 17.297c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26"fill="#FEFECE"filter="url(#708504787a3c5b92e9b76b1524b141b7ca3d0d660942cc918685ed1a8b0b0d9e__a)"style="stroke:#000;stroke-width:1.5;fill:#fefece"></path><path d="M345 17.297c0 10 18 10 18 10s18 0 18-10"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m189 187.523 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M0 191.523h195"></path><text font-family="sans-serif"font-size="13"textLength="108"x="7"y="95.661">query MyQuery {</text><text font-family="sans-serif"font-size="13"textLength="169"x="15"y="110.793">user(username: "user1") {</text><text font-family="sans-serif"font-size="13"textLength="49"x="23"y="125.926">group {</text><text font-family="sans-serif"font-size="13"textLength="37"x="31"y="141.059">name</text><text font-family="sans-serif"font-size="13"textLength="8"x="23"y="156.192">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="15"y="171.325">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="7"y="186.458">}</text><path d="M136 206.523h183v7l-10 10H136v-17"fill="#EEE"style="stroke:#000;stroke-width:1;fill:#eee"></path><path fill="none"style="stroke:#000;stroke-width:2;fill:none"d="M136 206.523h291v129.664H136z"></path><text font-family="sans-serif"font-size="13"font-weight="bold"textLength="138"x="151"y="219.59">resolve Query.user</text><path d="M146 228.656v25h267v-15l-10-10H146"fill="#FBFB77"filter="url(#708504787a3c5b92e9b76b1524b141b7ca3d0d660942cc918685ed1a8b0b0d9e__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M403 228.656v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="246"x="152"y="245.723">Check username === user.username</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m351 295.055 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M201 299.055h156"></path><text font-family="sans-serif"font-size="13"textLength="68"x="208"y="278.856">query user</text><text font-family="sans-serif"font-size="13"textLength="130"x="216"y="293.989">username = "user1"</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m212 324.188-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M206 328.188h156"></path><text font-family="sans-serif"font-size="13"textLength="28"x="218"y="323.122">user</text><path d="M138 350.188h185v7l-10 10H138v-17"fill="#EEE"style="stroke:#000;stroke-width:1;fill:#eee"></path><path fill="none"style="stroke:#000;stroke-width:2;fill:none"d="M138 350.188h288v143.664H138z"></path><text font-family="sans-serif"font-size="13"font-weight="bold"textLength="140"x="153"y="363.254">resolve User.group</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m351 384.453 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M201 388.453h156"></path><text font-family="sans-serif"font-size="13"textLength="105"x="208"y="383.387">Fetch caller user</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m212 413.586-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M206 417.586h156"></path><text font-family="sans-serif"font-size="13"textLength="36"x="218"y="412.52">user1</text><path d="M148 430.586v25h264v-15l-10-10H148"fill="#FBFB77"filter="url(#708504787a3c5b92e9b76b1524b141b7ca3d0d660942cc918685ed1a8b0b0d9e__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M402 430.586v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="243"x="154"y="447.653">Check caller.group === source.group</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m351 481.852 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M201 485.852h156"></path><text font-family="sans-serif"font-size="13"textLength="76"x="208"y="480.786">Fetch group</text><path d="M139 505.852v25h120v-15l-10-10H139"fill="#FBFB77"filter="url(#708504787a3c5b92e9b76b1524b141b7ca3d0d660942cc918685ed1a8b0b0d9e__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M249 505.852v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="99"x="145"y="522.918">resolve group...</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m11 557.117-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M5 561.117h195"></path><text font-family="sans-serif"font-size="13"textLength="59"x="17"y="556.051">response</text></svg><figcaption class="caption">Access control for the User.group field</figcaption></figure><p>While resolver-based access control implementations are not constrained by the limited set of directives the GraphQL server offers, they require more careful analysis to see if they indeed deny access when they should. Since the security decision is buried under some amount of code, it is usually not as easy to reason about as the schema-based implementations. My recommendation is to use directives when they are enough (all-or-nothing decisions based on only the caller identity) and move to resolvers only when needed.<h5 id="filtering-results">Filtering results</h5><p>So far, all the access control implementations we discussed were about whether to allow fetching a field or not. But in some cases, access control is not about whether the field is accessible or not but what items it returns. This usually happens with list results.<p>For example, administrators can get all users using the <code>allUsers</code> query. But since groups are hard boundaries, this should only return users in the same group. In this case, we'll end up with two access control implementations: one is shema-based to prevent non-admins from calling it, and the other is resolver-based that removes the unwanted results.<p>When <code>admin1</code> calls it:<pre class="highlight prevp"><code><span class="hljs-keyword">query</span><span class="hljs-literal"> MyQuery</span> {
  allUsers {
    username
  }
}</code></pre><p>It returns only the three users in <code>group1</code>:<pre class="highlight prevp"><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allUsers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"admin1"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user1"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user3"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><p>How it is implemented is up to what the GraphQL server supports. But the general idea is the same everywhere: implement the resolver so that it takes the caller's group into account and return only users in the same group.<figure class="plantuml image"><svg xmlns="http://www.w3.org/2000/svg"height="444"preserveAspectRatio="none"style="width:436px;height:444px;background:#fff"viewBox="0 0 436 444"width="436"><defs><filter height="300%"id="e5cdd8068e5e877bf71fd7b2074ac942d3b0bae1d7a59fc485a6c4682f34963a__a"width="300%"x="-1"y="-1"><feGaussianBlur result="blurOut"stdDeviation="2"></feGaussianBlur><feColorMatrix in="blurOut"result="blurOut2"values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"></feColorMatrix><feOffset dx="4"dy="4"in="blurOut2"result="blurOut3"></feOffset><feBlend in="SourceGraphic"in2="blurOut3"></feBlend></filter></defs><path fill="#FFF"filter="url(#e5cdd8068e5e877bf71fd7b2074ac942d3b0bae1d7a59fc485a6c4682f34963a__a)"style="stroke:#000;stroke-width:2;fill:#fff"d="M89 176.258h333v175.797H89z"></path><path style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5"d="M132 69.594V437.32M377 69.594V437.32"></path><text font-family="sans-serif"font-size="14"textLength="60"x="99"y="49.995">GraphQL</text><text font-family="sans-serif"font-size="14"textLength="60"x="99"y="66.292">backend</text><circle cx="132"cy="21"fill="#FEFECE"filter="url(#e5cdd8068e5e877bf71fd7b2074ac942d3b0bae1d7a59fc485a6c4682f34963a__a)"style="stroke:#a80036;stroke-width:2"r="12"></circle><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m128 9 6-5-2 5 2 5-6-5z"></path><text font-family="sans-serif"font-size="14"textLength="64"x="342"y="66.292">database</text><path d="M359 17.297c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26"fill="#FEFECE"filter="url(#e5cdd8068e5e877bf71fd7b2074ac942d3b0bae1d7a59fc485a6c4682f34963a__a)"style="stroke:#000;stroke-width:1.5;fill:#fefece"></path><path d="M359 17.297c0 10 18 10 18 10s18 0 18-10"fill="none"style="stroke:#000;stroke-width:1.5;fill:none"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m120 157.258 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M0 161.258h126"></path><text font-family="sans-serif"font-size="13"textLength="108"x="7"y="95.661">query MyQuery {</text><text font-family="sans-serif"font-size="13"textLength="63"x="15"y="110.793">allUsers {</text><text font-family="sans-serif"font-size="13"textLength="65"x="23"y="125.926">username</text><text font-family="sans-serif"font-size="13"textLength="8"x="15"y="141.059">}</text><text font-family="sans-serif"font-size="13"textLength="8"x="7"y="156.192">}</text><path d="M89 176.258h209v7l-10 10H89v-17"fill="#EEE"style="stroke:#000;stroke-width:1;fill:#eee"></path><path fill="none"style="stroke:#000;stroke-width:2;fill:none"d="M89 176.258h333v175.797H89z"></path><text font-family="sans-serif"font-size="13"font-weight="bold"textLength="164"x="104"y="189.325">resolve Query.allUsers</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m365 210.523 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M132 214.523h239"></path><text font-family="sans-serif"font-size="13"textLength="78"x="139"y="209.458">get all users</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m143 239.656-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M137 243.656h239"></path><text font-family="sans-serif"font-size="13"textLength="35"x="149"y="238.59">users</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m365 268.79 10 4-10 4 4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M132 272.789h239"></path><text font-family="sans-serif"font-size="13"textLength="91"x="139"y="267.723">get caller user</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m143 297.922-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M137 301.922h239"></path><text font-family="sans-serif"font-size="13"textLength="48"x="149"y="296.856">admin1</text><path style="stroke:#a80036;stroke-width:1"d="M132 331.055h42m0 0v13m-41 0h41"></path><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m143 340.055-10 4 10 4-4-4z"></path><text font-family="sans-serif"font-size="13"textLength="231"x="139"y="325.989">filter admin1.group === user.group</text><path d="M71 364.055v25h118v-15l-10-10H71"fill="#FBFB77"filter="url(#e5cdd8068e5e877bf71fd7b2074ac942d3b0bae1d7a59fc485a6c4682f34963a__a)"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><path d="M179 364.055v10h10l-10-10"fill="#FBFB77"style="stroke:#a80036;stroke-width:1;fill:#fbfb77"></path><text font-family="sans-serif"font-size="13"textLength="97"x="77"y="381.122">resolve users...</text><path fill="#A80036"style="stroke:#a80036;stroke-width:1;fill:#a80036"d="m11 415.32-10 4 10 4-4-4z"></path><path style="stroke:#a80036;stroke-width:1"d="M5 419.32h126"></path><text font-family="sans-serif"font-size="13"textLength="59"x="17"y="414.254">response</text></svg><figcaption class="caption">Filter the result collection</figcaption></figure><div class="tcolorbox tcolorbox-secondary my-5"><div class="tbox-header fw-bold">Master AppSync and GraphQL</div><div class="tbox-body"><div>Support this book and get all future updates and extra chapters in ebook format.</div><div class="d-flex justify-content-center"><a role="button"href="https://tsallai.gumroad.com/l/graphql-on-aws-appsync-book"class="btn btn-primary not-styled mt-3 text-white">Buy the book</a></div></div></div><div class="pagination row"><div class="col-6"><a href="/graphql-basics/resolvers/"class="border rounded d-block p-3"><div class="pagination-sublabel text-muted small">Previous</div><div class="pagination-title">&lt; Resolvers</div></a></div><div class="col-6"><a href="/aws-appsync/"class="border rounded d-block p-3 text-end ms-auto"><div class="pagination-sublabel text-muted small">Next</div><div class="pagination-title">AWS AppSync &gt;</div></a></div></div><footer>Â© TamÃ¡s Sallai - <a href="https://advancedweb.hu">advancedweb.hu</a></footer></div><div class="col-lg-3 d-none d-lg-block"><div class="toc-container"><a style="margin-left: 0em"href="#access-control">Access control</a> <a style="margin-left: 1em"href="#example-data-model">Example data model</a> <a style="margin-left: 1em"href="#entry-points">Entry points</a> <a style="margin-left: 1em"href="#traversals">Traversals</a> <a style="margin-left: 2em"href="#a-more-complex-example">A more complex example</a> <a style="margin-left: 1em"href="#implementation">Implementation</a> <a style="margin-left: 2em"href="#defined-schema-based-access-control">Schema-based access control</a> <a style="margin-left: 2em"href="#defined-resolver-based-access-control">Resolver-based access control</a> <a style="margin-left: 3em"href="#filtering-results">Filtering results</a></div></div></div></div></div><script src="/assets/main.077454cb0bffe3695e9176b1b5f8a7fd9676d920.js"></script>